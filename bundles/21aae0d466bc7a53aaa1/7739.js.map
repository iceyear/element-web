{"version":3,"file":"bundles/21aae0d466bc7a53aaa1/7739.js","mappings":"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","sources":["webpack://element-web/./node_modules/matrix-js-sdk/src/@types/beacon.ts","webpack://element-web/./node_modules/matrix-js-sdk/src/@types/event.ts","webpack://element-web/./node_modules/matrix-js-sdk/src/@types/extensible_events.ts","webpack://element-web/./node_modules/matrix-js-sdk/src/@types/location.ts","webpack://element-web/./node_modules/matrix-js-sdk/src/@types/polls.ts","webpack://element-web/./node_modules/matrix-js-sdk/src/@types/read_receipts.ts","webpack://element-web/./node_modules/matrix-js-sdk/src/@types/sync.ts","webpack://element-web/./node_modules/matrix-js-sdk/src/NamespacedValue.ts","webpack://element-web/./node_modules/matrix-js-sdk/src/store/indexeddb-store-worker.ts","webpack://element-web/./node_modules/matrix-js-sdk/src/logger.ts","webpack://element-web/./node_modules/matrix-js-sdk/src/receipt-accumulator.ts","webpack://element-web/./node_modules/matrix-js-sdk/src/sync-accumulator.ts","webpack://element-web/./node_modules/matrix-js-sdk/src/utils.ts","webpack://element-web/./node_modules/loglevel/lib/loglevel.js","webpack://element-web/./node_modules/matrix-events-sdk/lib/ExtensibleEvents.js","webpack://element-web/./node_modules/matrix-events-sdk/lib/IPartialEvent.js","webpack://element-web/./node_modules/matrix-events-sdk/lib/InvalidEventError.js","webpack://element-web/./node_modules/matrix-events-sdk/lib/NamespacedMap.js","webpack://element-web/./node_modules/matrix-events-sdk/lib/NamespacedValue.js","webpack://element-web/./node_modules/matrix-events-sdk/lib/events/EmoteEvent.js","webpack://element-web/./node_modules/matrix-events-sdk/lib/events/ExtensibleEvent.js","webpack://element-web/./node_modules/matrix-events-sdk/lib/events/MessageEvent.js","webpack://element-web/./node_modules/matrix-events-sdk/lib/events/NoticeEvent.js","webpack://element-web/./node_modules/matrix-events-sdk/lib/events/PollEndEvent.js","webpack://element-web/./node_modules/matrix-events-sdk/lib/events/PollResponseEvent.js","webpack://element-web/./node_modules/matrix-events-sdk/lib/events/PollStartEvent.js","webpack://element-web/./node_modules/matrix-events-sdk/lib/events/message_types.js","webpack://element-web/./node_modules/matrix-events-sdk/lib/events/poll_types.js","webpack://element-web/./node_modules/matrix-events-sdk/lib/events/relationship_types.js","webpack://element-web/./node_modules/matrix-events-sdk/lib/index.js","webpack://element-web/./node_modules/matrix-events-sdk/lib/interpreters/legacy/MRoomMessage.js","webpack://element-web/./node_modules/matrix-events-sdk/lib/interpreters/modern/MMessage.js","webpack://element-web/./node_modules/matrix-events-sdk/lib/interpreters/modern/MPoll.js","webpack://element-web/./node_modules/matrix-events-sdk/lib/types.js","webpack://element-web/./node_modules/matrix-events-sdk/lib/utility/MessageMatchers.js","webpack://element-web/./node_modules/matrix-events-sdk/lib/utility/events.js","webpack://element-web/./node_modules/p-retry/index.js","webpack://element-web/./node_modules/retry/index.js","webpack://element-web/./node_modules/retry/lib/retry.js","webpack://element-web/./node_modules/retry/lib/retry_operation.js","webpack://element-web/./node_modules/unhomoglyph/index.js","webpack://element-web/./node_modules/@babel/runtime/helpers/esm/defineProperty.js","webpack://element-web/./node_modules/@babel/runtime/helpers/esm/toPrimitive.js","webpack://element-web/./node_modules/@babel/runtime/helpers/esm/toPropertyKey.js","webpack://element-web/./node_modules/@babel/runtime/helpers/esm/typeof.js"],"sourcesContent":["/*\nCopyright 2022 The Matrix.org Foundation C.I.C.\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\n\nimport { RelatesToRelationship, REFERENCE_RELATION } from \"./extensible_events.ts\";\nimport { UnstableValue } from \"../NamespacedValue.ts\";\nimport { MAssetEvent, MLocationEvent, MTimestampEvent } from \"./location.ts\";\n\n/**\n * Beacon info and beacon event types as described in MSC3672\n * https://github.com/matrix-org/matrix-spec-proposals/pull/3672\n */\n\n/**\n * Beacon info events are state events.\n * We have two requirements for these events:\n * 1. they can only be written by their owner\n * 2. a user can have an arbitrary number of beacon_info events\n *\n * 1. is achieved by setting the state_key to the owners mxid.\n * Event keys in room state are a combination of `type` + `state_key`.\n * To achieve an arbitrary number of only owner-writable state events\n * we introduce a variable suffix to the event type\n *\n * @example\n * ```\n * {\n *      \"type\": \"m.beacon_info.@matthew:matrix.org.1\",\n *      \"state_key\": \"@matthew:matrix.org\",\n *      \"content\": {\n *          \"m.beacon_info\": {\n *              \"description\": \"The Matthew Tracker\",\n *              \"timeout\": 86400000,\n *          },\n *          // more content as described below\n *      }\n * },\n * {\n *      \"type\": \"m.beacon_info.@matthew:matrix.org.2\",\n *      \"state_key\": \"@matthew:matrix.org\",\n *      \"content\": {\n *          \"m.beacon_info\": {\n *              \"description\": \"Another different Matthew tracker\",\n *              \"timeout\": 400000,\n *          },\n *          // more content as described below\n *      }\n * }\n * ```\n */\n\n/**\n * Non-variable type for m.beacon_info event content\n */\nexport const M_BEACON_INFO = new UnstableValue(\"m.beacon_info\", \"org.matrix.msc3672.beacon_info\");\nexport const M_BEACON = new UnstableValue(\"m.beacon\", \"org.matrix.msc3672.beacon\");\n\nexport type MBeaconInfoContent = {\n    description?: string;\n    // how long from the last event until we consider the beacon inactive in milliseconds\n    timeout: number;\n    // true when this is a live location beacon\n    // https://github.com/matrix-org/matrix-spec-proposals/pull/3672\n    live?: boolean;\n};\n\n/**\n * m.beacon_info Event example from the spec\n * https://github.com/matrix-org/matrix-spec-proposals/pull/3672\n * @example\n * ```\n * {\n *   \"type\": \"m.beacon_info\",\n *   \"state_key\": \"@matthew:matrix.org\",\n *   \"content\": {\n *     \"m.beacon_info\": {\n *       \"description\": \"The Matthew Tracker\", // same as an `m.location` description\n *       \"timeout\": 86400000, // how long from the last event until we consider the beacon inactive in milliseconds\n *     },\n *     \"m.ts\": 1436829458432, // creation timestamp of the beacon on the client\n *     \"m.asset\": {\n *       \"type\": \"m.self\" // the type of asset being tracked as per MSC3488\n *     }\n *   }\n * }\n * ```\n */\n\n/**\n * m.beacon_info.* event content\n */\nexport type MBeaconInfoEventContent = MBeaconInfoContent &\n    // creation timestamp of the beacon on the client\n    MTimestampEvent &\n    // the type of asset being tracked as per MSC3488\n    MAssetEvent;\n\n/**\n * m.beacon event example\n * https://github.com/matrix-org/matrix-spec-proposals/pull/3672\n * @example\n * ```\n * {\n *   \"type\": \"m.beacon\",\n *   \"sender\": \"@matthew:matrix.org\",\n *   \"content\": {\n *       \"m.relates_to\": { // from MSC2674: https://github.com/matrix-org/matrix-doc/pull/2674\n *           \"rel_type\": \"m.reference\", // from MSC3267: https://github.com/matrix-org/matrix-doc/pull/3267\n *           \"event_id\": \"$beacon_info\"\n *       },\n *       \"m.location\": {\n *           \"uri\": \"geo:51.5008,0.1247;u=35\",\n *           \"description\": \"Arbitrary beacon information\"\n *       },\n *       \"m.ts\": 1636829458432,\n *   }\n * }\n * ```\n */\n\n/**\n * Content of an m.beacon event\n */\nexport type MBeaconEventContent = MLocationEvent &\n    // timestamp when location was taken\n    MTimestampEvent &\n    // relates to a beacon_info event\n    RelatesToRelationship<typeof REFERENCE_RELATION>;\n","/*\nCopyright 2020 The Matrix.org Foundation C.I.C.\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\n\nimport { NamespacedValue, UnstableValue } from \"../NamespacedValue.ts\";\nimport {\n    PolicyRuleEventContent,\n    RoomAvatarEventContent,\n    RoomCanonicalAliasEventContent,\n    RoomCreateEventContent,\n    RoomEncryptionEventContent,\n    RoomGuestAccessEventContent,\n    RoomHistoryVisibilityEventContent,\n    RoomJoinRulesEventContent,\n    RoomMemberEventContent,\n    RoomNameEventContent,\n    RoomPinnedEventsEventContent,\n    RoomPowerLevelsEventContent,\n    RoomServerAclEventContent,\n    RoomThirdPartyInviteEventContent,\n    RoomTombstoneEventContent,\n    RoomTopicEventContent,\n    SpaceChildEventContent,\n    SpaceParentEventContent,\n} from \"./state_events.ts\";\nimport {\n    ExperimentalGroupCallRoomMemberState,\n    IGroupCallRoomMemberState,\n    IGroupCallRoomState,\n} from \"../webrtc/groupCall.ts\";\nimport { MSC3089EventContent } from \"../models/MSC3089Branch.ts\";\nimport { M_BEACON, M_BEACON_INFO, MBeaconEventContent, MBeaconInfoEventContent } from \"./beacon.ts\";\nimport { XOR } from \"./common.ts\";\nimport { ReactionEventContent, RoomMessageEventContent, StickerEventContent } from \"./events.ts\";\nimport {\n    MCallAnswer,\n    MCallBase,\n    MCallCandidates,\n    MCallHangupReject,\n    MCallInviteNegotiate,\n    MCallReplacesEvent,\n    MCallSelectAnswer,\n    SDPStreamMetadata,\n    SDPStreamMetadataKey,\n} from \"../webrtc/callEventTypes.ts\";\nimport { EncryptionKeysEventContent, ICallNotifyContent } from \"../matrixrtc/types.ts\";\nimport { M_POLL_END, M_POLL_START, PollEndEventContent, PollStartEventContent } from \"./polls.ts\";\nimport { SessionMembershipData } from \"../matrixrtc/CallMembership.ts\";\n\nexport enum EventType {\n    // Room state events\n    RoomCanonicalAlias = \"m.room.canonical_alias\",\n    RoomCreate = \"m.room.create\",\n    RoomJoinRules = \"m.room.join_rules\",\n    RoomMember = \"m.room.member\",\n    RoomThirdPartyInvite = \"m.room.third_party_invite\",\n    RoomPowerLevels = \"m.room.power_levels\",\n    RoomName = \"m.room.name\",\n    RoomTopic = \"m.room.topic\",\n    RoomAvatar = \"m.room.avatar\",\n    RoomPinnedEvents = \"m.room.pinned_events\",\n    RoomEncryption = \"m.room.encryption\",\n    RoomHistoryVisibility = \"m.room.history_visibility\",\n    RoomGuestAccess = \"m.room.guest_access\",\n    RoomServerAcl = \"m.room.server_acl\",\n    RoomTombstone = \"m.room.tombstone\",\n    RoomPredecessor = \"org.matrix.msc3946.room_predecessor\",\n\n    // Moderation policy lists\n    PolicyRuleUser = \"m.policy.rule.user\",\n    PolicyRuleRoom = \"m.policy.rule.room\",\n    PolicyRuleServer = \"m.policy.rule.server\",\n\n    SpaceChild = \"m.space.child\",\n    SpaceParent = \"m.space.parent\",\n\n    // Room timeline events\n    RoomRedaction = \"m.room.redaction\",\n    RoomMessage = \"m.room.message\",\n    RoomMessageEncrypted = \"m.room.encrypted\",\n    Sticker = \"m.sticker\",\n    CallInvite = \"m.call.invite\",\n    CallCandidates = \"m.call.candidates\",\n    CallAnswer = \"m.call.answer\",\n    CallHangup = \"m.call.hangup\",\n    CallReject = \"m.call.reject\",\n    CallSelectAnswer = \"m.call.select_answer\",\n    CallNegotiate = \"m.call.negotiate\",\n    CallSDPStreamMetadataChanged = \"m.call.sdp_stream_metadata_changed\",\n    CallSDPStreamMetadataChangedPrefix = \"org.matrix.call.sdp_stream_metadata_changed\",\n    CallReplaces = \"m.call.replaces\",\n    CallAssertedIdentity = \"m.call.asserted_identity\",\n    CallAssertedIdentityPrefix = \"org.matrix.call.asserted_identity\",\n    CallEncryptionKeysPrefix = \"io.element.call.encryption_keys\",\n    KeyVerificationRequest = \"m.key.verification.request\",\n    KeyVerificationStart = \"m.key.verification.start\",\n    KeyVerificationCancel = \"m.key.verification.cancel\",\n    KeyVerificationMac = \"m.key.verification.mac\",\n    KeyVerificationDone = \"m.key.verification.done\",\n    KeyVerificationKey = \"m.key.verification.key\",\n    KeyVerificationAccept = \"m.key.verification.accept\",\n    // Not used directly - see READY_TYPE in VerificationRequest.\n    KeyVerificationReady = \"m.key.verification.ready\",\n    // use of this is discouraged https://matrix.org/docs/spec/client_server/r0.6.1#m-room-message-feedback\n    RoomMessageFeedback = \"m.room.message.feedback\",\n    Reaction = \"m.reaction\",\n    PollStart = \"org.matrix.msc3381.poll.start\",\n\n    // Room ephemeral events\n    Typing = \"m.typing\",\n    Receipt = \"m.receipt\",\n    Presence = \"m.presence\",\n\n    // Room account_data events\n    FullyRead = \"m.fully_read\",\n    Tag = \"m.tag\",\n    SpaceOrder = \"org.matrix.msc3230.space_order\", // MSC3230\n\n    // User account_data events\n    PushRules = \"m.push_rules\",\n    Direct = \"m.direct\",\n    IgnoredUserList = \"m.ignored_user_list\",\n\n    // to_device events\n    RoomKey = \"m.room_key\",\n    RoomKeyRequest = \"m.room_key_request\",\n    ForwardedRoomKey = \"m.forwarded_room_key\",\n    Dummy = \"m.dummy\",\n\n    // Group call events\n    GroupCallPrefix = \"org.matrix.msc3401.call\",\n    GroupCallMemberPrefix = \"org.matrix.msc3401.call.member\",\n\n    // MatrixRTC events\n    CallNotify = \"org.matrix.msc4075.call.notify\",\n}\n\nexport enum RelationType {\n    Annotation = \"m.annotation\",\n    Replace = \"m.replace\",\n    Reference = \"m.reference\",\n\n    // Don't use this yet: it's only the stable version. The code still assumes we support the unstable prefix and,\n    // moreover, our tests currently use the unstable prefix. Use THREAD_RELATION_TYPE.name.\n    // Once we support *only* the stable prefix, THREAD_RELATION_TYPE can die and we can switch to this.\n    Thread = \"m.thread\",\n}\n\nexport enum MsgType {\n    Text = \"m.text\",\n    Emote = \"m.emote\",\n    Notice = \"m.notice\",\n    Image = \"m.image\",\n    File = \"m.file\",\n    Audio = \"m.audio\",\n    Location = \"m.location\",\n    Video = \"m.video\",\n    KeyVerificationRequest = \"m.key.verification.request\",\n}\n\nexport const RoomCreateTypeField = \"type\";\n\nexport enum RoomType {\n    Space = \"m.space\",\n    UnstableCall = \"org.matrix.msc3417.call\",\n    ElementVideo = \"io.element.video\",\n}\n\nexport const ToDeviceMessageId = \"org.matrix.msgid\";\n\n/**\n * Identifier for an [MSC3088](https://github.com/matrix-org/matrix-doc/pull/3088)\n * room purpose. Note that this reference is UNSTABLE and subject to breaking changes,\n * including its eventual removal.\n */\nexport const UNSTABLE_MSC3088_PURPOSE = new UnstableValue(\"m.room.purpose\", \"org.matrix.msc3088.purpose\");\n\n/**\n * Enabled flag for an [MSC3088](https://github.com/matrix-org/matrix-doc/pull/3088)\n * room purpose. Note that this reference is UNSTABLE and subject to breaking changes,\n * including its eventual removal.\n */\nexport const UNSTABLE_MSC3088_ENABLED = new UnstableValue(\"m.enabled\", \"org.matrix.msc3088.enabled\");\n\n/**\n * Subtype for an [MSC3089](https://github.com/matrix-org/matrix-doc/pull/3089) space-room.\n * Note that this reference is UNSTABLE and subject to breaking changes, including its\n * eventual removal.\n */\nexport const UNSTABLE_MSC3089_TREE_SUBTYPE = new UnstableValue(\"m.data_tree\", \"org.matrix.msc3089.data_tree\");\n\n/**\n * Leaf type for an event in a [MSC3089](https://github.com/matrix-org/matrix-doc/pull/3089) space-room.\n * Note that this reference is UNSTABLE and subject to breaking changes, including its\n * eventual removal.\n */\nexport const UNSTABLE_MSC3089_LEAF = new UnstableValue(\"m.leaf\", \"org.matrix.msc3089.leaf\");\n\n/**\n * Branch (Leaf Reference) type for the index approach in a\n * [MSC3089](https://github.com/matrix-org/matrix-doc/pull/3089) space-room. Note that this reference is\n * UNSTABLE and subject to breaking changes, including its eventual removal.\n */\nexport const UNSTABLE_MSC3089_BRANCH = new UnstableValue(\"m.branch\", \"org.matrix.msc3089.branch\");\n\n/**\n * Marker event type to point back at imported historical content in a room. See\n * [MSC2716](https://github.com/matrix-org/matrix-spec-proposals/pull/2716).\n * Note that this reference is UNSTABLE and subject to breaking changes,\n * including its eventual removal.\n */\nexport const UNSTABLE_MSC2716_MARKER = new UnstableValue(\"m.room.marker\", \"org.matrix.msc2716.marker\");\n\n/**\n * Name of the request property for relation based redactions.\n * {@link https://github.com/matrix-org/matrix-spec-proposals/pull/3912}\n */\nexport const MSC3912_RELATION_BASED_REDACTIONS_PROP = new UnstableValue(\n    \"with_rel_types\",\n    \"org.matrix.msc3912.with_relations\",\n);\n\n/**\n * Functional members type for declaring a purpose of room members (e.g. helpful bots).\n * Note that this reference is UNSTABLE and subject to breaking changes, including its\n * eventual removal.\n *\n * Schema (TypeScript):\n * ```\n * {\n *   service_members?: string[]\n * }\n * ```\n *\n * @example\n * ```\n * {\n *   \"service_members\": [\n *     \"@helperbot:localhost\",\n *     \"@reminderbot:alice.tdl\"\n *   ]\n * }\n * ```\n */\nexport const UNSTABLE_ELEMENT_FUNCTIONAL_USERS = new UnstableValue(\n    \"io.element.functional_members\",\n    \"io.element.functional_members\",\n);\n\n/**\n * A type of message that affects visibility of a message,\n * as per https://github.com/matrix-org/matrix-doc/pull/3531\n *\n * @experimental\n */\nexport const EVENT_VISIBILITY_CHANGE_TYPE = new UnstableValue(\"m.visibility\", \"org.matrix.msc3531.visibility\");\n\n/**\n * https://github.com/matrix-org/matrix-doc/pull/3881\n *\n * @experimental\n */\nexport const PUSHER_ENABLED = new UnstableValue(\"enabled\", \"org.matrix.msc3881.enabled\");\n\n/**\n * https://github.com/matrix-org/matrix-doc/pull/3881\n *\n * @experimental\n */\nexport const PUSHER_DEVICE_ID = new UnstableValue(\"device_id\", \"org.matrix.msc3881.device_id\");\n\n/**\n * https://github.com/matrix-org/matrix-doc/pull/3890\n *\n * @experimental\n */\nexport const LOCAL_NOTIFICATION_SETTINGS_PREFIX = new UnstableValue(\n    \"m.local_notification_settings\",\n    \"org.matrix.msc3890.local_notification_settings\",\n);\n\n/**\n * https://github.com/matrix-org/matrix-doc/pull/4023\n *\n * @experimental\n */\nexport const UNSIGNED_THREAD_ID_FIELD = new UnstableValue(\"thread_id\", \"org.matrix.msc4023.thread_id\");\n\n/**\n * https://github.com/matrix-org/matrix-spec-proposals/pull/4115\n *\n * @experimental\n */\nexport const UNSIGNED_MEMBERSHIP_FIELD = new NamespacedValue(\"membership\", \"io.element.msc4115.membership\");\n\n/**\n * Mapped type from event type to content type for all specified non-state room events.\n */\nexport interface TimelineEvents {\n    [EventType.RoomMessage]: RoomMessageEventContent;\n    [EventType.Sticker]: StickerEventContent;\n    [EventType.Reaction]: ReactionEventContent;\n    [EventType.CallReplaces]: MCallReplacesEvent;\n    [EventType.CallAnswer]: MCallAnswer;\n    [EventType.CallSelectAnswer]: MCallSelectAnswer;\n    [EventType.CallNegotiate]: Omit<MCallInviteNegotiate, \"offer\">;\n    [EventType.CallInvite]: MCallInviteNegotiate;\n    [EventType.CallCandidates]: MCallCandidates;\n    [EventType.CallHangup]: MCallHangupReject;\n    [EventType.CallReject]: MCallHangupReject;\n    [EventType.CallSDPStreamMetadataChangedPrefix]: MCallBase & { [SDPStreamMetadataKey]: SDPStreamMetadata };\n    [EventType.CallEncryptionKeysPrefix]: EncryptionKeysEventContent;\n    [EventType.CallNotify]: ICallNotifyContent;\n    [M_BEACON.name]: MBeaconEventContent;\n    [M_POLL_START.name]: PollStartEventContent;\n    [M_POLL_END.name]: PollEndEventContent;\n}\n\n/**\n * Mapped type from event type to content type for all specified room state events.\n */\nexport interface StateEvents {\n    [EventType.RoomCanonicalAlias]: RoomCanonicalAliasEventContent;\n    [EventType.RoomCreate]: RoomCreateEventContent;\n    [EventType.RoomJoinRules]: RoomJoinRulesEventContent;\n    [EventType.RoomMember]: RoomMemberEventContent;\n    // XXX: Spec says this event has 3 required fields but kicking such an invitation requires sending `{}`\n    [EventType.RoomThirdPartyInvite]: XOR<RoomThirdPartyInviteEventContent, {}>;\n    [EventType.RoomPowerLevels]: RoomPowerLevelsEventContent;\n    [EventType.RoomName]: RoomNameEventContent;\n    [EventType.RoomTopic]: RoomTopicEventContent;\n    [EventType.RoomAvatar]: RoomAvatarEventContent;\n    [EventType.RoomPinnedEvents]: RoomPinnedEventsEventContent;\n    [EventType.RoomEncryption]: RoomEncryptionEventContent;\n    [EventType.RoomHistoryVisibility]: RoomHistoryVisibilityEventContent;\n    [EventType.RoomGuestAccess]: RoomGuestAccessEventContent;\n    [EventType.RoomServerAcl]: RoomServerAclEventContent;\n    [EventType.RoomTombstone]: RoomTombstoneEventContent;\n    [EventType.SpaceChild]: SpaceChildEventContent;\n    [EventType.SpaceParent]: SpaceParentEventContent;\n\n    [EventType.PolicyRuleUser]: XOR<PolicyRuleEventContent, {}>;\n    [EventType.PolicyRuleRoom]: XOR<PolicyRuleEventContent, {}>;\n    [EventType.PolicyRuleServer]: XOR<PolicyRuleEventContent, {}>;\n\n    // MSC3401\n    [EventType.GroupCallPrefix]: IGroupCallRoomState;\n    [EventType.GroupCallMemberPrefix]: XOR<\n        XOR<IGroupCallRoomMemberState, ExperimentalGroupCallRoomMemberState>,\n        XOR<SessionMembershipData, {}>\n    >;\n\n    // MSC3089\n    [UNSTABLE_MSC3089_BRANCH.name]: MSC3089EventContent;\n\n    // MSC3672\n    [M_BEACON_INFO.name]: MBeaconInfoEventContent;\n}\n","/*\nCopyright 2021 - 2023 The Matrix.org Foundation C.I.C.\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\n\nimport { EitherAnd, NamespacedValue, Optional, UnstableValue } from \"matrix-events-sdk\";\n\nimport { isProvided } from \"../extensible_events_v1/utilities.ts\";\n\n// Types and utilities for MSC1767: Extensible events (version 1) in Matrix\n\n/**\n * Represents the stable and unstable values of a given namespace.\n */\nexport type TSNamespace<N> =\n    N extends NamespacedValue<infer S, infer U> ? TSNamespaceValue<S> | TSNamespaceValue<U> : never;\n\n/**\n * Represents a namespaced value, if the value is a string. Used to extract provided types\n * from a TSNamespace<N> (in cases where only stable *or* unstable is provided).\n */\nexport type TSNamespaceValue<V> = V extends string ? V : never;\n\n/**\n * Creates a type which is V when T is `never`, otherwise T.\n */\n// See https://github.com/microsoft/TypeScript/issues/23182#issuecomment-379091887 for details on the array syntax.\nexport type DefaultNever<T, V> = [T] extends [never] ? V : T;\n\n/**\n * The namespaced value for m.message\n */\nexport const M_MESSAGE = new UnstableValue(\"m.message\", \"org.matrix.msc1767.message\");\n\n/**\n * An m.message event rendering\n */\nexport interface IMessageRendering {\n    body: string;\n    mimetype?: string;\n}\n\n/**\n * The content for an m.message event\n */\nexport type ExtensibleMessageEventContent = EitherAnd<\n    { [M_MESSAGE.name]: IMessageRendering[] },\n    { [M_MESSAGE.altName]: IMessageRendering[] }\n>;\n\n/**\n * The namespaced value for m.text\n */\nexport const M_TEXT = new UnstableValue(\"m.text\", \"org.matrix.msc1767.text\");\n\n/**\n * The content for an m.text event\n */\nexport type TextEventContent = EitherAnd<{ [M_TEXT.name]: string }, { [M_TEXT.altName]: string }>;\n\n/**\n * The namespaced value for m.html\n */\nexport const M_HTML = new UnstableValue(\"m.html\", \"org.matrix.msc1767.html\");\n\n/**\n * The content for an m.html event\n */\nexport type HtmlEventContent = EitherAnd<{ [M_HTML.name]: string }, { [M_HTML.altName]: string }>;\n\n/**\n * The content for an m.message, m.text, or m.html event\n */\nexport type ExtensibleAnyMessageEventContent = ExtensibleMessageEventContent | TextEventContent | HtmlEventContent;\n\n/**\n * The namespaced value for an m.reference relation\n */\nexport const REFERENCE_RELATION = new NamespacedValue(\"m.reference\");\n\n/**\n * Represents any relation type\n */\nexport type AnyRelation = TSNamespace<typeof REFERENCE_RELATION> | string;\n\n/**\n * An m.relates_to relationship\n */\nexport type RelatesToRelationship<R = never, C = never> = {\n    \"m.relates_to\": {\n        // See https://github.com/microsoft/TypeScript/issues/23182#issuecomment-379091887 for array syntax\n        rel_type: [R] extends [never] ? AnyRelation : TSNamespace<R>;\n        event_id: string;\n    } & DefaultNever<C, {}>;\n};\n\n/**\n * Partial types for a Matrix Event.\n */\nexport interface IPartialEvent<TContent> {\n    type: string;\n    content: TContent;\n}\n\n/**\n * Represents a potentially namespaced event type.\n */\nexport type ExtensibleEventType = NamespacedValue<string, string> | string;\n\n/**\n * Determines if two event types are the same, including namespaces.\n * @param given - The given event type. This will be compared\n * against the expected type.\n * @param expected - The expected event type.\n * @returns True if the given type matches the expected type.\n */\nexport function isEventTypeSame(\n    given: Optional<ExtensibleEventType>,\n    expected: Optional<ExtensibleEventType>,\n): boolean {\n    if (typeof given === \"string\") {\n        if (typeof expected === \"string\") {\n            return expected === given;\n        } else {\n            return (expected as NamespacedValue<string, string>).matches(given as string);\n        }\n    } else {\n        if (typeof expected === \"string\") {\n            return (given as NamespacedValue<string, string>).matches(expected as string);\n        } else {\n            const expectedNs = expected as NamespacedValue<string, string>;\n            const givenNs = given as NamespacedValue<string, string>;\n            return (\n                expectedNs.matches(givenNs.name) ||\n                (isProvided(givenNs.altName) && expectedNs.matches(givenNs.altName!))\n            );\n        }\n    }\n}\n","/*\nCopyright 2021 The Matrix.org Foundation C.I.C.\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\n\n// Types for MSC3488 - m.location: Extending events with location data\nimport { EitherAnd } from \"matrix-events-sdk\";\n\nimport { UnstableValue } from \"../NamespacedValue.ts\";\nimport { M_TEXT } from \"./extensible_events.ts\";\n\nexport enum LocationAssetType {\n    Self = \"m.self\",\n    Pin = \"m.pin\",\n}\n\nexport const M_ASSET = new UnstableValue(\"m.asset\", \"org.matrix.msc3488.asset\");\nexport type MAssetContent = { type: LocationAssetType };\n/**\n * The event definition for an m.asset event (in content)\n */\nexport type MAssetEvent = EitherAnd<{ [M_ASSET.name]: MAssetContent }, { [M_ASSET.altName]: MAssetContent }>;\n\nexport const M_TIMESTAMP = new UnstableValue(\"m.ts\", \"org.matrix.msc3488.ts\");\n/**\n * The event definition for an m.ts event (in content)\n */\nexport type MTimestampEvent = EitherAnd<{ [M_TIMESTAMP.name]: number }, { [M_TIMESTAMP.altName]: number }>;\n\nexport const M_LOCATION = new UnstableValue(\"m.location\", \"org.matrix.msc3488.location\");\n\nexport type MLocationContent = {\n    uri: string;\n    description?: string | null;\n};\n\nexport type MLocationEvent = EitherAnd<\n    { [M_LOCATION.name]: MLocationContent },\n    { [M_LOCATION.altName]: MLocationContent }\n>;\n\nexport type MTextEvent = EitherAnd<{ [M_TEXT.name]: string }, { [M_TEXT.altName]: string }>;\n\n/* From the spec at:\n * https://github.com/matrix-org/matrix-doc/blob/matthew/location/proposals/3488-location.md\n{\n    \"type\": \"m.room.message\",\n    \"content\": {\n        \"body\": \"Matthew was at geo:51.5008,0.1247;u=35 as of Sat Nov 13 18:50:58 2021\",\n        \"msgtype\": \"m.location\",\n        \"geo_uri\": \"geo:51.5008,0.1247;u=35\",\n        \"m.location\": {\n            \"uri\": \"geo:51.5008,0.1247;u=35\",\n            \"description\": \"Matthew's whereabouts\",\n        },\n        \"m.asset\": {\n            \"type\": \"m.self\"\n        },\n        \"m.text\": \"Matthew was at geo:51.5008,0.1247;u=35 as of Sat Nov 13 18:50:58 2021\",\n        \"m.ts\": 1636829458432,\n    }\n}\n*/\ntype OptionalTimestampEvent = MTimestampEvent | undefined;\n/**\n * The content for an m.location event\n */\nexport type MLocationEventContent = MLocationEvent & MAssetEvent & MTextEvent & OptionalTimestampEvent;\n\nexport type LegacyLocationEventContent = {\n    body: string;\n    msgtype: string;\n    geo_uri: string;\n};\n\n/**\n * Possible content for location events as sent over the wire\n */\nexport type LocationEventWireContent = Partial<LegacyLocationEventContent & MLocationEventContent>;\n\nexport type ILocationContent = MLocationEventContent & LegacyLocationEventContent;\n","/*\nCopyright 2022 - 2023 The Matrix.org Foundation C.I.C.\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\n\nimport { EitherAnd, UnstableValue } from \"matrix-events-sdk\";\n\nimport {\n    ExtensibleAnyMessageEventContent,\n    REFERENCE_RELATION,\n    RelatesToRelationship,\n    TSNamespace,\n} from \"./extensible_events.ts\";\n\n/**\n * Identifier for a disclosed poll.\n */\nexport const M_POLL_KIND_DISCLOSED = new UnstableValue(\"m.poll.disclosed\", \"org.matrix.msc3381.poll.disclosed\");\n\n/**\n * Identifier for an undisclosed poll.\n */\nexport const M_POLL_KIND_UNDISCLOSED = new UnstableValue(\"m.poll.undisclosed\", \"org.matrix.msc3381.poll.undisclosed\");\n\n/**\n * Any poll kind.\n */\nexport type PollKind = TSNamespace<typeof M_POLL_KIND_DISCLOSED> | TSNamespace<typeof M_POLL_KIND_UNDISCLOSED> | string;\n\n/**\n * Known poll kind namespaces.\n */\nexport type KnownPollKind = typeof M_POLL_KIND_DISCLOSED | typeof M_POLL_KIND_UNDISCLOSED;\n\n/**\n * The namespaced value for m.poll.start\n */\nexport const M_POLL_START = new UnstableValue(\"m.poll.start\", \"org.matrix.msc3381.poll.start\");\n\n/**\n * The m.poll.start type within event content\n */\nexport type PollStartSubtype = {\n    question: ExtensibleAnyMessageEventContent;\n    kind: PollKind;\n    max_selections?: number; // default 1, always positive\n    answers: PollAnswer[];\n};\n\n/**\n * A poll answer.\n */\nexport type PollAnswer = ExtensibleAnyMessageEventContent & { id: string };\n\n/**\n * The event definition for an m.poll.start event (in content)\n */\nexport type PollStartEvent = EitherAnd<\n    { [M_POLL_START.name]: PollStartSubtype },\n    { [M_POLL_START.altName]: PollStartSubtype }\n>;\n\n/**\n * The content for an m.poll.start event\n */\nexport type PollStartEventContent = PollStartEvent & ExtensibleAnyMessageEventContent;\n\n/**\n * The namespaced value for m.poll.response\n */\nexport const M_POLL_RESPONSE = new UnstableValue(\"m.poll.response\", \"org.matrix.msc3381.poll.response\");\n\n/**\n * The m.poll.response type within event content\n */\nexport type PollResponseSubtype = {\n    answers: string[];\n};\n\n/**\n * The event definition for an m.poll.response event (in content)\n */\nexport type PollResponseEvent = EitherAnd<\n    { [M_POLL_RESPONSE.name]: PollResponseSubtype },\n    { [M_POLL_RESPONSE.altName]: PollResponseSubtype }\n>;\n\n/**\n * The content for an m.poll.response event\n */\nexport type PollResponseEventContent = PollResponseEvent & RelatesToRelationship<typeof REFERENCE_RELATION>;\n\n/**\n * The namespaced value for m.poll.end\n */\nexport const M_POLL_END = new UnstableValue(\"m.poll.end\", \"org.matrix.msc3381.poll.end\");\n\n/**\n * The event definition for an m.poll.end event (in content)\n */\nexport type PollEndEvent = EitherAnd<{ [M_POLL_END.name]: {} }, { [M_POLL_END.altName]: {} }>;\n\n/**\n * The content for an m.poll.end event\n */\nexport type PollEndEventContent = PollEndEvent &\n    RelatesToRelationship<typeof REFERENCE_RELATION> &\n    ExtensibleAnyMessageEventContent;\n","/*\nCopyright 2022 Šimon Brandner <simon.bra.ag@gmail.com>\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\n\nexport enum ReceiptType {\n    Read = \"m.read\",\n    FullyRead = \"m.fully_read\",\n    ReadPrivate = \"m.read.private\",\n}\n\nexport const MAIN_ROOM_TIMELINE = \"main\";\n\nexport interface Receipt {\n    ts: number;\n    thread_id?: string;\n}\n\nexport interface WrappedReceipt {\n    eventId: string;\n    data: Receipt;\n}\n\nexport interface CachedReceipt {\n    type: ReceiptType;\n    userId: string;\n    data: Receipt;\n}\n\nexport type ReceiptCache = Map<string, CachedReceipt[]>;\n\nexport interface ReceiptContent {\n    [eventId: string]: {\n        [key in ReceiptType | string]: {\n            [userId: string]: Receipt;\n        };\n    };\n}\n\n// We will only hold a synthetic receipt if we do not have a real receipt or the synthetic is newer.\n// map: receipt type → user Id → receipt\nexport type Receipts = Map<string, Map<string, [real: WrappedReceipt | null, synthetic: WrappedReceipt | null]>>;\n\nexport type CachedReceiptStructure = {\n    eventId: string;\n    receiptType: string | ReceiptType;\n    userId: string;\n    receipt: Receipt;\n    synthetic: boolean;\n};\n","/*\nCopyright 2022 The Matrix.org Foundation C.I.C.\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\n\nimport { ServerControlledNamespacedValue } from \"../NamespacedValue.ts\";\n\n/**\n * https://github.com/matrix-org/matrix-doc/pull/3773\n *\n * @experimental\n */\nexport const UNREAD_THREAD_NOTIFICATIONS = new ServerControlledNamespacedValue(\n    \"unread_thread_notifications\",\n    \"org.matrix.msc3773.unread_thread_notifications\",\n);\n","/*\nCopyright 2021 - 2022 The Matrix.org Foundation C.I.C.\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\n\nimport { Optional } from \"matrix-events-sdk/lib/types\";\n\n/**\n * Represents a simple Matrix namespaced value. This will assume that if a stable prefix\n * is provided that the stable prefix should be used when representing the identifier.\n */\nexport class NamespacedValue<S extends string, U extends string> {\n    // Stable is optional, but one of the two parameters is required, hence the weird-looking types.\n    // Goal is to to have developers explicitly say there is no stable value (if applicable).\n    public constructor(stable: S, unstable: U);\n    public constructor(stable: S, unstable?: U);\n    public constructor(stable: null | undefined, unstable: U);\n    public constructor(\n        public readonly stable?: S | null,\n        public readonly unstable?: U,\n    ) {\n        if (!this.unstable && !this.stable) {\n            throw new Error(\"One of stable or unstable values must be supplied\");\n        }\n    }\n\n    public get name(): U | S {\n        if (this.stable) {\n            return this.stable;\n        }\n        return this.unstable!;\n    }\n\n    public get altName(): U | S | null | undefined {\n        if (!this.stable) {\n            return null;\n        }\n        return this.unstable;\n    }\n\n    public get names(): (U | S)[] {\n        const names = [this.name];\n        const altName = this.altName;\n        if (altName) names.push(altName);\n        return names;\n    }\n\n    public matches(val: string): boolean {\n        return this.name === val || this.altName === val;\n    }\n\n    // this desperately wants https://github.com/microsoft/TypeScript/pull/26349 at the top level of the class\n    // so we can instantiate `NamespacedValue<string, _, _>` as a default type for that namespace.\n    public findIn<T>(obj: any): Optional<T> {\n        let val: T | undefined = undefined;\n        if (this.name) {\n            val = obj?.[this.name];\n        }\n        if (!val && this.altName) {\n            val = obj?.[this.altName];\n        }\n        return val;\n    }\n\n    public includedIn(arr: any[]): boolean {\n        let included = false;\n        if (this.name) {\n            included = arr.includes(this.name);\n        }\n        if (!included && this.altName) {\n            included = arr.includes(this.altName);\n        }\n        return included;\n    }\n}\n\nexport class ServerControlledNamespacedValue<S extends string, U extends string> extends NamespacedValue<S, U> {\n    private preferUnstable = false;\n\n    public setPreferUnstable(preferUnstable: boolean): void {\n        this.preferUnstable = preferUnstable;\n    }\n\n    public get name(): U | S {\n        if (this.stable && !this.preferUnstable) {\n            return this.stable;\n        }\n        return this.unstable!;\n    }\n}\n\n/**\n * Represents a namespaced value which prioritizes the unstable value over the stable\n * value.\n */\nexport class UnstableValue<S extends string, U extends string> extends NamespacedValue<S, U> {\n    // Note: Constructor difference is that `unstable` is *required*.\n    public constructor(stable: S, unstable: U) {\n        super(stable, unstable);\n        if (!this.unstable) {\n            throw new Error(\"Unstable value must be supplied\");\n        }\n    }\n\n    public get name(): U {\n        return this.unstable!;\n    }\n\n    public get altName(): S {\n        return this.stable!;\n    }\n}\n","/*\nCopyright 2017 - 2021 The Matrix.org Foundation C.I.C.\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\n\nimport { LocalIndexedDBStoreBackend } from \"./indexeddb-local-backend.ts\";\nimport { logger } from \"../logger.ts\";\n\ninterface ICmd {\n    command: string;\n    seq: number;\n    args: any[];\n}\n\n/**\n * This class lives in the webworker and drives a LocalIndexedDBStoreBackend\n * controlled by messages from the main process.\n *\n * @example\n * It should be instantiated by a web worker script provided by the application\n * in a script, for example:\n * ```\n * import {IndexedDBStoreWorker} from 'matrix-js-sdk/lib/indexeddb-worker.js';\n * const remoteWorker = new IndexedDBStoreWorker(postMessage);\n * onmessage = remoteWorker.onMessage;\n * ```\n *\n * Note that it is advisable to import this class by referencing the file directly to\n * avoid a dependency on the whole js-sdk.\n *\n */\nexport class IndexedDBStoreWorker {\n    private backend?: LocalIndexedDBStoreBackend;\n\n    /**\n     * @param postMessage - The web worker postMessage function that\n     * should be used to communicate back to the main script.\n     */\n    public constructor(private readonly postMessage: InstanceType<typeof Worker>[\"postMessage\"]) {}\n\n    private onClose = (): void => {\n        this.postMessage.call(null, {\n            command: \"closed\",\n        });\n    };\n\n    /**\n     * Passes a message event from the main script into the class. This method\n     * can be directly assigned to the web worker `onmessage` variable.\n     *\n     * @param ev - The message event\n     */\n    public onMessage = (ev: MessageEvent): void => {\n        const msg: ICmd = ev.data;\n        let prom: Promise<any> | undefined;\n\n        switch (msg.command) {\n            case \"setupWorker\":\n                // this is the 'indexedDB' global (where global != window\n                // because it's a web worker and there is no window).\n                this.backend = new LocalIndexedDBStoreBackend(indexedDB, msg.args[0]);\n                prom = Promise.resolve();\n                break;\n            case \"connect\":\n                prom = this.backend?.connect(this.onClose);\n                break;\n            case \"isNewlyCreated\":\n                prom = this.backend?.isNewlyCreated();\n                break;\n            case \"clearDatabase\":\n                prom = this.backend?.clearDatabase();\n                break;\n            case \"getSavedSync\":\n                prom = this.backend?.getSavedSync(false);\n                break;\n            case \"setSyncData\":\n                prom = this.backend?.setSyncData(msg.args[0]);\n                break;\n            case \"syncToDatabase\":\n                prom = this.backend?.syncToDatabase(msg.args[0]);\n                break;\n            case \"getUserPresenceEvents\":\n                prom = this.backend?.getUserPresenceEvents();\n                break;\n            case \"getNextBatchToken\":\n                prom = this.backend?.getNextBatchToken();\n                break;\n            case \"getOutOfBandMembers\":\n                prom = this.backend?.getOutOfBandMembers(msg.args[0]);\n                break;\n            case \"clearOutOfBandMembers\":\n                prom = this.backend?.clearOutOfBandMembers(msg.args[0]);\n                break;\n            case \"setOutOfBandMembers\":\n                prom = this.backend?.setOutOfBandMembers(msg.args[0], msg.args[1]);\n                break;\n            case \"getClientOptions\":\n                prom = this.backend?.getClientOptions();\n                break;\n            case \"storeClientOptions\":\n                prom = this.backend?.storeClientOptions(msg.args[0]);\n                break;\n            case \"saveToDeviceBatches\":\n                prom = this.backend?.saveToDeviceBatches(msg.args[0]);\n                break;\n            case \"getOldestToDeviceBatch\":\n                prom = this.backend?.getOldestToDeviceBatch();\n                break;\n            case \"removeToDeviceBatch\":\n                prom = this.backend?.removeToDeviceBatch(msg.args[0]);\n                break;\n        }\n\n        if (prom === undefined) {\n            this.postMessage({\n                command: \"cmd_fail\",\n                seq: msg.seq,\n                // Can't be an Error because they're not structured cloneable\n                error: \"Unrecognised command\",\n            });\n            return;\n        }\n\n        prom.then(\n            (ret) => {\n                this.postMessage.call(null, {\n                    command: \"cmd_success\",\n                    seq: msg.seq,\n                    result: ret,\n                });\n            },\n            (err) => {\n                logger.error(\"Error running command: \" + msg.command, err);\n                this.postMessage.call(null, {\n                    command: \"cmd_fail\",\n                    seq: msg.seq,\n                    // Just send a string because Error objects aren't cloneable\n                    error: {\n                        message: err.message,\n                        name: err.name,\n                    },\n                });\n            },\n        );\n    };\n}\n","/*\nCopyright 2018 André Jaenisch\nCopyright 2019, 2021 The Matrix.org Foundation C.I.C.\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\n\nimport loglevel from \"loglevel\";\n\n/** Logger interface used within the js-sdk codebase */\nexport interface Logger extends BaseLogger {\n    /**\n     * Create a child logger.\n     *\n     * @param namespace - name to add to the current logger to generate the child. Some implementations of `Logger`\n     *    use this as a prefix; others use a different mechanism.\n     */\n    getChild(namespace: string): Logger;\n}\n\n/** The basic interface for a logger which doesn't support children */\nexport interface BaseLogger {\n    /**\n     * Output trace message to the logger, with stack trace.\n     *\n     * @param msg - Data to log.\n     */\n    trace(...msg: any[]): void;\n\n    /**\n     * Output debug message to the logger.\n     *\n     * @param msg - Data to log.\n     */\n    debug(...msg: any[]): void;\n\n    /**\n     * Output info message to the logger.\n     *\n     * @param msg - Data to log.\n     */\n    info(...msg: any[]): void;\n\n    /**\n     * Output warn message to the logger.\n     *\n     * @param msg - Data to log.\n     */\n    warn(...msg: any[]): void;\n\n    /**\n     * Output error message to the logger.\n     *\n     * @param msg - Data to log.\n     */\n    error(...msg: any[]): void;\n}\n\n// This is to demonstrate, that you can use any namespace you want.\n// Namespaces allow you to turn on/off the logging for specific parts of the\n// application.\n// An idea would be to control this via an environment variable (on Node.js).\n// See https://www.npmjs.com/package/debug to see how this could be implemented\n// Part of #332 is introducing a logging library in the first place.\nconst DEFAULT_NAMESPACE = \"matrix\";\n\n// because rageshakes in react-sdk hijack the console log, also at module load time,\n// initializing the logger here races with the initialization of rageshakes.\n// to avoid the issue, we override the methodFactory of loglevel that binds to the\n// console methods at initialization time by a factory that looks up the console methods\n// when logging so we always get the current value of console methods.\nloglevel.methodFactory = function (methodName, logLevel, loggerName) {\n    return function (this: PrefixedLogger, ...args): void {\n        /* eslint-disable @typescript-eslint/no-invalid-this */\n        if (this.prefix) {\n            args.unshift(this.prefix);\n        }\n        /* eslint-enable @typescript-eslint/no-invalid-this */\n        const supportedByConsole =\n            methodName === \"error\" ||\n            methodName === \"warn\" ||\n            methodName === \"trace\" ||\n            methodName === \"info\" ||\n            methodName === \"debug\";\n        /* eslint-disable no-console */\n        if (supportedByConsole) {\n            return console[methodName](...args);\n        } else {\n            return console.log(...args);\n        }\n        /* eslint-enable no-console */\n    };\n};\n\n/**\n * Implementation of {@link Logger} based on `loglevel`.\n *\n * @deprecated this shouldn't be public; prefer {@link Logger}.\n */\nexport interface PrefixedLogger extends loglevel.Logger, Logger {\n    /** @deprecated prefer {@link Logger.getChild} */\n    withPrefix: (prefix: string) => PrefixedLogger;\n\n    /** @deprecated internal property */\n    prefix: string;\n}\n\n/** Internal utility function to turn a `loglevel.Logger` into a `PrefixedLogger` */\nfunction extendLogger(logger: loglevel.Logger): void {\n    const prefixedLogger = <PrefixedLogger>logger;\n    prefixedLogger.getChild = prefixedLogger.withPrefix = function (prefix: string): PrefixedLogger {\n        const existingPrefix = this.prefix || \"\";\n        return getPrefixedLogger(existingPrefix + prefix);\n    };\n}\n\nfunction getPrefixedLogger(prefix: string): PrefixedLogger {\n    const prefixLogger = loglevel.getLogger(`${DEFAULT_NAMESPACE}-${prefix}`) as PrefixedLogger;\n    if (prefixLogger.prefix !== prefix) {\n        // Only do this setup work the first time through, as loggers are saved by name.\n        extendLogger(prefixLogger);\n        prefixLogger.prefix = prefix;\n        prefixLogger.setLevel(loglevel.levels.DEBUG, false);\n    }\n    return prefixLogger;\n}\n\n/**\n * Drop-in replacement for `console` using {@link https://www.npmjs.com/package/loglevel|loglevel}.\n * Can be tailored down to specific use cases if needed.\n */\nexport const logger = loglevel.getLogger(DEFAULT_NAMESPACE) as PrefixedLogger;\nlogger.setLevel(loglevel.levels.DEBUG, false);\nextendLogger(logger);\n\n/**\n * A \"span\" for grouping related log lines together.\n *\n * The current implementation just adds the name at the start of each log line.\n *\n * This offers a lighter-weight alternative to 'child' loggers returned by {@link Logger#getChild}. In particular,\n * it's not possible to apply individual filters to the LogSpan such as setting the verbosity level. On the other hand,\n * no reference to the LogSpan is retained in the logging framework, so it is safe to make lots of them over the course\n * of an application's life and just drop references to them when the job is done.\n */\nexport class LogSpan implements BaseLogger {\n    private readonly name;\n\n    public constructor(\n        private readonly parent: BaseLogger,\n        name: string,\n    ) {\n        this.name = name + \":\";\n    }\n\n    public trace(...msg: any[]): void {\n        this.parent.trace(this.name, ...msg);\n    }\n\n    public debug(...msg: any[]): void {\n        this.parent.debug(this.name, ...msg);\n    }\n\n    public info(...msg: any[]): void {\n        this.parent.info(this.name, ...msg);\n    }\n\n    public warn(...msg: any[]): void {\n        this.parent.warn(this.name, ...msg);\n    }\n\n    public error(...msg: any[]): void {\n        this.parent.error(this.name, ...msg);\n    }\n}\n","/*\nCopyright 2023 The Matrix.org Foundation C.I.C.\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\n\nimport { IMinimalEvent } from \"./sync-accumulator.ts\";\nimport { EventType } from \"./@types/event.ts\";\nimport { isSupportedReceiptType, MapWithDefault, recursiveMapToObject } from \"./utils.ts\";\nimport { IContent } from \"./models/event.ts\";\nimport { ReceiptContent, ReceiptType } from \"./@types/read_receipts.ts\";\n\ninterface AccumulatedReceipt {\n    data: IMinimalEvent;\n    type: ReceiptType;\n    eventId: string;\n}\n\n/**\n * Summarises the read receipts within a room. Used by the sync accumulator.\n *\n * Given receipts for users, picks the most recently-received one and provides\n * the results in a new fake receipt event returned from\n * buildAccumulatedReceiptEvent().\n *\n * Handles unthreaded receipts and receipts in each thread separately, so the\n * returned event contains the most recently received unthreaded receipt, and\n * the most recently received receipt in each thread.\n */\nexport class ReceiptAccumulator {\n    /** user_id -\\> most-recently-received unthreaded receipt */\n    private unthreadedReadReceipts: Map<string, AccumulatedReceipt> = new Map();\n\n    /** thread_id -\\> user_id -\\> most-recently-received receipt for this thread */\n    private threadedReadReceipts: MapWithDefault<string, Map<string, AccumulatedReceipt>> = new MapWithDefault(\n        () => new Map(),\n    );\n\n    /**\n     * Provide an unthreaded receipt for this user. Overwrites any other\n     * unthreaded receipt we have for this user.\n     */\n    private setUnthreaded(userId: string, receipt: AccumulatedReceipt): void {\n        this.unthreadedReadReceipts.set(userId, receipt);\n    }\n\n    /**\n     * Provide a receipt for this user in this thread. Overwrites any other\n     * receipt we have for this user in this thread.\n     */\n    private setThreaded(threadId: string, userId: string, receipt: AccumulatedReceipt): void {\n        this.threadedReadReceipts.getOrCreate(threadId).set(userId, receipt);\n    }\n\n    /**\n     * @returns an iterator of pairs of [userId, AccumulatedReceipt] - all the\n     *          most recently-received unthreaded receipts for each user.\n     */\n    private allUnthreaded(): IterableIterator<[string, AccumulatedReceipt]> {\n        return this.unthreadedReadReceipts.entries();\n    }\n\n    /**\n     * @returns an iterator of pairs of [userId, AccumulatedReceipt] - all the\n     *          most recently-received threaded receipts for each user, in all\n     *          threads.\n     */\n    private *allThreaded(): IterableIterator<[string, AccumulatedReceipt]> {\n        for (const receiptsForThread of this.threadedReadReceipts.values()) {\n            for (const e of receiptsForThread.entries()) {\n                yield e;\n            }\n        }\n    }\n\n    /**\n     * Given a list of ephemeral events, find the receipts and store the\n     * relevant ones to be returned later from buildAccumulatedReceiptEvent().\n     */\n    public consumeEphemeralEvents(events: IMinimalEvent[] | undefined): void {\n        events?.forEach((e) => {\n            if (e.type !== EventType.Receipt || !e.content) {\n                // This means we'll drop unknown ephemeral events but that\n                // seems okay.\n                return;\n            }\n\n            // Handle m.receipt events. They clobber based on:\n            //   (user_id, receipt_type)\n            // but they are keyed in the event as:\n            //   content:{ $event_id: { $receipt_type: { $user_id: {json} }}}\n            // so store them in the former so we can accumulate receipt deltas\n            // quickly and efficiently (we expect a lot of them). Fold the\n            // receipt type into the key name since we only have 1 at the\n            // moment (m.read) and nested JSON objects are slower and more\n            // of a hassle to work with. We'll inflate this back out when\n            // getJSON() is called.\n            Object.keys(e.content).forEach((eventId) => {\n                Object.entries<ReceiptContent>(e.content[eventId]).forEach(([key, value]) => {\n                    if (!isSupportedReceiptType(key)) return;\n\n                    for (const userId of Object.keys(value)) {\n                        const data = e.content[eventId][key][userId];\n\n                        const receipt = {\n                            data: e.content[eventId][key][userId],\n                            type: key as ReceiptType,\n                            eventId,\n                        };\n\n                        // In a world that supports threads, read receipts normally have\n                        // a `thread_id` which is either the thread they belong in or\n                        // `MAIN_ROOM_TIMELINE`, so we normally use `setThreaded(...)`\n                        // here. The `MAIN_ROOM_TIMELINE` is just treated as another\n                        // thread.\n                        //\n                        // We still encounter read receipts that are \"unthreaded\"\n                        // (missing the `thread_id` property). These come from clients\n                        // that don't support threads, and from threaded clients that\n                        // are doing a \"Mark room as read\" operation. Unthreaded\n                        // receipts mark everything \"before\" them as read, in all\n                        // threads, where \"before\" means in Sync Order i.e. the order\n                        // the events were received from the homeserver in a sync.\n                        // [Note: we have some bugs where we use timestamp order instead\n                        // of Sync Order, because we don't correctly remember the Sync\n                        // Order. See #3325.]\n                        //\n                        // Calling the wrong method will cause incorrect behavior like\n                        // messages re-appearing as \"new\" when you already read them\n                        // previously.\n                        if (!data.thread_id) {\n                            this.setUnthreaded(userId, receipt);\n                        } else {\n                            this.setThreaded(data.thread_id, userId, receipt);\n                        }\n                    }\n                });\n            });\n        });\n    }\n\n    /**\n     * Build a receipt event that contains all relevant information for this\n     * room, taking the most recently received receipt for each user in an\n     * unthreaded context, and in each thread.\n     */\n    public buildAccumulatedReceiptEvent(roomId: string): IMinimalEvent | null {\n        const receiptEvent: IMinimalEvent = {\n            type: EventType.Receipt,\n            room_id: roomId,\n            content: {\n                // $event_id: { \"m.read\": { $user_id: $json } }\n            } as IContent,\n        };\n\n        const receiptEventContent: MapWithDefault<\n            string,\n            MapWithDefault<ReceiptType, Map<string, object>>\n        > = new MapWithDefault(() => new MapWithDefault(() => new Map()));\n\n        for (const [userId, receiptData] of this.allUnthreaded()) {\n            receiptEventContent\n                .getOrCreate(receiptData.eventId)\n                .getOrCreate(receiptData.type)\n                .set(userId, receiptData.data);\n        }\n\n        for (const [userId, receiptData] of this.allThreaded()) {\n            receiptEventContent\n                .getOrCreate(receiptData.eventId)\n                .getOrCreate(receiptData.type)\n                .set(userId, receiptData.data);\n        }\n\n        receiptEvent.content = recursiveMapToObject(receiptEventContent);\n\n        return receiptEventContent.size > 0 ? receiptEvent : null;\n    }\n}\n","/*\nCopyright 2017 - 2023 The Matrix.org Foundation C.I.C.\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\n\n/**\n * This is an internal module. See {@link SyncAccumulator} for the public class.\n */\n\nimport { logger } from \"./logger.ts\";\nimport { deepCopy } from \"./utils.ts\";\nimport { IContent, IUnsigned } from \"./models/event.ts\";\nimport { IRoomSummary } from \"./models/room-summary.ts\";\nimport { EventType } from \"./@types/event.ts\";\nimport { UNREAD_THREAD_NOTIFICATIONS } from \"./@types/sync.ts\";\nimport { ReceiptAccumulator } from \"./receipt-accumulator.ts\";\n\ninterface IOpts {\n    /**\n     * The ideal maximum number of timeline entries to keep in the sync response.\n     * This is best-effort, as clients do not always have a back-pagination token for each event,\n     * so it's possible there may be slightly *less* than this value. There will never be more.\n     * This cannot be 0 or else it makes it impossible to scroll back in a room.\n     * Default: 50.\n     */\n    maxTimelineEntries?: number;\n}\n\nexport interface IMinimalEvent {\n    content: IContent;\n    type: EventType | string;\n    room_id?: string;\n    unsigned?: IUnsigned;\n}\n\nexport interface IEphemeral {\n    events: IMinimalEvent[];\n}\n\n/* eslint-disable camelcase */\ninterface UnreadNotificationCounts {\n    highlight_count?: number;\n    notification_count?: number;\n}\n\nexport interface IRoomEvent extends IMinimalEvent {\n    event_id: string;\n    sender: string;\n    origin_server_ts: number;\n}\n\nexport interface IStateEvent extends IRoomEvent {\n    prev_content?: IContent;\n    state_key: string;\n}\n\ninterface IState {\n    events: IStateEvent[];\n}\n\nexport interface ITimeline {\n    events: Array<IRoomEvent | IStateEvent>;\n    limited?: boolean;\n    prev_batch: string | null;\n}\n\nexport interface IJoinedRoom {\n    \"summary\": IRoomSummary;\n    \"state\": IState;\n    \"timeline\": ITimeline;\n    \"ephemeral\": IEphemeral;\n    \"account_data\": IAccountData;\n    \"unread_notifications\": UnreadNotificationCounts;\n    \"unread_thread_notifications\"?: Record<string, UnreadNotificationCounts>;\n    \"org.matrix.msc3773.unread_thread_notifications\"?: Record<string, UnreadNotificationCounts>;\n}\n\nexport interface IStrippedState {\n    content: IContent;\n    state_key: string;\n    type: EventType | string;\n    sender: string;\n}\n\nexport interface IInviteState {\n    events: IStrippedState[];\n}\n\nexport interface IKnockState {\n    events: IStrippedState[];\n}\n\nexport interface IInvitedRoom {\n    invite_state: IInviteState;\n}\n\nexport interface ILeftRoom {\n    state: IState;\n    timeline: ITimeline;\n    account_data: IAccountData;\n}\n\nexport interface IKnockedRoom {\n    knock_state: IKnockState;\n}\n\nexport interface IRooms {\n    [Category.Join]: Record<string, IJoinedRoom>;\n    [Category.Invite]: Record<string, IInvitedRoom>;\n    [Category.Leave]: Record<string, ILeftRoom>;\n    [Category.Knock]: Record<string, IKnockedRoom>;\n}\n\ninterface IPresence {\n    events: IMinimalEvent[];\n}\n\ninterface IAccountData {\n    events: IMinimalEvent[];\n}\n\nexport interface IToDeviceEvent {\n    content: IContent;\n    sender: string;\n    type: string;\n}\n\ninterface IToDevice {\n    events: IToDeviceEvent[];\n}\n\nexport interface IDeviceLists {\n    changed?: string[];\n    left?: string[];\n}\n\nexport interface ISyncResponse {\n    \"next_batch\": string;\n    \"rooms\": IRooms;\n    \"presence\"?: IPresence;\n    \"account_data\": IAccountData;\n    \"to_device\"?: IToDevice;\n    \"device_lists\"?: IDeviceLists;\n    \"device_one_time_keys_count\"?: Record<string, number>;\n\n    \"device_unused_fallback_key_types\"?: string[];\n    \"org.matrix.msc2732.device_unused_fallback_key_types\"?: string[];\n}\n/* eslint-enable camelcase */\n\nexport enum Category {\n    Invite = \"invite\",\n    Leave = \"leave\",\n    Join = \"join\",\n    Knock = \"knock\",\n}\n\ninterface IRoom {\n    _currentState: { [eventType: string]: { [stateKey: string]: IStateEvent } };\n    _timeline: {\n        event: IRoomEvent | IStateEvent;\n        token: string | null;\n    }[];\n    _summary: Partial<IRoomSummary>;\n    _accountData: { [eventType: string]: IMinimalEvent };\n    _unreadNotifications: Partial<UnreadNotificationCounts>;\n    _unreadThreadNotifications?: Record<string, Partial<UnreadNotificationCounts>>;\n    _receipts: ReceiptAccumulator;\n}\n\nexport interface ISyncData {\n    nextBatch: string;\n    accountData: IMinimalEvent[];\n    roomsData: IRooms;\n}\n\ntype TaggedEvent = IRoomEvent & { _localTs?: number };\n\nfunction isTaggedEvent(event: IRoomEvent): event is TaggedEvent {\n    return \"_localTs\" in event && event[\"_localTs\"] !== undefined;\n}\n\n/**\n * The purpose of this class is to accumulate /sync responses such that a\n * complete \"initial\" JSON response can be returned which accurately represents\n * the sum total of the /sync responses accumulated to date. It only handles\n * room data: that is, everything under the \"rooms\" top-level key.\n *\n * This class is used when persisting room data so a complete /sync response can\n * be loaded from disk and incremental syncs can be performed on the server,\n * rather than asking the server to do an initial sync on startup.\n */\nexport class SyncAccumulator {\n    private accountData: Record<string, IMinimalEvent> = {}; // $event_type: Object\n    private inviteRooms: Record<string, IInvitedRoom> = {}; // $roomId: { ... sync 'invite' json data ... }\n    private knockRooms: Record<string, IKnockedRoom> = {}; // $roomId: { ... sync 'knock' json data ... }\n    private joinRooms: { [roomId: string]: IRoom } = {};\n    // the /sync token which corresponds to the last time rooms were\n    // accumulated. We remember this so that any caller can obtain a\n    // coherent /sync response and know at what point they should be\n    // streaming from without losing events.\n    private nextBatch: string | null = null;\n\n    public constructor(private readonly opts: IOpts = {}) {\n        this.opts.maxTimelineEntries = this.opts.maxTimelineEntries || 50;\n    }\n\n    public accumulate(syncResponse: ISyncResponse, fromDatabase = false): void {\n        this.accumulateRooms(syncResponse, fromDatabase);\n        this.accumulateAccountData(syncResponse);\n        this.nextBatch = syncResponse.next_batch;\n    }\n\n    private accumulateAccountData(syncResponse: ISyncResponse): void {\n        if (!syncResponse.account_data || !syncResponse.account_data.events) {\n            return;\n        }\n        // Clobbers based on event type.\n        syncResponse.account_data.events.forEach((e) => {\n            this.accountData[e.type] = e;\n        });\n    }\n\n    /**\n     * Accumulate incremental /sync room data.\n     * @param syncResponse - the complete /sync JSON\n     * @param fromDatabase - True if the sync response is one saved to the database\n     */\n    private accumulateRooms(syncResponse: ISyncResponse, fromDatabase = false): void {\n        if (!syncResponse.rooms) {\n            return;\n        }\n        if (syncResponse.rooms.invite) {\n            Object.keys(syncResponse.rooms.invite).forEach((roomId) => {\n                this.accumulateRoom(roomId, Category.Invite, syncResponse.rooms.invite[roomId], fromDatabase);\n            });\n        }\n        if (syncResponse.rooms.join) {\n            Object.keys(syncResponse.rooms.join).forEach((roomId) => {\n                this.accumulateRoom(roomId, Category.Join, syncResponse.rooms.join[roomId], fromDatabase);\n            });\n        }\n        if (syncResponse.rooms.leave) {\n            Object.keys(syncResponse.rooms.leave).forEach((roomId) => {\n                this.accumulateRoom(roomId, Category.Leave, syncResponse.rooms.leave[roomId], fromDatabase);\n            });\n        }\n        if (syncResponse.rooms.knock) {\n            Object.keys(syncResponse.rooms.knock).forEach((roomId) => {\n                this.accumulateRoom(roomId, Category.Knock, syncResponse.rooms.knock[roomId], fromDatabase);\n            });\n        }\n    }\n\n    private accumulateRoom(roomId: string, category: Category.Invite, data: IInvitedRoom, fromDatabase: boolean): void;\n    private accumulateRoom(roomId: string, category: Category.Join, data: IJoinedRoom, fromDatabase: boolean): void;\n    private accumulateRoom(roomId: string, category: Category.Leave, data: ILeftRoom, fromDatabase: boolean): void;\n    private accumulateRoom(roomId: string, category: Category.Knock, data: IKnockedRoom, fromDatabase: boolean): void;\n    private accumulateRoom(roomId: string, category: Category, data: any, fromDatabase = false): void {\n        // Valid /sync state transitions\n        //       +--------+ <======+            1: Accept an invite\n        //   +== | INVITE |        | (5)        2: Leave a room\n        //   |   +--------+ =====+ |            3: Join a public room previously\n        //   |(1)            (4) | |               left (handle as if new room)\n        //   V         (2)       V |            4: Reject an invite\n        // +------+ ========> +--------+         5: Invite to a room previously\n        // | JOIN |    (3)    | LEAVE* |            left (handle as if new room)\n        // +------+ <======== +--------+\n        //\n        // * equivalent to \"no state\"\n        switch (category) {\n            case Category.Invite: // (5)\n                if (this.knockRooms[roomId]) {\n                    // was previously knock, now invite, need to delete knock state\n                    delete this.knockRooms[roomId];\n                }\n                this.accumulateInviteState(roomId, data as IInvitedRoom);\n                break;\n\n            case Category.Knock:\n                this.accumulateKnockState(roomId, data as IKnockedRoom);\n                break;\n\n            case Category.Join:\n                if (this.inviteRooms[roomId]) {\n                    // (1)\n                    // was previously invite, now join. We expect /sync to give\n                    // the entire state and timeline on 'join', so delete previous\n                    // invite state\n                    delete this.inviteRooms[roomId];\n                }\n                // (3)\n                this.accumulateJoinState(roomId, data as IJoinedRoom, fromDatabase);\n                break;\n\n            case Category.Leave:\n                if (this.knockRooms[roomId]) {\n                    // delete knock state on leave\n                    delete this.knockRooms[roomId];\n                } else if (this.inviteRooms[roomId]) {\n                    // (4)\n                    delete this.inviteRooms[roomId];\n                } else {\n                    // (2)\n                    delete this.joinRooms[roomId];\n                }\n                break;\n\n            default:\n                logger.error(\"Unknown cateogory: \", category);\n        }\n    }\n\n    private accumulateInviteState(roomId: string, data: IInvitedRoom): void {\n        if (!data.invite_state || !data.invite_state.events) {\n            // no new data\n            return;\n        }\n        if (!this.inviteRooms[roomId]) {\n            this.inviteRooms[roomId] = {\n                invite_state: data.invite_state,\n            };\n            return;\n        }\n        // accumulate extra keys for invite->invite transitions\n        // clobber based on event type / state key\n        // We expect invite_state to be small, so just loop over the events\n        const currentData = this.inviteRooms[roomId];\n        data.invite_state.events.forEach((e) => {\n            let hasAdded = false;\n            for (let i = 0; i < currentData.invite_state.events.length; i++) {\n                const current = currentData.invite_state.events[i];\n                if (current.type === e.type && current.state_key == e.state_key) {\n                    currentData.invite_state.events[i] = e; // update\n                    hasAdded = true;\n                }\n            }\n            if (!hasAdded) {\n                currentData.invite_state.events.push(e);\n            }\n        });\n    }\n\n    private accumulateKnockState(roomId: string, data: IKnockedRoom): void {\n        if (!data.knock_state || !data.knock_state.events) {\n            // no new data\n            return;\n        }\n        if (!this.knockRooms[roomId]) {\n            this.knockRooms[roomId] = {\n                knock_state: data.knock_state,\n            };\n            return;\n        }\n        // accumulate extra keys\n        // clobber based on event type / state key\n        // We expect knock_state to be small, so just loop over the events\n        const currentData = this.knockRooms[roomId];\n        data.knock_state.events.forEach((e) => {\n            let hasAdded = false;\n            for (let i = 0; i < currentData.knock_state.events.length; i++) {\n                const current = currentData.knock_state.events[i];\n                if (current.type === e.type && current.state_key == e.state_key) {\n                    currentData.knock_state.events[i] = e; // update\n                    hasAdded = true;\n                }\n            }\n            if (!hasAdded) {\n                currentData.knock_state.events.push(e);\n            }\n        });\n    }\n\n    // Accumulate timeline and state events in a room.\n    private accumulateJoinState(roomId: string, data: IJoinedRoom, fromDatabase = false): void {\n        // We expect this function to be called a lot (every /sync) so we want\n        // this to be fast. /sync stores events in an array but we often want\n        // to clobber based on type/state_key. Rather than convert arrays to\n        // maps all the time, just keep private maps which contain\n        // the actual current accumulated sync state, and array-ify it when\n        // getJSON() is called.\n\n        // State resolution:\n        // The 'state' key is the delta from the previous sync (or start of time\n        // if no token was supplied), to the START of the timeline. To obtain\n        // the current state, we need to \"roll forward\" state by reading the\n        // timeline. We want to store the current state so we can drop events\n        // out the end of the timeline based on opts.maxTimelineEntries.\n        //\n        //      'state'     'timeline'     current state\n        // |-------x<======================>x\n        //          T   I   M   E\n        //\n        // When getJSON() is called, we 'roll back' the current state by the\n        // number of entries in the timeline to work out what 'state' should be.\n\n        // Back-pagination:\n        // On an initial /sync, the server provides a back-pagination token for\n        // the start of the timeline. When /sync deltas come down, they also\n        // include back-pagination tokens for the start of the timeline. This\n        // means not all events in the timeline have back-pagination tokens, as\n        // it is only the ones at the START of the timeline which have them.\n        // In order for us to have a valid timeline (and back-pagination token\n        // to match), we need to make sure that when we remove old timeline\n        // events, that we roll forward to an event which has a back-pagination\n        // token. This means we can't keep a strict sliding-window based on\n        // opts.maxTimelineEntries, and we may have a few less. We should never\n        // have more though, provided that the /sync limit is less than or equal\n        // to opts.maxTimelineEntries.\n\n        if (!this.joinRooms[roomId]) {\n            // Create truly empty objects so event types of 'hasOwnProperty' and co\n            // don't cause this code to break.\n            this.joinRooms[roomId] = {\n                _currentState: Object.create(null),\n                _timeline: [],\n                _accountData: Object.create(null),\n                _unreadNotifications: {},\n                _unreadThreadNotifications: {},\n                _summary: {},\n                _receipts: new ReceiptAccumulator(),\n            };\n        }\n        const currentData = this.joinRooms[roomId];\n\n        if (data.account_data && data.account_data.events) {\n            // clobber based on type\n            data.account_data.events.forEach((e) => {\n                currentData._accountData[e.type] = e;\n            });\n        }\n\n        // these probably clobber, spec is unclear.\n        if (data.unread_notifications) {\n            currentData._unreadNotifications = data.unread_notifications;\n        }\n        currentData._unreadThreadNotifications =\n            data[UNREAD_THREAD_NOTIFICATIONS.stable!] ?? data[UNREAD_THREAD_NOTIFICATIONS.unstable!] ?? undefined;\n\n        if (data.summary) {\n            const HEROES_KEY = \"m.heroes\";\n            const INVITED_COUNT_KEY = \"m.invited_member_count\";\n            const JOINED_COUNT_KEY = \"m.joined_member_count\";\n\n            const acc = currentData._summary;\n            const sum = data.summary;\n            acc[HEROES_KEY] = sum[HEROES_KEY] ?? acc[HEROES_KEY];\n            acc[JOINED_COUNT_KEY] = sum[JOINED_COUNT_KEY] ?? acc[JOINED_COUNT_KEY];\n            acc[INVITED_COUNT_KEY] = sum[INVITED_COUNT_KEY] ?? acc[INVITED_COUNT_KEY];\n        }\n\n        // We purposefully do not persist m.typing events.\n        // Technically you could refresh a browser before the timer on a\n        // typing event is up, so it'll look like you aren't typing when\n        // you really still are. However, the alternative is worse. If\n        // we do persist typing events, it will look like people are\n        // typing forever until someone really does start typing (which\n        // will prompt Synapse to send down an actual m.typing event to\n        // clobber the one we persisted).\n\n        // Persist the receipts\n        currentData._receipts.consumeEphemeralEvents(data.ephemeral?.events);\n\n        // if we got a limited sync, we need to remove all timeline entries or else\n        // we will have gaps in the timeline.\n        if (data.timeline && data.timeline.limited) {\n            currentData._timeline = [];\n        }\n\n        // Work out the current state. The deltas need to be applied in the order:\n        // - existing state which didn't come down /sync.\n        // - State events under the 'state' key.\n        // - State events in the 'timeline'.\n        data.state?.events?.forEach((e) => {\n            setState(currentData._currentState, e);\n        });\n        data.timeline?.events?.forEach((e, index) => {\n            // this nops if 'e' isn't a state event\n            setState(currentData._currentState, e);\n            // append the event to the timeline. The back-pagination token\n            // corresponds to the first event in the timeline\n            let transformedEvent: TaggedEvent;\n            if (!fromDatabase) {\n                transformedEvent = Object.assign({}, e);\n                if (transformedEvent.unsigned !== undefined) {\n                    transformedEvent.unsigned = Object.assign({}, transformedEvent.unsigned);\n                }\n                const age = e.unsigned?.age;\n                if (age !== undefined) transformedEvent._localTs = Date.now() - age;\n            } else {\n                transformedEvent = e;\n            }\n\n            currentData._timeline.push({\n                event: transformedEvent,\n                token: index === 0 ? (data.timeline.prev_batch ?? null) : null,\n            });\n        });\n\n        // attempt to prune the timeline by jumping between events which have\n        // pagination tokens.\n        if (currentData._timeline.length > this.opts.maxTimelineEntries!) {\n            const startIndex = currentData._timeline.length - this.opts.maxTimelineEntries!;\n            for (let i = startIndex; i < currentData._timeline.length; i++) {\n                if (currentData._timeline[i].token) {\n                    // keep all events after this, including this one\n                    currentData._timeline = currentData._timeline.slice(i, currentData._timeline.length);\n                    break;\n                }\n            }\n        }\n    }\n\n    /**\n     * Return everything under the 'rooms' key from a /sync response which\n     * represents all room data that should be stored. This should be paired\n     * with the sync token which represents the most recent /sync response\n     * provided to accumulate().\n     * @param forDatabase - True to generate a sync to be saved to storage\n     * @returns An object with a \"nextBatch\", \"roomsData\" and \"accountData\"\n     * keys.\n     * The \"nextBatch\" key is a string which represents at what point in the\n     * /sync stream the accumulator reached. This token should be used when\n     * restarting a /sync stream at startup. Failure to do so can lead to missing\n     * events. The \"roomsData\" key is an Object which represents the entire\n     * /sync response from the 'rooms' key onwards. The \"accountData\" key is\n     * a list of raw events which represent global account data.\n     */\n    public getJSON(forDatabase = false): ISyncData {\n        const data: IRooms = {\n            join: {},\n            invite: {},\n            knock: {},\n            // always empty. This is set by /sync when a room was previously\n            // in 'invite' or 'join'. On fresh startup, the client won't know\n            // about any previous room being in 'invite' or 'join' so we can\n            // just omit mentioning it at all, even if it has previously come\n            // down /sync.\n            // The notable exception is when a client is kicked or banned:\n            // we may want to hold onto that room so the client can clearly see\n            // why their room has disappeared. We don't persist it though because\n            // it is unclear *when* we can safely remove the room from the DB.\n            // Instead, we assume that if you're loading from the DB, you've\n            // refreshed the page, which means you've seen the kick/ban already.\n            leave: {},\n        };\n        Object.keys(this.inviteRooms).forEach((roomId) => {\n            data.invite[roomId] = this.inviteRooms[roomId];\n        });\n        Object.keys(this.knockRooms).forEach((roomId) => {\n            data.knock[roomId] = this.knockRooms[roomId];\n        });\n        Object.keys(this.joinRooms).forEach((roomId) => {\n            const roomData = this.joinRooms[roomId];\n            const roomJson: IJoinedRoom = {\n                ephemeral: { events: [] },\n                account_data: { events: [] },\n                state: { events: [] },\n                timeline: {\n                    events: [],\n                    prev_batch: null,\n                },\n                unread_notifications: roomData._unreadNotifications,\n                unread_thread_notifications: roomData._unreadThreadNotifications,\n                summary: roomData._summary as IRoomSummary,\n            };\n            // Add account data\n            Object.keys(roomData._accountData).forEach((evType) => {\n                roomJson.account_data.events.push(roomData._accountData[evType]);\n            });\n\n            const receiptEvent = roomData._receipts.buildAccumulatedReceiptEvent(roomId);\n\n            // add only if we have some receipt data\n            if (receiptEvent) {\n                roomJson.ephemeral.events.push(receiptEvent);\n            }\n\n            // Add timeline data\n            roomData._timeline.forEach((msgData) => {\n                if (!roomJson.timeline.prev_batch) {\n                    // the first event we add to the timeline MUST match up to\n                    // the prev_batch token.\n                    if (!msgData.token) {\n                        return; // this shouldn't happen as we prune constantly.\n                    }\n                    roomJson.timeline.prev_batch = msgData.token;\n                }\n\n                let transformedEvent: (IRoomEvent | IStateEvent) & { _localTs?: number };\n                if (!forDatabase && isTaggedEvent(msgData.event)) {\n                    // This means we have to copy each event, so we can fix it up to\n                    // set a correct 'age' parameter whilst keeping the local timestamp\n                    // on our stored event. If this turns out to be a bottleneck, it could\n                    // be optimised either by doing this in the main process after the data\n                    // has been structured-cloned to go between the worker & main process,\n                    // or special-casing data from saved syncs to read the local timestamp\n                    // directly rather than turning it into age to then immediately be\n                    // transformed back again into a local timestamp.\n                    transformedEvent = Object.assign({}, msgData.event);\n                    if (transformedEvent.unsigned !== undefined) {\n                        transformedEvent.unsigned = Object.assign({}, transformedEvent.unsigned);\n                    }\n                    delete transformedEvent._localTs;\n                    transformedEvent.unsigned = transformedEvent.unsigned || {};\n                    transformedEvent.unsigned.age = Date.now() - msgData.event._localTs!;\n                } else {\n                    transformedEvent = msgData.event;\n                }\n                roomJson.timeline.events.push(transformedEvent);\n            });\n\n            // Add state data: roll back current state to the start of timeline,\n            // by \"reverse clobbering\" from the end of the timeline to the start.\n            // Convert maps back into arrays.\n            const rollBackState = Object.create(null);\n            for (let i = roomJson.timeline.events.length - 1; i >= 0; i--) {\n                const timelineEvent = roomJson.timeline.events[i];\n                if (\n                    (timelineEvent as IStateEvent).state_key === null ||\n                    (timelineEvent as IStateEvent).state_key === undefined\n                ) {\n                    continue; // not a state event\n                }\n                // since we're going back in time, we need to use the previous\n                // state value else we'll break causality. We don't have the\n                // complete previous state event, so we need to create one.\n                const prevStateEvent = deepCopy(timelineEvent);\n                if (prevStateEvent.unsigned) {\n                    if (prevStateEvent.unsigned.prev_content) {\n                        prevStateEvent.content = prevStateEvent.unsigned.prev_content;\n                    }\n                    if (prevStateEvent.unsigned.prev_sender) {\n                        prevStateEvent.sender = prevStateEvent.unsigned.prev_sender;\n                    }\n                }\n                setState(rollBackState, prevStateEvent);\n            }\n            Object.keys(roomData._currentState).forEach((evType) => {\n                Object.keys(roomData._currentState[evType]).forEach((stateKey) => {\n                    let ev = roomData._currentState[evType][stateKey];\n                    if (rollBackState[evType] && rollBackState[evType][stateKey]) {\n                        // use the reverse clobbered event instead.\n                        ev = rollBackState[evType][stateKey];\n                    }\n                    roomJson.state.events.push(ev);\n                });\n            });\n            data.join[roomId] = roomJson;\n        });\n\n        // Add account data\n        const accData: IMinimalEvent[] = [];\n        Object.keys(this.accountData).forEach((evType) => {\n            accData.push(this.accountData[evType]);\n        });\n\n        return {\n            nextBatch: this.nextBatch!,\n            roomsData: data,\n            accountData: accData,\n        };\n    }\n\n    public getNextBatchToken(): string {\n        return this.nextBatch!;\n    }\n}\n\nfunction setState(eventMap: Record<string, Record<string, IStateEvent>>, event: IRoomEvent | IStateEvent): void {\n    if ((event as IStateEvent).state_key === null || (event as IStateEvent).state_key === undefined || !event.type) {\n        return;\n    }\n    if (!eventMap[event.type]) {\n        eventMap[event.type] = Object.create(null);\n    }\n    eventMap[event.type][(event as IStateEvent).state_key] = event as IStateEvent;\n}\n","/*\nCopyright 2015, 2016, 2019, 2023 The Matrix.org Foundation C.I.C.\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\n\n/**\n * This is an internal module.\n */\n\nimport unhomoglyph from \"unhomoglyph\";\nimport promiseRetry from \"p-retry\";\nimport { Optional } from \"matrix-events-sdk\";\n\nimport { IEvent, MatrixEvent } from \"./models/event.ts\";\nimport { M_TIMESTAMP } from \"./@types/location.ts\";\nimport { ReceiptType } from \"./@types/read_receipts.ts\";\nimport { BaseLogger } from \"./logger.ts\";\n\nconst interns = new Map<string, string>();\n\n/**\n * Internalises a string, reusing a known pointer or storing the pointer\n * if needed for future strings.\n * @param str - The string to internalise.\n * @returns The internalised string.\n */\nexport function internaliseString(str: string): string {\n    // Unwrap strings before entering the map, if we somehow got a wrapped\n    // string as our input. This should only happen from tests.\n    if ((str as unknown) instanceof String) {\n        str = str.toString();\n    }\n\n    // Check the map to see if we can store the value\n    if (!interns.has(str)) {\n        interns.set(str, str);\n    }\n\n    // Return any cached string reference\n    return interns.get(str)!;\n}\n\n/**\n * Encode a dictionary of query parameters.\n * Omits any undefined/null values.\n * @param params - A dict of key/values to encode e.g.\n * `{\"foo\": \"bar\", \"baz\": \"taz\"}`\n * @returns The encoded string e.g. foo=bar&baz=taz\n */\nexport function encodeParams(params: QueryDict, urlSearchParams?: URLSearchParams): URLSearchParams {\n    const searchParams = urlSearchParams ?? new URLSearchParams();\n    for (const [key, val] of Object.entries(params)) {\n        if (val !== undefined && val !== null) {\n            if (Array.isArray(val)) {\n                val.forEach((v) => {\n                    searchParams.append(key, String(v));\n                });\n            } else {\n                searchParams.append(key, String(val));\n            }\n        }\n    }\n    return searchParams;\n}\n\nexport type QueryDict = Record<string, string[] | string | number | boolean | undefined>;\n\n/**\n * Replace a stable parameter with the unstable naming for params\n */\nexport function replaceParam(stable: string, unstable: string, dict: QueryDict): QueryDict {\n    const result = {\n        ...dict,\n        [unstable]: dict[stable],\n    };\n    delete result[stable];\n    return result;\n}\n\n/**\n * Decode a query string in `application/x-www-form-urlencoded` format.\n * @param query - A query string to decode e.g.\n * foo=bar&via=server1&server2\n * @returns The decoded object, if any keys occurred multiple times\n * then the value will be an array of strings, else it will be an array.\n * This behaviour matches Node's qs.parse but is built on URLSearchParams\n * for native web compatibility\n */\nexport function decodeParams(query: string): Record<string, string | string[]> {\n    const o: Record<string, string | string[]> = {};\n    const params = new URLSearchParams(query);\n    for (const key of params.keys()) {\n        const val = params.getAll(key);\n        o[key] = val.length === 1 ? val[0] : val;\n    }\n    return o;\n}\n\n/**\n * Encodes a URI according to a set of template variables. Variables will be\n * passed through encodeURIComponent.\n * @param pathTemplate - The path with template variables e.g. '/foo/$bar'.\n * @param variables - The key/value pairs to replace the template\n * variables with. E.g. `{ \"$bar\": \"baz\" }`.\n * @returns The result of replacing all template variables e.g. '/foo/baz'.\n */\nexport function encodeUri(pathTemplate: string, variables: Record<string, Optional<string>>): string {\n    for (const key in variables) {\n        if (!variables.hasOwnProperty(key)) {\n            continue;\n        }\n        const value = variables[key];\n        if (value === undefined || value === null) {\n            continue;\n        }\n        pathTemplate = pathTemplate.replace(key, encodeURIComponent(value));\n    }\n    return pathTemplate;\n}\n\n/**\n * The removeElement() method removes the first element in the array that\n * satisfies (returns true) the provided testing function.\n * @param array - The array.\n * @param fn - Function to execute on each value in the array, with the\n * function signature `fn(element, index, array)`. Return true to\n * remove this element and break.\n * @param reverse - True to search in reverse order.\n * @returns True if an element was removed.\n */\nexport function removeElement<T>(array: T[], fn: (t: T, i?: number, a?: T[]) => boolean, reverse?: boolean): boolean {\n    let i: number;\n    if (reverse) {\n        for (i = array.length - 1; i >= 0; i--) {\n            if (fn(array[i], i, array)) {\n                array.splice(i, 1);\n                return true;\n            }\n        }\n    } else {\n        for (i = 0; i < array.length; i++) {\n            if (fn(array[i], i, array)) {\n                array.splice(i, 1);\n                return true;\n            }\n        }\n    }\n    return false;\n}\n\n/**\n * Checks if the given thing is a function.\n * @param value - The thing to check.\n * @returns True if it is a function.\n */\nexport function isFunction(value: any): boolean {\n    return Object.prototype.toString.call(value) === \"[object Function]\";\n}\n\n/**\n * Checks that the given object has the specified keys.\n * @param obj - The object to check.\n * @param keys - The list of keys that 'obj' must have.\n * @throws If the object is missing keys.\n */\n// note using 'keys' here would shadow the 'keys' function defined above\nexport function checkObjectHasKeys(obj: object, keys: string[]): void {\n    for (const key of keys) {\n        if (!obj.hasOwnProperty(key)) {\n            throw new Error(\"Missing required key: \" + key);\n        }\n    }\n}\n\n/**\n * Deep copy the given object. The object MUST NOT have circular references and\n * MUST NOT have functions.\n * @param obj - The object to deep copy.\n * @returns A copy of the object without any references to the original.\n */\nexport function deepCopy<T>(obj: T): T {\n    return JSON.parse(JSON.stringify(obj));\n}\n\n/**\n * Compare two objects for equality. The objects MUST NOT have circular references.\n *\n * @param x - The first object to compare.\n * @param y - The second object to compare.\n *\n * @returns true if the two objects are equal\n */\nexport function deepCompare(x: any, y: any): boolean {\n    // Inspired by\n    // http://stackoverflow.com/questions/1068834/object-comparison-in-javascript#1144249\n\n    // Compare primitives and functions.\n    // Also check if both arguments link to the same object.\n    if (x === y) {\n        return true;\n    }\n\n    if (typeof x !== typeof y) {\n        return false;\n    }\n\n    // special-case NaN (since NaN !== NaN)\n    if (typeof x === \"number\" && isNaN(x) && isNaN(y)) {\n        return true;\n    }\n\n    // special-case null (since typeof null == 'object', but null.constructor\n    // throws)\n    if (x === null || y === null) {\n        return x === y;\n    }\n\n    // everything else is either an unequal primitive, or an object\n    if (!(x instanceof Object)) {\n        return false;\n    }\n\n    // check they are the same type of object\n    if (x.constructor !== y.constructor || x.prototype !== y.prototype) {\n        return false;\n    }\n\n    // special-casing for some special types of object\n    if (x instanceof RegExp || x instanceof Date) {\n        return x.toString() === y.toString();\n    }\n\n    // the object algorithm works for Array, but it's sub-optimal.\n    if (Array.isArray(x)) {\n        if (x.length !== y.length) {\n            return false;\n        }\n\n        for (let i = 0; i < x.length; i++) {\n            if (!deepCompare(x[i], y[i])) {\n                return false;\n            }\n        }\n    } else {\n        // check that all of y's direct keys are in x\n        for (const p in y) {\n            if (y.hasOwnProperty(p) !== x.hasOwnProperty(p)) {\n                return false;\n            }\n        }\n\n        // finally, compare each of x's keys with y\n        for (const p in x) {\n            if (y.hasOwnProperty(p) !== x.hasOwnProperty(p) || !deepCompare(x[p], y[p])) {\n                return false;\n            }\n        }\n    }\n    return true;\n}\n\n// Dev note: This returns an array of tuples, but jsdoc doesn't like that. https://github.com/jsdoc/jsdoc/issues/1703\n/**\n * Creates an array of object properties/values (entries) then\n * sorts the result by key, recursively. The input object must\n * ensure it does not have loops. If the input is not an object\n * then it will be returned as-is.\n * @param obj - The object to get entries of\n * @returns The entries, sorted by key.\n */\nexport function deepSortedObjectEntries(obj: any): [string, any][] {\n    if (typeof obj !== \"object\") return obj;\n\n    // Apparently these are object types...\n    if (obj === null || obj === undefined || Array.isArray(obj)) return obj;\n\n    const pairs: [string, any][] = [];\n    for (const [k, v] of Object.entries(obj)) {\n        pairs.push([k, deepSortedObjectEntries(v)]);\n    }\n\n    // lexicographicCompare is faster than localeCompare, so let's use that.\n    pairs.sort((a, b) => lexicographicCompare(a[0], b[0]));\n\n    return pairs;\n}\n\n/**\n * Returns whether the given value is a finite number without type-coercion\n *\n * @param value - the value to test\n * @returns whether or not value is a finite number without type-coercion\n */\nexport function isNumber(value: any): value is number {\n    return typeof value === \"number\" && isFinite(value);\n}\n\n/**\n * Removes zero width chars, diacritics and whitespace from the string\n * Also applies an unhomoglyph on the string, to prevent similar looking chars\n * @param str - the string to remove hidden characters from\n * @returns a string with the hidden characters removed\n */\nexport function removeHiddenChars(str: string): string {\n    if (typeof str === \"string\") {\n        return unhomoglyph(str.normalize(\"NFD\").replace(removeHiddenCharsRegex, \"\"));\n    }\n    return \"\";\n}\n\n/**\n * Removes the direction override characters from a string\n * @returns string with chars removed\n */\nexport function removeDirectionOverrideChars(str: string): string {\n    if (typeof str === \"string\") {\n        return str.replace(/[\\u202d-\\u202e]/g, \"\");\n    }\n    return \"\";\n}\n\nexport function normalize(str: string): string {\n    // Note: we have to match the filter with the removeHiddenChars() because the\n    // function strips spaces and other characters (M becomes RN for example, in lowercase).\n    return (\n        removeHiddenChars(str.toLowerCase())\n            // Strip all punctuation\n            .replace(/[\\\\'!\"#$%&()*+,\\-./:;<=>?@[\\]^_`{|}~\\u2000-\\u206f\\u2e00-\\u2e7f]/g, \"\")\n            // We also doubly convert to lowercase to work around oddities of the library.\n            .toLowerCase()\n    );\n}\n\n// Regex matching bunch of unicode control characters and otherwise misleading/invisible characters.\n// Includes:\n// various width spaces U+2000 - U+200D\n// LTR and RTL marks U+200E and U+200F\n// LTR/RTL and other directional formatting marks U+202A - U+202F\n// Arabic Letter RTL mark U+061C\n// Combining characters U+0300 - U+036F\n// Zero width no-break space (BOM) U+FEFF\n// Blank/invisible characters (U2800, U2062-U2063)\n// eslint-disable-next-line no-misleading-character-class\nconst removeHiddenCharsRegex = /[\\u2000-\\u200F\\u202A-\\u202F\\u0300-\\u036F\\uFEFF\\u061C\\u2800\\u2062-\\u2063\\s]/g;\n\nexport function escapeRegExp(string: string): string {\n    return string.replace(/[.*+?^${}()|[\\]\\\\]/g, \"\\\\$&\");\n}\n\n/**\n * Converts Matrix glob-style string to a regular expression\n * https://spec.matrix.org/v1.7/appendices/#glob-style-matching\n * @param glob - Matrix glob-style string\n * @returns regular expression\n */\nexport function globToRegexp(glob: string): string {\n    return escapeRegExp(glob).replace(/\\\\\\*/g, \".*\").replace(/\\?/g, \".\");\n}\n\nexport function ensureNoTrailingSlash(url: string): string;\nexport function ensureNoTrailingSlash(url: undefined): undefined;\nexport function ensureNoTrailingSlash(url?: string): string | undefined;\nexport function ensureNoTrailingSlash(url?: string): string | undefined {\n    if (url?.endsWith(\"/\")) {\n        return url.slice(0, -1);\n    } else {\n        return url;\n    }\n}\n\n/**\n * Returns a promise which resolves with a given value after the given number of ms\n */\nexport function sleep<T>(ms: number, value?: T): Promise<T> {\n    return new Promise((resolve) => {\n        setTimeout(resolve, ms, value);\n    });\n}\n\n/**\n * Utility to log the duration of a promise.\n *\n * @param logger - The logger to log to.\n * @param name - The name of the operation.\n * @param block - The block to execute.\n */\nexport async function logDuration<T>(logger: BaseLogger, name: string, block: () => Promise<T>): Promise<T> {\n    const start = Date.now();\n    try {\n        return await block();\n    } finally {\n        const end = Date.now();\n        logger.debug(`[Perf]: ${name} took ${end - start}ms`);\n    }\n}\n\n/**\n * Promise/async version of {@link setImmediate}.\n *\n * Implementation is based on `setTimeout` for wider compatibility.\n * @deprecated Use {@link sleep} instead.\n */\nexport function immediate(): Promise<void> {\n    return new Promise((resolve) => setTimeout(resolve));\n}\n\nexport function isNullOrUndefined(val: any): boolean {\n    return val === null || val === undefined;\n}\n\nexport interface IDeferred<T> {\n    resolve: (value: T | Promise<T>) => void;\n    reject: (reason?: any) => void;\n    promise: Promise<T>;\n}\n\n// Returns a Deferred\nexport function defer<T = void>(): IDeferred<T> {\n    let resolve!: IDeferred<T>[\"resolve\"];\n    let reject!: IDeferred<T>[\"reject\"];\n\n    const promise = new Promise<T>((_resolve, _reject) => {\n        resolve = _resolve;\n        reject = _reject;\n    });\n\n    return { resolve, reject, promise };\n}\n\nexport async function promiseMapSeries<T>(\n    promises: Array<T | Promise<T>>,\n    fn: (t: T) => Promise<unknown> | undefined, // if async we don't care about the type as we only await resolution\n): Promise<void> {\n    for (const o of promises) {\n        await fn(await o);\n    }\n}\n\nexport function promiseTry<T>(fn: () => T | Promise<T>): Promise<T> {\n    return Promise.resolve(fn());\n}\n\n// Creates and awaits all promises, running no more than `chunkSize` at the same time\nexport async function chunkPromises<T>(fns: (() => Promise<T>)[], chunkSize: number): Promise<T[]> {\n    const results: T[] = [];\n    for (let i = 0; i < fns.length; i += chunkSize) {\n        results.push(...(await Promise.all(fns.slice(i, i + chunkSize).map((fn) => fn()))));\n    }\n    return results;\n}\n\n/**\n * Retries the function until it succeeds or is interrupted. The given function must return\n * a promise which throws/rejects on error, otherwise the retry will assume the request\n * succeeded. The promise chain returned will contain the successful promise. The given function\n * should always return a new promise.\n * @param promiseFn - The function to call to get a fresh promise instance. Takes an\n * attempt count as an argument, for logging/debugging purposes.\n * @returns The promise for the retried operation.\n */\nexport function simpleRetryOperation<T>(promiseFn: (attempt: number) => Promise<T>): Promise<T> {\n    return promiseRetry(\n        (attempt: number) => {\n            return promiseFn(attempt);\n        },\n        {\n            forever: true,\n            factor: 2,\n            minTimeout: 3000, // ms\n            maxTimeout: 15000, // ms\n        },\n    );\n}\n\n// String averaging inspired by https://stackoverflow.com/a/2510816\n// Dev note: We make the alphabet a string because it's easier to write syntactically\n// than arrays. Thankfully, strings implement the useful parts of the Array interface\n// anyhow.\n\n/**\n * The default alphabet used by string averaging in this SDK. This matches\n * all usefully printable ASCII characters (0x20-0x7E, inclusive).\n */\nexport const DEFAULT_ALPHABET = ((): string => {\n    let str = \"\";\n    for (let c = 0x20; c <= 0x7e; c++) {\n        str += String.fromCharCode(c);\n    }\n    return str;\n})();\n\n/**\n * Pads a string using the given alphabet as a base. The returned string will be\n * padded at the end with the first character in the alphabet.\n *\n * This is intended for use with string averaging.\n * @param s - The string to pad.\n * @param n - The length to pad to.\n * @param alphabet - The alphabet to use as a single string.\n * @returns The padded string.\n */\nexport function alphabetPad(s: string, n: number, alphabet = DEFAULT_ALPHABET): string {\n    return s.padEnd(n, alphabet[0]);\n}\n\n/**\n * Converts a baseN number to a string, where N is the alphabet's length.\n *\n * This is intended for use with string averaging.\n * @param n - The baseN number.\n * @param alphabet - The alphabet to use as a single string.\n * @returns The baseN number encoded as a string from the alphabet.\n */\nexport function baseToString(n: bigint, alphabet = DEFAULT_ALPHABET): string {\n    // Developer note: the stringToBase() function offsets the character set by 1 so that repeated\n    // characters (ie: \"aaaaaa\" in a..z) don't come out as zero. We have to reverse this here as\n    // otherwise we'll be wrong in our conversion. Undoing a +1 before an exponent isn't very fun\n    // though, so we rely on a lengthy amount of `x - 1` and integer division rules to reach a\n    // sane state. This also means we have to do rollover detection: see below.\n\n    const len = BigInt(alphabet.length);\n    if (n <= len) {\n        return alphabet[Number(n) - 1] ?? \"\";\n    }\n\n    let d = n / len;\n    let r = Number(n % len) - 1;\n\n    // Rollover detection: if the remainder is negative, it means that the string needs\n    // to roll over by 1 character downwards (ie: in a..z, the previous to \"aaa\" would be\n    // \"zz\").\n    if (r < 0) {\n        d -= BigInt(Math.abs(r)); // abs() is just to be clear what we're doing. Could also `+= r`.\n        r = Number(len) - 1;\n    }\n\n    return baseToString(d, alphabet) + alphabet[r];\n}\n\n/**\n * Converts a string to a baseN number, where N is the alphabet's length.\n *\n * This is intended for use with string averaging.\n * @param s - The string to convert to a number.\n * @param alphabet - The alphabet to use as a single string.\n * @returns The baseN number.\n */\nexport function stringToBase(s: string, alphabet = DEFAULT_ALPHABET): bigint {\n    const len = BigInt(alphabet.length);\n\n    // In our conversion to baseN we do a couple performance optimizations to avoid using\n    // excess CPU and such. To create baseN numbers, the input string needs to be reversed\n    // so the exponents stack up appropriately, as the last character in the unreversed\n    // string has less impact than the first character (in \"abc\" the A is a lot more important\n    // for lexicographic sorts). We also do a trick with the character codes to optimize the\n    // alphabet lookup, avoiding an index scan of `alphabet.indexOf(reversedStr[i])` - we know\n    // that the alphabet and (theoretically) the input string are constrained on character sets\n    // and thus can do simple subtraction to end up with the same result.\n\n    // Developer caution: we carefully cast to BigInt here to avoid losing precision. We cannot\n    // rely on Math.pow() (for example) to be capable of handling our insane numbers.\n\n    let result = BigInt(0);\n    for (let i = s.length - 1, j = BigInt(0); i >= 0; i--, j++) {\n        const charIndex = s.charCodeAt(i) - alphabet.charCodeAt(0);\n\n        // We add 1 to the char index to offset the whole numbering scheme. We unpack this in\n        // the baseToString() function.\n        result += BigInt(1 + charIndex) * len ** j;\n    }\n    return result;\n}\n\n/**\n * Averages two strings, returning the midpoint between them. This is accomplished by\n * converting both to baseN numbers (where N is the alphabet's length) then averaging\n * those before re-encoding as a string.\n * @param a - The first string.\n * @param b - The second string.\n * @param alphabet - The alphabet to use as a single string.\n * @returns The midpoint between the strings, as a string.\n */\nexport function averageBetweenStrings(a: string, b: string, alphabet = DEFAULT_ALPHABET): string {\n    const padN = Math.max(a.length, b.length);\n    const baseA = stringToBase(alphabetPad(a, padN, alphabet), alphabet);\n    const baseB = stringToBase(alphabetPad(b, padN, alphabet), alphabet);\n    const avg = (baseA + baseB) / BigInt(2);\n\n    // Detect integer division conflicts. This happens when two numbers are divided too close so\n    // we lose a .5 precision. We need to add a padding character in these cases.\n    if (avg === baseA || avg == baseB) {\n        return baseToString(avg, alphabet) + alphabet[0];\n    }\n\n    return baseToString(avg, alphabet);\n}\n\n/**\n * Finds the next string using the alphabet provided. This is done by converting the\n * string to a baseN number, where N is the alphabet's length, then adding 1 before\n * converting back to a string.\n * @param s - The string to start at.\n * @param alphabet - The alphabet to use as a single string.\n * @returns The string which follows the input string.\n */\nexport function nextString(s: string, alphabet = DEFAULT_ALPHABET): string {\n    return baseToString(stringToBase(s, alphabet) + BigInt(1), alphabet);\n}\n\n/**\n * Finds the previous string using the alphabet provided. This is done by converting the\n * string to a baseN number, where N is the alphabet's length, then subtracting 1 before\n * converting back to a string.\n * @param s - The string to start at.\n * @param alphabet - The alphabet to use as a single string.\n * @returns The string which precedes the input string.\n */\nexport function prevString(s: string, alphabet = DEFAULT_ALPHABET): string {\n    return baseToString(stringToBase(s, alphabet) - BigInt(1), alphabet);\n}\n\n/**\n * Compares strings lexicographically as a sort-safe function.\n * @param a - The first (reference) string.\n * @param b - The second (compare) string.\n * @returns Negative if the reference string is before the compare string;\n * positive if the reference string is after; and zero if equal.\n */\nexport function lexicographicCompare(a: string, b: string): number {\n    // Dev note: this exists because I'm sad that you can use math operators on strings, so I've\n    // hidden the operation in this function.\n    if (a < b) {\n        return -1;\n    } else if (a > b) {\n        return 1;\n    } else {\n        return 0;\n    }\n}\n\n/**\n * This function is similar to Object.assign() but it assigns recursively and\n * allows you to ignore nullish values from the source\n *\n * @returns the target object\n */\nexport function recursivelyAssign<T1 extends T2, T2 extends Record<string, any>>(\n    target: T1,\n    source: T2,\n    ignoreNullish = false,\n): T1 & T2 {\n    for (const [sourceKey, sourceValue] of Object.entries(source)) {\n        if (target[sourceKey] instanceof Object && sourceValue) {\n            recursivelyAssign(target[sourceKey], sourceValue);\n            continue;\n        }\n        if ((sourceValue !== null && sourceValue !== undefined) || !ignoreNullish) {\n            safeSet(target, sourceKey, sourceValue);\n            continue;\n        }\n    }\n    return target as T1 & T2;\n}\n\nfunction getContentTimestampWithFallback(event: MatrixEvent): number {\n    return M_TIMESTAMP.findIn<number>(event.getContent()) ?? -1;\n}\n\n/**\n * Sort events by their content m.ts property\n * Latest timestamp first\n */\nexport function sortEventsByLatestContentTimestamp(left: MatrixEvent, right: MatrixEvent): number {\n    return getContentTimestampWithFallback(right) - getContentTimestampWithFallback(left);\n}\n\nexport function isSupportedReceiptType(receiptType: string): boolean {\n    return [ReceiptType.Read, ReceiptType.ReadPrivate].includes(receiptType as ReceiptType);\n}\n\n/**\n * Determines whether two maps are equal.\n * @param eq - The equivalence relation to compare values by. Defaults to strict equality.\n */\nexport function mapsEqual<K, V>(x: Map<K, V>, y: Map<K, V>, eq = (v1: V, v2: V): boolean => v1 === v2): boolean {\n    if (x.size !== y.size) return false;\n    for (const [k, v1] of x) {\n        const v2 = y.get(k);\n        if (v2 === undefined || !eq(v1, v2)) return false;\n    }\n    return true;\n}\n\nfunction processMapToObjectValue(value: any): any {\n    if (value instanceof Map) {\n        // Value is a Map. Recursively map it to an object.\n        return recursiveMapToObject(value);\n    } else if (Array.isArray(value)) {\n        // Value is an Array. Recursively map the value (e.g. to cover Array of Arrays).\n        return value.map((v) => processMapToObjectValue(v));\n    } else {\n        return value;\n    }\n}\n\n/**\n * Recursively converts Maps to plain objects.\n * Also supports sub-lists of Maps.\n */\nexport function recursiveMapToObject(map: Map<any, any>): Record<any, any> {\n    const targetMap = new Map();\n\n    for (const [key, value] of map) {\n        targetMap.set(key, processMapToObjectValue(value));\n    }\n\n    return Object.fromEntries(targetMap.entries());\n}\n\nexport function unsafeProp<K extends keyof any | undefined>(prop: K): boolean {\n    return prop === \"__proto__\" || prop === \"prototype\" || prop === \"constructor\";\n}\n\nexport function safeSet<O extends Record<any, any>, K extends keyof O>(obj: O, prop: K, value: O[K]): void {\n    if (unsafeProp(prop)) {\n        throw new Error(\"Trying to modify prototype or constructor\");\n    }\n\n    obj[prop] = value;\n}\n\nexport function noUnsafeEventProps(event: Partial<IEvent>): boolean {\n    return !(unsafeProp(event.room_id) || unsafeProp(event.sender) || unsafeProp(event.event_id));\n}\n\nexport class MapWithDefault<K, V> extends Map<K, V> {\n    public constructor(private createDefault: () => V) {\n        super();\n    }\n\n    /**\n     * Returns the value if the key already exists.\n     * If not, it creates a new value under that key using the ctor callback and returns it.\n     */\n    public getOrCreate(key: K): V {\n        if (!this.has(key)) {\n            this.set(key, this.createDefault());\n        }\n\n        return this.get(key)!;\n    }\n}\n","/*\n* loglevel - https://github.com/pimterry/loglevel\n*\n* Copyright (c) 2013 Tim Perry\n* Licensed under the MIT license.\n*/\n(function (root, definition) {\n    \"use strict\";\n    if (typeof define === 'function' && define.amd) {\n        define(definition);\n    } else if (typeof module === 'object' && module.exports) {\n        module.exports = definition();\n    } else {\n        root.log = definition();\n    }\n}(this, function () {\n    \"use strict\";\n\n    // Slightly dubious tricks to cut down minimized file size\n    var noop = function() {};\n    var undefinedType = \"undefined\";\n    var isIE = (typeof window !== undefinedType) && (typeof window.navigator !== undefinedType) && (\n        /Trident\\/|MSIE /.test(window.navigator.userAgent)\n    );\n\n    var logMethods = [\n        \"trace\",\n        \"debug\",\n        \"info\",\n        \"warn\",\n        \"error\"\n    ];\n\n    var _loggersByName = {};\n    var defaultLogger = null;\n\n    // Cross-browser bind equivalent that works at least back to IE6\n    function bindMethod(obj, methodName) {\n        var method = obj[methodName];\n        if (typeof method.bind === 'function') {\n            return method.bind(obj);\n        } else {\n            try {\n                return Function.prototype.bind.call(method, obj);\n            } catch (e) {\n                // Missing bind shim or IE8 + Modernizr, fallback to wrapping\n                return function() {\n                    return Function.prototype.apply.apply(method, [obj, arguments]);\n                };\n            }\n        }\n    }\n\n    // Trace() doesn't print the message in IE, so for that case we need to wrap it\n    function traceForIE() {\n        if (console.log) {\n            if (console.log.apply) {\n                console.log.apply(console, arguments);\n            } else {\n                // In old IE, native console methods themselves don't have apply().\n                Function.prototype.apply.apply(console.log, [console, arguments]);\n            }\n        }\n        if (console.trace) console.trace();\n    }\n\n    // Build the best logging method possible for this env\n    // Wherever possible we want to bind, not wrap, to preserve stack traces\n    function realMethod(methodName) {\n        if (methodName === 'debug') {\n            methodName = 'log';\n        }\n\n        if (typeof console === undefinedType) {\n            return false; // No method possible, for now - fixed later by enableLoggingWhenConsoleArrives\n        } else if (methodName === 'trace' && isIE) {\n            return traceForIE;\n        } else if (console[methodName] !== undefined) {\n            return bindMethod(console, methodName);\n        } else if (console.log !== undefined) {\n            return bindMethod(console, 'log');\n        } else {\n            return noop;\n        }\n    }\n\n    // These private functions always need `this` to be set properly\n\n    function replaceLoggingMethods() {\n        /*jshint validthis:true */\n        var level = this.getLevel();\n\n        // Replace the actual methods.\n        for (var i = 0; i < logMethods.length; i++) {\n            var methodName = logMethods[i];\n            this[methodName] = (i < level) ?\n                noop :\n                this.methodFactory(methodName, level, this.name);\n        }\n\n        // Define log.log as an alias for log.debug\n        this.log = this.debug;\n\n        // Return any important warnings.\n        if (typeof console === undefinedType && level < this.levels.SILENT) {\n            return \"No console available for logging\";\n        }\n    }\n\n    // In old IE versions, the console isn't present until you first open it.\n    // We build realMethod() replacements here that regenerate logging methods\n    function enableLoggingWhenConsoleArrives(methodName) {\n        return function () {\n            if (typeof console !== undefinedType) {\n                replaceLoggingMethods.call(this);\n                this[methodName].apply(this, arguments);\n            }\n        };\n    }\n\n    // By default, we use closely bound real methods wherever possible, and\n    // otherwise we wait for a console to appear, and then try again.\n    function defaultMethodFactory(methodName, _level, _loggerName) {\n        /*jshint validthis:true */\n        return realMethod(methodName) ||\n               enableLoggingWhenConsoleArrives.apply(this, arguments);\n    }\n\n    function Logger(name, factory) {\n      // Private instance variables.\n      var self = this;\n      /**\n       * The level inherited from a parent logger (or a global default). We\n       * cache this here rather than delegating to the parent so that it stays\n       * in sync with the actual logging methods that we have installed (the\n       * parent could change levels but we might not have rebuilt the loggers\n       * in this child yet).\n       * @type {number}\n       */\n      var inheritedLevel;\n      /**\n       * The default level for this logger, if any. If set, this overrides\n       * `inheritedLevel`.\n       * @type {number|null}\n       */\n      var defaultLevel;\n      /**\n       * A user-specific level for this logger. If set, this overrides\n       * `defaultLevel`.\n       * @type {number|null}\n       */\n      var userLevel;\n\n      var storageKey = \"loglevel\";\n      if (typeof name === \"string\") {\n        storageKey += \":\" + name;\n      } else if (typeof name === \"symbol\") {\n        storageKey = undefined;\n      }\n\n      function persistLevelIfPossible(levelNum) {\n          var levelName = (logMethods[levelNum] || 'silent').toUpperCase();\n\n          if (typeof window === undefinedType || !storageKey) return;\n\n          // Use localStorage if available\n          try {\n              window.localStorage[storageKey] = levelName;\n              return;\n          } catch (ignore) {}\n\n          // Use session cookie as fallback\n          try {\n              window.document.cookie =\n                encodeURIComponent(storageKey) + \"=\" + levelName + \";\";\n          } catch (ignore) {}\n      }\n\n      function getPersistedLevel() {\n          var storedLevel;\n\n          if (typeof window === undefinedType || !storageKey) return;\n\n          try {\n              storedLevel = window.localStorage[storageKey];\n          } catch (ignore) {}\n\n          // Fallback to cookies if local storage gives us nothing\n          if (typeof storedLevel === undefinedType) {\n              try {\n                  var cookie = window.document.cookie;\n                  var cookieName = encodeURIComponent(storageKey);\n                  var location = cookie.indexOf(cookieName + \"=\");\n                  if (location !== -1) {\n                      storedLevel = /^([^;]+)/.exec(\n                          cookie.slice(location + cookieName.length + 1)\n                      )[1];\n                  }\n              } catch (ignore) {}\n          }\n\n          // If the stored level is not valid, treat it as if nothing was stored.\n          if (self.levels[storedLevel] === undefined) {\n              storedLevel = undefined;\n          }\n\n          return storedLevel;\n      }\n\n      function clearPersistedLevel() {\n          if (typeof window === undefinedType || !storageKey) return;\n\n          // Use localStorage if available\n          try {\n              window.localStorage.removeItem(storageKey);\n          } catch (ignore) {}\n\n          // Use session cookie as fallback\n          try {\n              window.document.cookie =\n                encodeURIComponent(storageKey) + \"=; expires=Thu, 01 Jan 1970 00:00:00 UTC\";\n          } catch (ignore) {}\n      }\n\n      function normalizeLevel(input) {\n          var level = input;\n          if (typeof level === \"string\" && self.levels[level.toUpperCase()] !== undefined) {\n              level = self.levels[level.toUpperCase()];\n          }\n          if (typeof level === \"number\" && level >= 0 && level <= self.levels.SILENT) {\n              return level;\n          } else {\n              throw new TypeError(\"log.setLevel() called with invalid level: \" + input);\n          }\n      }\n\n      /*\n       *\n       * Public logger API - see https://github.com/pimterry/loglevel for details\n       *\n       */\n\n      self.name = name;\n\n      self.levels = { \"TRACE\": 0, \"DEBUG\": 1, \"INFO\": 2, \"WARN\": 3,\n          \"ERROR\": 4, \"SILENT\": 5};\n\n      self.methodFactory = factory || defaultMethodFactory;\n\n      self.getLevel = function () {\n          if (userLevel != null) {\n            return userLevel;\n          } else if (defaultLevel != null) {\n            return defaultLevel;\n          } else {\n            return inheritedLevel;\n          }\n      };\n\n      self.setLevel = function (level, persist) {\n          userLevel = normalizeLevel(level);\n          if (persist !== false) {  // defaults to true\n              persistLevelIfPossible(userLevel);\n          }\n\n          // NOTE: in v2, this should call rebuild(), which updates children.\n          return replaceLoggingMethods.call(self);\n      };\n\n      self.setDefaultLevel = function (level) {\n          defaultLevel = normalizeLevel(level);\n          if (!getPersistedLevel()) {\n              self.setLevel(level, false);\n          }\n      };\n\n      self.resetLevel = function () {\n          userLevel = null;\n          clearPersistedLevel();\n          replaceLoggingMethods.call(self);\n      };\n\n      self.enableAll = function(persist) {\n          self.setLevel(self.levels.TRACE, persist);\n      };\n\n      self.disableAll = function(persist) {\n          self.setLevel(self.levels.SILENT, persist);\n      };\n\n      self.rebuild = function () {\n          if (defaultLogger !== self) {\n              inheritedLevel = normalizeLevel(defaultLogger.getLevel());\n          }\n          replaceLoggingMethods.call(self);\n\n          if (defaultLogger === self) {\n              for (var childName in _loggersByName) {\n                _loggersByName[childName].rebuild();\n              }\n          }\n      };\n\n      // Initialize all the internal levels.\n      inheritedLevel = normalizeLevel(\n          defaultLogger ? defaultLogger.getLevel() : \"WARN\"\n      );\n      var initialLevel = getPersistedLevel();\n      if (initialLevel != null) {\n          userLevel = normalizeLevel(initialLevel);\n      }\n      replaceLoggingMethods.call(self);\n    }\n\n    /*\n     *\n     * Top-level API\n     *\n     */\n\n    defaultLogger = new Logger();\n\n    defaultLogger.getLogger = function getLogger(name) {\n        if ((typeof name !== \"symbol\" && typeof name !== \"string\") || name === \"\") {\n            throw new TypeError(\"You must supply a name when creating a logger.\");\n        }\n\n        var logger = _loggersByName[name];\n        if (!logger) {\n            logger = _loggersByName[name] = new Logger(\n                name,\n                defaultLogger.methodFactory\n            );\n        }\n        return logger;\n    };\n\n    // Grab the current global log variable in case of overwrite\n    var _log = (typeof window !== undefinedType) ? window.log : undefined;\n    defaultLogger.noConflict = function() {\n        if (typeof window !== undefinedType &&\n               window.log === defaultLogger) {\n            window.log = _log;\n        }\n\n        return defaultLogger;\n    };\n\n    defaultLogger.getLoggers = function getLoggers() {\n        return _loggersByName;\n    };\n\n    // ES6 default export, for compatibility\n    defaultLogger['default'] = defaultLogger;\n\n    return defaultLogger;\n}));\n","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.ExtensibleEvents = void 0;\n\nvar _NamespacedMap = require(\"./NamespacedMap\");\n\nvar _InvalidEventError = require(\"./InvalidEventError\");\n\nvar _MRoomMessage = require(\"./interpreters/legacy/MRoomMessage\");\n\nvar _MMessage = require(\"./interpreters/modern/MMessage\");\n\nvar _message_types = require(\"./events/message_types\");\n\nvar _poll_types = require(\"./events/poll_types\");\n\nvar _MPoll = require(\"./interpreters/modern/MPoll\");\n\nfunction _createForOfIteratorHelper(o, allowArrayLike) { var it = typeof Symbol !== \"undefined\" && o[Symbol.iterator] || o[\"@@iterator\"]; if (!it) { if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") { if (it) o = it; var i = 0; var F = function F() {}; return { s: F, n: function n() { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }, e: function e(_e) { throw _e; }, f: F }; } throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); } var normalCompletion = true, didErr = false, err; return { s: function s() { it = it.call(o); }, n: function n() { var step = it.next(); normalCompletion = step.done; return step; }, e: function e(_e2) { didErr = true; err = _e2; }, f: function f() { try { if (!normalCompletion && it[\"return\"] != null) it[\"return\"](); } finally { if (didErr) throw err; } } }; }\n\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\n/**\n * Utility class for parsing and identifying event types in a renderable form. An\n * instance of this class can be created to change rendering preference depending\n * on use-case.\n */\nvar ExtensibleEvents = /*#__PURE__*/function () {\n  function ExtensibleEvents() {\n    _classCallCheck(this, ExtensibleEvents);\n\n    _defineProperty(this, \"interpreters\", new _NamespacedMap.NamespacedMap([// Remember to add your unit test when adding to this! (\"known events\" test description)\n    [_MRoomMessage.LEGACY_M_ROOM_MESSAGE, _MRoomMessage.parseMRoomMessage], [_message_types.M_MESSAGE, _MMessage.parseMMessage], [_message_types.M_EMOTE, _MMessage.parseMMessage], [_message_types.M_NOTICE, _MMessage.parseMMessage], [_poll_types.M_POLL_START, _MPoll.parseMPoll], [_poll_types.M_POLL_RESPONSE, _MPoll.parseMPoll], [_poll_types.M_POLL_END, _MPoll.parseMPoll]]));\n\n    _defineProperty(this, \"_unknownInterpretOrder\", [_message_types.M_MESSAGE]);\n  }\n  /**\n   * Gets the default instance for all extensible event parsing.\n   */\n\n\n  _createClass(ExtensibleEvents, [{\n    key: \"unknownInterpretOrder\",\n    get:\n    /**\n     * Gets the order the internal processor will use for unknown primary\n     * event types.\n     */\n    function get() {\n      var _this$_unknownInterpr;\n\n      return (_this$_unknownInterpr = this._unknownInterpretOrder) !== null && _this$_unknownInterpr !== void 0 ? _this$_unknownInterpr : [];\n    }\n    /**\n     * Sets the order the internal processor will use for unknown primary\n     * event types.\n     * @param {NamespacedValue<string, string>[]} val The parsing order.\n     */\n    ,\n    set: function set(val) {\n      this._unknownInterpretOrder = val;\n    }\n    /**\n     * Gets the order the internal processor will use for unknown primary\n     * event types.\n     */\n\n  }, {\n    key: \"registerInterpreter\",\n    value:\n    /**\n     * Registers a primary event type interpreter. Note that the interpreter might be\n     * called with non-primary events if the event is being parsed as a fallback.\n     * @param {NamespacedValue<string, string>} wireEventType The event type.\n     * @param {EventInterpreter} interpreter The interpreter.\n     */\n    function registerInterpreter(wireEventType, interpreter) {\n      this.interpreters.set(wireEventType, interpreter);\n    }\n    /**\n     * Registers a primary event type interpreter. Note that the interpreter might be\n     * called with non-primary events if the event is being parsed as a fallback.\n     * @param {NamespacedValue<string, string>} wireEventType The event type.\n     * @param {EventInterpreter} interpreter The interpreter.\n     */\n\n  }, {\n    key: \"parse\",\n    value:\n    /**\n     * Parses an event, trying the primary event type first. If the primary type is not known\n     * then the content will be inspected to find the most suitable fallback.\n     *\n     * If the parsing failed or was a completely unknown type, this will return falsy.\n     * @param {IPartialEvent<object>} wireFormat The event to parse.\n     * @returns {Optional<ExtensibleEvent>} The parsed extensible event.\n     */\n    function parse(wireFormat) {\n      try {\n        if (this.interpreters.hasNamespaced(wireFormat.type)) {\n          return this.interpreters.getNamespaced(wireFormat.type)(wireFormat);\n        }\n\n        var _iterator = _createForOfIteratorHelper(this.unknownInterpretOrder),\n            _step;\n\n        try {\n          for (_iterator.s(); !(_step = _iterator.n()).done;) {\n            var tryType = _step.value;\n\n            if (this.interpreters.has(tryType)) {\n              var val = this.interpreters.get(tryType)(wireFormat);\n              if (val) return val;\n            }\n          }\n        } catch (err) {\n          _iterator.e(err);\n        } finally {\n          _iterator.f();\n        }\n\n        return null; // cannot be parsed\n      } catch (e) {\n        if (e instanceof _InvalidEventError.InvalidEventError) {\n          return null; // fail parsing and move on\n        }\n\n        throw e; // re-throw everything else\n      }\n    }\n    /**\n     * Parses an event, trying the primary event type first. If the primary type is not known\n     * then the content will be inspected to find the most suitable fallback.\n     *\n     * If the parsing failed or was a completely unknown type, this will return falsy.\n     * @param {IPartialEvent<object>} wireFormat The event to parse.\n     * @returns {Optional<ExtensibleEvent>} The parsed extensible event.\n     */\n\n  }], [{\n    key: \"defaultInstance\",\n    get: function get() {\n      return ExtensibleEvents._defaultInstance;\n    }\n  }, {\n    key: \"unknownInterpretOrder\",\n    get: function get() {\n      return ExtensibleEvents.defaultInstance.unknownInterpretOrder;\n    }\n    /**\n     * Sets the order the internal processor will use for unknown primary\n     * event types.\n     * @param {NamespacedValue<string, string>[]} val The parsing order.\n     */\n    ,\n    set: function set(val) {\n      ExtensibleEvents.defaultInstance.unknownInterpretOrder = val;\n    }\n  }, {\n    key: \"registerInterpreter\",\n    value: function registerInterpreter(wireEventType, interpreter) {\n      ExtensibleEvents.defaultInstance.registerInterpreter(wireEventType, interpreter);\n    }\n  }, {\n    key: \"parse\",\n    value: function parse(wireFormat) {\n      return ExtensibleEvents.defaultInstance.parse(wireFormat);\n    }\n  }]);\n\n  return ExtensibleEvents;\n}();\n\nexports.ExtensibleEvents = ExtensibleEvents;\n\n_defineProperty(ExtensibleEvents, \"_defaultInstance\", new ExtensibleEvents());","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});","\"use strict\";\n\nfunction _typeof(obj) { \"@babel/helpers - typeof\"; return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && \"function\" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }, _typeof(obj); }\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.InvalidEventError = void 0;\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); Object.defineProperty(subClass, \"prototype\", { writable: false }); if (superClass) _setPrototypeOf(subClass, superClass); }\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) { return call; } else if (call !== void 0) { throw new TypeError(\"Derived constructors may only return object or undefined\"); } return _assertThisInitialized(self); }\n\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nfunction _wrapNativeSuper(Class) { var _cache = typeof Map === \"function\" ? new Map() : undefined; _wrapNativeSuper = function _wrapNativeSuper(Class) { if (Class === null || !_isNativeFunction(Class)) return Class; if (typeof Class !== \"function\") { throw new TypeError(\"Super expression must either be null or a function\"); } if (typeof _cache !== \"undefined\") { if (_cache.has(Class)) return _cache.get(Class); _cache.set(Class, Wrapper); } function Wrapper() { return _construct(Class, arguments, _getPrototypeOf(this).constructor); } Wrapper.prototype = Object.create(Class.prototype, { constructor: { value: Wrapper, enumerable: false, writable: true, configurable: true } }); return _setPrototypeOf(Wrapper, Class); }; return _wrapNativeSuper(Class); }\n\nfunction _construct(Parent, args, Class) { if (_isNativeReflectConstruct()) { _construct = Reflect.construct; } else { _construct = function _construct(Parent, args, Class) { var a = [null]; a.push.apply(a, args); var Constructor = Function.bind.apply(Parent, a); var instance = new Constructor(); if (Class) _setPrototypeOf(instance, Class.prototype); return instance; }; } return _construct.apply(null, arguments); }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nfunction _isNativeFunction(fn) { return Function.toString.call(fn).indexOf(\"[native code]\") !== -1; }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\n\n/*\nCopyright 2022 The Matrix.org Foundation C.I.C.\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\n\n/**\n * Thrown when an event is unforgivably unparsable.\n */\nvar InvalidEventError = /*#__PURE__*/function (_Error) {\n  _inherits(InvalidEventError, _Error);\n\n  var _super = _createSuper(InvalidEventError);\n\n  function InvalidEventError(message) {\n    _classCallCheck(this, InvalidEventError);\n\n    return _super.call(this, message);\n  }\n\n  return _createClass(InvalidEventError);\n}( /*#__PURE__*/_wrapNativeSuper(Error));\n\nexports.InvalidEventError = InvalidEventError;","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.NamespacedMap = void 0;\n\nfunction _createForOfIteratorHelper(o, allowArrayLike) { var it = typeof Symbol !== \"undefined\" && o[Symbol.iterator] || o[\"@@iterator\"]; if (!it) { if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") { if (it) o = it; var i = 0; var F = function F() {}; return { s: F, n: function n() { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }, e: function e(_e) { throw _e; }, f: F }; } throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); } var normalCompletion = true, didErr = false, err; return { s: function s() { it = it.call(o); }, n: function n() { var step = it.next(); normalCompletion = step.done; return step; }, e: function e(_e2) { didErr = true; err = _e2; }, f: function f() { try { if (!normalCompletion && it[\"return\"] != null) it[\"return\"](); } finally { if (didErr) throw err; } } }; }\n\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\n/**\n * A `Map` implementation which accepts a NamespacedValue as a key, and arbitrary value. The\n * namespaced value must be a string type.\n */\nvar NamespacedMap = /*#__PURE__*/function () {\n  // protected to make tests happy for access\n\n  /**\n   * Creates a new map with optional seed data.\n   * @param {Array<[NS, V]>} initial The seed data.\n   */\n  function NamespacedMap(initial) {\n    _classCallCheck(this, NamespacedMap);\n\n    _defineProperty(this, \"internalMap\", new Map());\n\n    if (initial) {\n      var _iterator = _createForOfIteratorHelper(initial),\n          _step;\n\n      try {\n        for (_iterator.s(); !(_step = _iterator.n()).done;) {\n          var val = _step.value;\n          this.set(val[0], val[1]);\n        }\n      } catch (err) {\n        _iterator.e(err);\n      } finally {\n        _iterator.f();\n      }\n    }\n  }\n  /**\n   * Gets a value from the map. If the value does not exist under\n   * either namespace option, falsy is returned.\n   * @param {NS} key The key.\n   * @returns {Optional<V>} The value, or falsy.\n   */\n\n\n  _createClass(NamespacedMap, [{\n    key: \"get\",\n    value: function get(key) {\n      if (key.name && this.internalMap.has(key.name)) {\n        return this.internalMap.get(key.name);\n      }\n\n      if (key.altName && this.internalMap.has(key.altName)) {\n        return this.internalMap.get(key.altName);\n      }\n\n      return null;\n    }\n    /**\n     * Sets a value in the map.\n     * @param {NS} key The key.\n     * @param {V} val The value.\n     */\n\n  }, {\n    key: \"set\",\n    value: function set(key, val) {\n      if (key.name) {\n        this.internalMap.set(key.name, val);\n      }\n\n      if (key.altName) {\n        this.internalMap.set(key.altName, val);\n      }\n    }\n    /**\n     * Determines if any of the valid namespaced values are present\n     * in the map.\n     * @param {NS} key The key.\n     * @returns {boolean} True if present.\n     */\n\n  }, {\n    key: \"has\",\n    value: function has(key) {\n      return !!this.get(key);\n    }\n    /**\n     * Removes all the namespaced values from the map.\n     * @param {NS} key The key.\n     */\n\n  }, {\n    key: \"delete\",\n    value: function _delete(key) {\n      if (key.name) {\n        this.internalMap[\"delete\"](key.name);\n      }\n\n      if (key.altName) {\n        this.internalMap[\"delete\"](key.altName);\n      }\n    }\n    /**\n     * Determines if the map contains a specific namespaced value\n     * instead of the parent NS type.\n     * @param {string} key The key.\n     * @returns {boolean} True if present.\n     */\n\n  }, {\n    key: \"hasNamespaced\",\n    value: function hasNamespaced(key) {\n      return this.internalMap.has(key);\n    }\n    /**\n     * Gets a specific namespaced value from the map instead of the\n     * parent NS type. Returns falsy if not found.\n     * @param {string} key The key.\n     * @returns {Optional<V>} The value, or falsy.\n     */\n\n  }, {\n    key: \"getNamespaced\",\n    value: function getNamespaced(key) {\n      return this.internalMap.get(key);\n    }\n  }]);\n\n  return NamespacedMap;\n}();\n\nexports.NamespacedMap = NamespacedMap;","\"use strict\";\n\nfunction _typeof(obj) { \"@babel/helpers - typeof\"; return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && \"function\" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }, _typeof(obj); }\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.UnstableValue = exports.NamespacedValue = void 0;\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); Object.defineProperty(subClass, \"prototype\", { writable: false }); if (superClass) _setPrototypeOf(subClass, superClass); }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) { return call; } else if (call !== void 0) { throw new TypeError(\"Derived constructors may only return object or undefined\"); } return _assertThisInitialized(self); }\n\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\n\n/*\nCopyright 2021 - 2022 The Matrix.org Foundation C.I.C.\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\n\n/**\n * Represents a simple Matrix namespaced value. This will assume that if a stable prefix\n * is provided that the stable prefix should be used when representing the identifier.\n */\nvar NamespacedValue = /*#__PURE__*/function () {\n  // Stable is optional, but one of the two parameters is required, hence the weird-looking types.\n  // Goal is to have developers explicitly say there is no stable value (if applicable).\n  function NamespacedValue(stable, unstable) {\n    _classCallCheck(this, NamespacedValue);\n\n    this.stable = stable;\n    this.unstable = unstable;\n\n    if (!this.unstable && !this.stable) {\n      throw new Error(\"One of stable or unstable values must be supplied\");\n    }\n  }\n\n  _createClass(NamespacedValue, [{\n    key: \"name\",\n    get: function get() {\n      if (this.stable) {\n        return this.stable;\n      }\n\n      return this.unstable;\n    }\n  }, {\n    key: \"altName\",\n    get: function get() {\n      if (!this.stable) {\n        return null;\n      }\n\n      return this.unstable;\n    }\n  }, {\n    key: \"matches\",\n    value: function matches(val) {\n      return !!this.name && this.name === val || !!this.altName && this.altName === val;\n    } // this desperately wants https://github.com/microsoft/TypeScript/pull/26349 at the top level of the class\n    // so we can instantiate `NamespacedValue<string, _, _>` as a default type for that namespace.\n\n  }, {\n    key: \"findIn\",\n    value: function findIn(obj) {\n      var val;\n\n      if (this.name) {\n        val = obj === null || obj === void 0 ? void 0 : obj[this.name];\n      }\n\n      if (!val && this.altName) {\n        val = obj === null || obj === void 0 ? void 0 : obj[this.altName];\n      }\n\n      return val;\n    }\n  }, {\n    key: \"includedIn\",\n    value: function includedIn(arr) {\n      var included = false;\n\n      if (this.name) {\n        included = arr.includes(this.name);\n      }\n\n      if (!included && this.altName) {\n        included = arr.includes(this.altName);\n      }\n\n      return included;\n    }\n  }]);\n\n  return NamespacedValue;\n}();\n/**\n * Represents a namespaced value which prioritizes the unstable value over the stable\n * value.\n */\n\n\nexports.NamespacedValue = NamespacedValue;\n\nvar UnstableValue = /*#__PURE__*/function (_NamespacedValue) {\n  _inherits(UnstableValue, _NamespacedValue);\n\n  var _super = _createSuper(UnstableValue);\n\n  // Note: Constructor difference is that `unstable` is *required*.\n  function UnstableValue(stable, unstable) {\n    var _this;\n\n    _classCallCheck(this, UnstableValue);\n\n    _this = _super.call(this, stable, unstable);\n\n    if (!_this.unstable) {\n      throw new Error(\"Unstable value must be supplied\");\n    }\n\n    return _this;\n  }\n\n  _createClass(UnstableValue, [{\n    key: \"name\",\n    get: function get() {\n      return this.unstable;\n    }\n  }, {\n    key: \"altName\",\n    get: function get() {\n      return this.stable;\n    }\n  }]);\n\n  return UnstableValue;\n}(NamespacedValue);\n\nexports.UnstableValue = UnstableValue;","\"use strict\";\n\nfunction _typeof(obj) { \"@babel/helpers - typeof\"; return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && \"function\" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }, _typeof(obj); }\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.EmoteEvent = void 0;\n\nvar _MessageEvent2 = require(\"./MessageEvent\");\n\nvar _message_types = require(\"./message_types\");\n\nvar _events = require(\"../utility/events\");\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\n\nfunction _get() { if (typeof Reflect !== \"undefined\" && Reflect.get) { _get = Reflect.get; } else { _get = function _get(target, property, receiver) { var base = _superPropBase(target, property); if (!base) return; var desc = Object.getOwnPropertyDescriptor(base, property); if (desc.get) { return desc.get.call(arguments.length < 3 ? target : receiver); } return desc.value; }; } return _get.apply(this, arguments); }\n\nfunction _superPropBase(object, property) { while (!Object.prototype.hasOwnProperty.call(object, property)) { object = _getPrototypeOf(object); if (object === null) break; } return object; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); Object.defineProperty(subClass, \"prototype\", { writable: false }); if (superClass) _setPrototypeOf(subClass, superClass); }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) { return call; } else if (call !== void 0) { throw new TypeError(\"Derived constructors may only return object or undefined\"); } return _assertThisInitialized(self); }\n\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\n\n// Emote events are just decorated message events\n\n/**\n * Represents an emote. This is essentially a MessageEvent with\n * emote characteristics considered.\n */\nvar EmoteEvent = /*#__PURE__*/function (_MessageEvent) {\n  _inherits(EmoteEvent, _MessageEvent);\n\n  var _super = _createSuper(EmoteEvent);\n\n  function EmoteEvent(wireFormat) {\n    _classCallCheck(this, EmoteEvent);\n\n    return _super.call(this, wireFormat);\n  }\n\n  _createClass(EmoteEvent, [{\n    key: \"isEmote\",\n    get: function get() {\n      return true; // override\n    }\n  }, {\n    key: \"isEquivalentTo\",\n    value: function isEquivalentTo(primaryEventType) {\n      return (0, _events.isEventTypeSame)(primaryEventType, _message_types.M_EMOTE) || _get(_getPrototypeOf(EmoteEvent.prototype), \"isEquivalentTo\", this).call(this, primaryEventType);\n    }\n  }, {\n    key: \"serialize\",\n    value: function serialize() {\n      var message = _get(_getPrototypeOf(EmoteEvent.prototype), \"serialize\", this).call(this);\n\n      message.content['msgtype'] = \"m.emote\";\n      return message;\n    }\n    /**\n     * Creates a new EmoteEvent from text and HTML.\n     * @param {string} text The text.\n     * @param {string} html Optional HTML.\n     * @returns {MessageEvent} The representative message event.\n     */\n\n  }], [{\n    key: \"from\",\n    value: function from(text, html) {\n      var _content;\n\n      return new EmoteEvent({\n        type: _message_types.M_EMOTE.name,\n        content: (_content = {}, _defineProperty(_content, _message_types.M_TEXT.name, text), _defineProperty(_content, _message_types.M_HTML.name, html), _content)\n      });\n    }\n  }]);\n\n  return EmoteEvent;\n}(_MessageEvent2.MessageEvent);\n\nexports.EmoteEvent = EmoteEvent;","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.ExtensibleEvent = void 0;\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\n\n/*\nCopyright 2021 - 2022 The Matrix.org Foundation C.I.C.\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\n\n/**\n * Represents an Extensible Event in Matrix.\n */\nvar ExtensibleEvent = /*#__PURE__*/function () {\n  function ExtensibleEvent(wireFormat) {\n    _classCallCheck(this, ExtensibleEvent);\n\n    this.wireFormat = wireFormat;\n  }\n  /**\n   * Shortcut to wireFormat.content\n   */\n\n\n  _createClass(ExtensibleEvent, [{\n    key: \"wireContent\",\n    get: function get() {\n      return this.wireFormat.content;\n    }\n    /**\n     * Serializes the event into a format which can be used to send the\n     * event to the room.\n     * @returns {IPartialEvent<object>} The serialized event.\n     */\n\n  }]);\n\n  return ExtensibleEvent;\n}();\n\nexports.ExtensibleEvent = ExtensibleEvent;","\"use strict\";\n\nfunction _typeof(obj) { \"@babel/helpers - typeof\"; return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && \"function\" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }, _typeof(obj); }\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.MessageEvent = void 0;\n\nvar _ExtensibleEvent2 = require(\"./ExtensibleEvent\");\n\nvar _types = require(\"../types\");\n\nvar _InvalidEventError = require(\"../InvalidEventError\");\n\nvar _message_types = require(\"./message_types\");\n\nvar _events = require(\"../utility/events\");\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); Object.defineProperty(subClass, \"prototype\", { writable: false }); if (superClass) _setPrototypeOf(subClass, superClass); }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) { return call; } else if (call !== void 0) { throw new TypeError(\"Derived constructors may only return object or undefined\"); } return _assertThisInitialized(self); }\n\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\n/**\n * Represents a message event. Message events are the simplest form of event with\n * just text (optionally of different mimetypes, like HTML).\n *\n * Message events can additionally be an Emote or Notice, though typically those\n * are represented as EmoteEvent and NoticeEvent respectively.\n */\nvar MessageEvent = /*#__PURE__*/function (_ExtensibleEvent) {\n  _inherits(MessageEvent, _ExtensibleEvent);\n\n  var _super = _createSuper(MessageEvent);\n\n  /**\n   * The default text for the event.\n   */\n\n  /**\n   * The default HTML for the event, if provided.\n   */\n\n  /**\n   * All the different renderings of the message. Note that this is the same\n   * format as an m.message body but may contain elements not found directly\n   * in the event content: this is because this is interpreted based off the\n   * other information available in the event.\n   */\n\n  /**\n   * Creates a new MessageEvent from a pure format. Note that the event is\n   * *not* parsed here: it will be treated as a literal m.message primary\n   * typed event.\n   * @param {IPartialEvent<M_MESSAGE_EVENT_CONTENT>} wireFormat The event.\n   */\n  function MessageEvent(wireFormat) {\n    var _this;\n\n    _classCallCheck(this, MessageEvent);\n\n    _this = _super.call(this, wireFormat);\n\n    _defineProperty(_assertThisInitialized(_this), \"text\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"html\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"renderings\", void 0);\n\n    var mmessage = _message_types.M_MESSAGE.findIn(_this.wireContent);\n\n    var mtext = _message_types.M_TEXT.findIn(_this.wireContent);\n\n    var mhtml = _message_types.M_HTML.findIn(_this.wireContent);\n\n    if ((0, _types.isProvided)(mmessage)) {\n      if (!Array.isArray(mmessage)) {\n        throw new _InvalidEventError.InvalidEventError(\"m.message contents must be an array\");\n      }\n\n      var text = mmessage.find(function (r) {\n        return !(0, _types.isProvided)(r.mimetype) || r.mimetype === \"text/plain\";\n      });\n      var html = mmessage.find(function (r) {\n        return r.mimetype === \"text/html\";\n      });\n      if (!text) throw new _InvalidEventError.InvalidEventError(\"m.message is missing a plain text representation\");\n      _this.text = text.body;\n      _this.html = html === null || html === void 0 ? void 0 : html.body;\n      _this.renderings = mmessage;\n    } else if ((0, _types.isOptionalAString)(mtext)) {\n      _this.text = mtext;\n      _this.html = mhtml;\n      _this.renderings = [{\n        body: mtext,\n        mimetype: \"text/plain\"\n      }];\n\n      if (_this.html) {\n        _this.renderings.push({\n          body: _this.html,\n          mimetype: \"text/html\"\n        });\n      }\n    } else {\n      throw new _InvalidEventError.InvalidEventError(\"Missing textual representation for event\");\n    }\n\n    return _this;\n  }\n  /**\n   * Gets whether this message is considered an \"emote\". Note that a message\n   * might be an emote and notice at the same time: while technically possible,\n   * the event should be interpreted as one or the other.\n   */\n\n\n  _createClass(MessageEvent, [{\n    key: \"isEmote\",\n    get: function get() {\n      return _message_types.M_EMOTE.matches(this.wireFormat.type) || (0, _types.isProvided)(_message_types.M_EMOTE.findIn(this.wireFormat.content));\n    }\n    /**\n     * Gets whether this message is considered a \"notice\". Note that a message\n     * might be an emote and notice at the same time: while technically possible,\n     * the event should be interpreted as one or the other.\n     */\n\n  }, {\n    key: \"isNotice\",\n    get: function get() {\n      return _message_types.M_NOTICE.matches(this.wireFormat.type) || (0, _types.isProvided)(_message_types.M_NOTICE.findIn(this.wireFormat.content));\n    }\n  }, {\n    key: \"isEquivalentTo\",\n    value: function isEquivalentTo(primaryEventType) {\n      return (0, _events.isEventTypeSame)(primaryEventType, _message_types.M_MESSAGE);\n    }\n  }, {\n    key: \"serializeMMessageOnly\",\n    value: function serializeMMessageOnly() {\n      var messageRendering = _defineProperty({}, _message_types.M_MESSAGE.name, this.renderings); // Use the shorthand if it's just a simple text event\n\n\n      if (this.renderings.length === 1) {\n        var mime = this.renderings[0].mimetype;\n\n        if (mime === undefined || mime === \"text/plain\") {\n          messageRendering = _defineProperty({}, _message_types.M_TEXT.name, this.renderings[0].body);\n        }\n      }\n\n      return messageRendering;\n    }\n  }, {\n    key: \"serialize\",\n    value: function serialize() {\n      var _this$html;\n\n      return {\n        type: \"m.room.message\",\n        content: _objectSpread(_objectSpread({}, this.serializeMMessageOnly()), {}, {\n          body: this.text,\n          msgtype: \"m.text\",\n          format: this.html ? \"org.matrix.custom.html\" : undefined,\n          formatted_body: (_this$html = this.html) !== null && _this$html !== void 0 ? _this$html : undefined\n        })\n      };\n    }\n    /**\n     * Creates a new MessageEvent from text and HTML.\n     * @param {string} text The text.\n     * @param {string} html Optional HTML.\n     * @returns {MessageEvent} The representative message event.\n     */\n\n  }], [{\n    key: \"from\",\n    value: function from(text, html) {\n      var _content;\n\n      return new MessageEvent({\n        type: _message_types.M_MESSAGE.name,\n        content: (_content = {}, _defineProperty(_content, _message_types.M_TEXT.name, text), _defineProperty(_content, _message_types.M_HTML.name, html), _content)\n      });\n    }\n  }]);\n\n  return MessageEvent;\n}(_ExtensibleEvent2.ExtensibleEvent);\n\nexports.MessageEvent = MessageEvent;","\"use strict\";\n\nfunction _typeof(obj) { \"@babel/helpers - typeof\"; return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && \"function\" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }, _typeof(obj); }\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.NoticeEvent = void 0;\n\nvar _MessageEvent2 = require(\"./MessageEvent\");\n\nvar _message_types = require(\"./message_types\");\n\nvar _events = require(\"../utility/events\");\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\n\nfunction _get() { if (typeof Reflect !== \"undefined\" && Reflect.get) { _get = Reflect.get; } else { _get = function _get(target, property, receiver) { var base = _superPropBase(target, property); if (!base) return; var desc = Object.getOwnPropertyDescriptor(base, property); if (desc.get) { return desc.get.call(arguments.length < 3 ? target : receiver); } return desc.value; }; } return _get.apply(this, arguments); }\n\nfunction _superPropBase(object, property) { while (!Object.prototype.hasOwnProperty.call(object, property)) { object = _getPrototypeOf(object); if (object === null) break; } return object; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); Object.defineProperty(subClass, \"prototype\", { writable: false }); if (superClass) _setPrototypeOf(subClass, superClass); }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) { return call; } else if (call !== void 0) { throw new TypeError(\"Derived constructors may only return object or undefined\"); } return _assertThisInitialized(self); }\n\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\n\n// Notice events are just decorated message events\n\n/**\n * Represents a notice. This is essentially a MessageEvent with\n * notice characteristics considered.\n */\nvar NoticeEvent = /*#__PURE__*/function (_MessageEvent) {\n  _inherits(NoticeEvent, _MessageEvent);\n\n  var _super = _createSuper(NoticeEvent);\n\n  function NoticeEvent(wireFormat) {\n    _classCallCheck(this, NoticeEvent);\n\n    return _super.call(this, wireFormat);\n  }\n\n  _createClass(NoticeEvent, [{\n    key: \"isNotice\",\n    get: function get() {\n      return true; // override\n    }\n  }, {\n    key: \"isEquivalentTo\",\n    value: function isEquivalentTo(primaryEventType) {\n      return (0, _events.isEventTypeSame)(primaryEventType, _message_types.M_NOTICE) || _get(_getPrototypeOf(NoticeEvent.prototype), \"isEquivalentTo\", this).call(this, primaryEventType);\n    }\n  }, {\n    key: \"serialize\",\n    value: function serialize() {\n      var message = _get(_getPrototypeOf(NoticeEvent.prototype), \"serialize\", this).call(this);\n\n      message.content['msgtype'] = \"m.notice\";\n      return message;\n    }\n    /**\n     * Creates a new NoticeEvent from text and HTML.\n     * @param {string} text The text.\n     * @param {string} html Optional HTML.\n     * @returns {MessageEvent} The representative message event.\n     */\n\n  }], [{\n    key: \"from\",\n    value: function from(text, html) {\n      var _content;\n\n      return new NoticeEvent({\n        type: _message_types.M_NOTICE.name,\n        content: (_content = {}, _defineProperty(_content, _message_types.M_TEXT.name, text), _defineProperty(_content, _message_types.M_HTML.name, html), _content)\n      });\n    }\n  }]);\n\n  return NoticeEvent;\n}(_MessageEvent2.MessageEvent);\n\nexports.NoticeEvent = NoticeEvent;","\"use strict\";\n\nfunction _typeof(obj) { \"@babel/helpers - typeof\"; return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && \"function\" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }, _typeof(obj); }\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.PollEndEvent = void 0;\n\nvar _poll_types = require(\"./poll_types\");\n\nvar _InvalidEventError = require(\"../InvalidEventError\");\n\nvar _relationship_types = require(\"./relationship_types\");\n\nvar _MessageEvent = require(\"./MessageEvent\");\n\nvar _message_types = require(\"./message_types\");\n\nvar _events = require(\"../utility/events\");\n\nvar _ExtensibleEvent2 = require(\"./ExtensibleEvent\");\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); Object.defineProperty(subClass, \"prototype\", { writable: false }); if (superClass) _setPrototypeOf(subClass, superClass); }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) { return call; } else if (call !== void 0) { throw new TypeError(\"Derived constructors may only return object or undefined\"); } return _assertThisInitialized(self); }\n\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\n/**\n * Represents a poll end/closure event.\n */\nvar PollEndEvent = /*#__PURE__*/function (_ExtensibleEvent) {\n  _inherits(PollEndEvent, _ExtensibleEvent);\n\n  var _super = _createSuper(PollEndEvent);\n\n  /**\n   * The poll start event ID referenced by the response.\n   */\n\n  /**\n   * The closing message for the event.\n   */\n\n  /**\n   * Creates a new PollEndEvent from a pure format. Note that the event is *not*\n   * parsed here: it will be treated as a literal m.poll.response primary typed event.\n   * @param {IPartialEvent<M_POLL_END_EVENT_CONTENT>} wireFormat The event.\n   */\n  function PollEndEvent(wireFormat) {\n    var _this;\n\n    _classCallCheck(this, PollEndEvent);\n\n    _this = _super.call(this, wireFormat);\n\n    _defineProperty(_assertThisInitialized(_this), \"pollEventId\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"closingMessage\", void 0);\n\n    var rel = _this.wireContent[\"m.relates_to\"];\n\n    if (!_relationship_types.REFERENCE_RELATION.matches(rel === null || rel === void 0 ? void 0 : rel.rel_type) || typeof (rel === null || rel === void 0 ? void 0 : rel.event_id) !== \"string\") {\n      throw new _InvalidEventError.InvalidEventError(\"Relationship must be a reference to an event\");\n    }\n\n    _this.pollEventId = rel.event_id;\n    _this.closingMessage = new _MessageEvent.MessageEvent(_this.wireFormat);\n    return _this;\n  }\n\n  _createClass(PollEndEvent, [{\n    key: \"isEquivalentTo\",\n    value: function isEquivalentTo(primaryEventType) {\n      return (0, _events.isEventTypeSame)(primaryEventType, _poll_types.M_POLL_END);\n    }\n  }, {\n    key: \"serialize\",\n    value: function serialize() {\n      return {\n        type: _poll_types.M_POLL_END.name,\n        content: _objectSpread(_defineProperty({\n          \"m.relates_to\": {\n            rel_type: _relationship_types.REFERENCE_RELATION.name,\n            event_id: this.pollEventId\n          }\n        }, _poll_types.M_POLL_END.name, {}), this.closingMessage.serialize().content)\n      };\n    }\n    /**\n     * Creates a new PollEndEvent from a poll event ID.\n     * @param {string} pollEventId The poll start event ID.\n     * @param {string} message A closing message, typically revealing the top answer.\n     * @returns {PollStartEvent} The representative poll closure event.\n     */\n\n  }], [{\n    key: \"from\",\n    value: function from(pollEventId, message) {\n      var _content;\n\n      return new PollEndEvent({\n        type: _poll_types.M_POLL_END.name,\n        content: (_content = {\n          \"m.relates_to\": {\n            rel_type: _relationship_types.REFERENCE_RELATION.name,\n            event_id: pollEventId\n          }\n        }, _defineProperty(_content, _poll_types.M_POLL_END.name, {}), _defineProperty(_content, _message_types.M_TEXT.name, message), _content)\n      });\n    }\n  }]);\n\n  return PollEndEvent;\n}(_ExtensibleEvent2.ExtensibleEvent);\n\nexports.PollEndEvent = PollEndEvent;","\"use strict\";\n\nfunction _typeof(obj) { \"@babel/helpers - typeof\"; return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && \"function\" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }, _typeof(obj); }\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.PollResponseEvent = void 0;\n\nvar _ExtensibleEvent2 = require(\"./ExtensibleEvent\");\n\nvar _poll_types = require(\"./poll_types\");\n\nvar _InvalidEventError = require(\"../InvalidEventError\");\n\nvar _relationship_types = require(\"./relationship_types\");\n\nvar _events = require(\"../utility/events\");\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); Object.defineProperty(subClass, \"prototype\", { writable: false }); if (superClass) _setPrototypeOf(subClass, superClass); }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) { return call; } else if (call !== void 0) { throw new TypeError(\"Derived constructors may only return object or undefined\"); } return _assertThisInitialized(self); }\n\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\n/**\n * Represents a poll response event.\n */\nvar PollResponseEvent = /*#__PURE__*/function (_ExtensibleEvent) {\n  _inherits(PollResponseEvent, _ExtensibleEvent);\n\n  var _super = _createSuper(PollResponseEvent);\n\n  /**\n   * Creates a new PollResponseEvent from a pure format. Note that the event is *not*\n   * parsed here: it will be treated as a literal m.poll.response primary typed event.\n   *\n   * To validate the response against a poll, call `validateAgainst` after creation.\n   * @param {IPartialEvent<M_POLL_RESPONSE_EVENT_CONTENT>} wireFormat The event.\n   */\n  function PollResponseEvent(wireFormat) {\n    var _this;\n\n    _classCallCheck(this, PollResponseEvent);\n\n    _this = _super.call(this, wireFormat);\n\n    _defineProperty(_assertThisInitialized(_this), \"internalAnswerIds\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"internalSpoiled\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"pollEventId\", void 0);\n\n    var rel = _this.wireContent[\"m.relates_to\"];\n\n    if (!_relationship_types.REFERENCE_RELATION.matches(rel === null || rel === void 0 ? void 0 : rel.rel_type) || typeof (rel === null || rel === void 0 ? void 0 : rel.event_id) !== \"string\") {\n      throw new _InvalidEventError.InvalidEventError(\"Relationship must be a reference to an event\");\n    }\n\n    _this.pollEventId = rel.event_id;\n\n    _this.validateAgainst(null);\n\n    return _this;\n  }\n  /**\n   * Validates the poll response using the poll start event as a frame of reference. This\n   * is used to determine if the vote is spoiled, whether the answers are valid, etc.\n   * @param {PollStartEvent} poll The poll start event.\n   */\n\n\n  _createClass(PollResponseEvent, [{\n    key: \"answerIds\",\n    get:\n    /**\n     * The provided answers for the poll. Note that this may be falsy/unpredictable if\n     * the `spoiled` property is true.\n     */\n    function get() {\n      return this.internalAnswerIds;\n    }\n    /**\n     * The poll start event ID referenced by the response.\n     */\n\n  }, {\n    key: \"spoiled\",\n    get:\n    /**\n     * Whether the vote is spoiled.\n     */\n    function get() {\n      return this.internalSpoiled;\n    }\n  }, {\n    key: \"validateAgainst\",\n    value: function validateAgainst(poll) {\n      var response = _poll_types.M_POLL_RESPONSE.findIn(this.wireContent);\n\n      if (!Array.isArray(response === null || response === void 0 ? void 0 : response.answers)) {\n        this.internalSpoiled = true;\n        this.internalAnswerIds = [];\n        return;\n      }\n\n      var answers = response.answers;\n\n      if (answers.some(function (a) {\n        return typeof a !== \"string\";\n      }) || answers.length === 0) {\n        this.internalSpoiled = true;\n        this.internalAnswerIds = [];\n        return;\n      }\n\n      if (poll) {\n        if (answers.some(function (a) {\n          return !poll.answers.some(function (pa) {\n            return pa.id === a;\n          });\n        })) {\n          this.internalSpoiled = true;\n          this.internalAnswerIds = [];\n          return;\n        }\n\n        answers = answers.slice(0, poll.maxSelections);\n      }\n\n      this.internalAnswerIds = answers;\n      this.internalSpoiled = false;\n    }\n  }, {\n    key: \"isEquivalentTo\",\n    value: function isEquivalentTo(primaryEventType) {\n      return (0, _events.isEventTypeSame)(primaryEventType, _poll_types.M_POLL_RESPONSE);\n    }\n  }, {\n    key: \"serialize\",\n    value: function serialize() {\n      return {\n        type: _poll_types.M_POLL_RESPONSE.name,\n        content: _defineProperty({\n          \"m.relates_to\": {\n            rel_type: _relationship_types.REFERENCE_RELATION.name,\n            event_id: this.pollEventId\n          }\n        }, _poll_types.M_POLL_RESPONSE.name, {\n          answers: this.spoiled ? undefined : this.answerIds\n        })\n      };\n    }\n    /**\n     * Creates a new PollResponseEvent from a set of answers. To spoil the vote, pass an empty\n     * answers array.\n     * @param {string} answers The user's answers. Should be valid from a poll's answer IDs.\n     * @param {string} pollEventId The poll start event ID.\n     * @returns {PollStartEvent} The representative poll response event.\n     */\n\n  }], [{\n    key: \"from\",\n    value: function from(answers, pollEventId) {\n      return new PollResponseEvent({\n        type: _poll_types.M_POLL_RESPONSE.name,\n        content: _defineProperty({\n          \"m.relates_to\": {\n            rel_type: _relationship_types.REFERENCE_RELATION.name,\n            event_id: pollEventId\n          }\n        }, _poll_types.M_POLL_RESPONSE.name, {\n          answers: answers\n        })\n      });\n    }\n  }]);\n\n  return PollResponseEvent;\n}(_ExtensibleEvent2.ExtensibleEvent);\n\nexports.PollResponseEvent = PollResponseEvent;","\"use strict\";\n\nfunction _typeof(obj) { \"@babel/helpers - typeof\"; return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && \"function\" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }, _typeof(obj); }\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.PollStartEvent = exports.PollAnswerSubevent = void 0;\n\nvar _poll_types = require(\"./poll_types\");\n\nvar _MessageEvent2 = require(\"./MessageEvent\");\n\nvar _message_types = require(\"./message_types\");\n\nvar _InvalidEventError = require(\"../InvalidEventError\");\n\nvar _NamespacedValue = require(\"../NamespacedValue\");\n\nvar _events = require(\"../utility/events\");\n\nvar _ExtensibleEvent2 = require(\"./ExtensibleEvent\");\n\nfunction _toConsumableArray(arr) { return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread(); }\n\nfunction _nonIterableSpread() { throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\n\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\nfunction _iterableToArray(iter) { if (typeof Symbol !== \"undefined\" && iter[Symbol.iterator] != null || iter[\"@@iterator\"] != null) return Array.from(iter); }\n\nfunction _arrayWithoutHoles(arr) { if (Array.isArray(arr)) return _arrayLikeToArray(arr); }\n\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); Object.defineProperty(subClass, \"prototype\", { writable: false }); if (superClass) _setPrototypeOf(subClass, superClass); }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) { return call; } else if (call !== void 0) { throw new TypeError(\"Derived constructors may only return object or undefined\"); } return _assertThisInitialized(self); }\n\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\n/**\n * Represents a poll answer. Note that this is represented as a subtype and is\n * not registered as a parsable event - it is implied for usage exclusively\n * within the PollStartEvent parsing.\n */\nvar PollAnswerSubevent = /*#__PURE__*/function (_MessageEvent) {\n  _inherits(PollAnswerSubevent, _MessageEvent);\n\n  var _super = _createSuper(PollAnswerSubevent);\n\n  /**\n   * The answer ID.\n   */\n  function PollAnswerSubevent(wireFormat) {\n    var _this;\n\n    _classCallCheck(this, PollAnswerSubevent);\n\n    _this = _super.call(this, wireFormat);\n\n    _defineProperty(_assertThisInitialized(_this), \"id\", void 0);\n\n    var id = wireFormat.content.id;\n\n    if (!id || typeof id !== \"string\") {\n      throw new _InvalidEventError.InvalidEventError(\"Answer ID must be a non-empty string\");\n    }\n\n    _this.id = id;\n    return _this;\n  }\n\n  _createClass(PollAnswerSubevent, [{\n    key: \"serialize\",\n    value: function serialize() {\n      return {\n        type: \"org.matrix.sdk.poll.answer\",\n        content: _objectSpread({\n          id: this.id\n        }, this.serializeMMessageOnly())\n      };\n    }\n    /**\n     * Creates a new PollAnswerSubevent from ID and text.\n     * @param {string} id The answer ID (unique within the poll).\n     * @param {string} text The text.\n     * @returns {PollAnswerSubevent} The representative answer.\n     */\n\n  }], [{\n    key: \"from\",\n    value: function from(id, text) {\n      return new PollAnswerSubevent({\n        type: \"org.matrix.sdk.poll.answer\",\n        content: _defineProperty({\n          id: id\n        }, _message_types.M_TEXT.name, text)\n      });\n    }\n  }]);\n\n  return PollAnswerSubevent;\n}(_MessageEvent2.MessageEvent);\n/**\n * Represents a poll start event.\n */\n\n\nexports.PollAnswerSubevent = PollAnswerSubevent;\n\nvar PollStartEvent = /*#__PURE__*/function (_ExtensibleEvent) {\n  _inherits(PollStartEvent, _ExtensibleEvent);\n\n  var _super2 = _createSuper(PollStartEvent);\n\n  /**\n   * The question being asked, as a MessageEvent node.\n   */\n\n  /**\n   * The interpreted kind of poll. Note that this will infer a value that is known to the\n   * SDK rather than verbatim - this means unknown types will be represented as undisclosed\n   * polls.\n   *\n   * To get the raw kind, use rawKind.\n   */\n\n  /**\n   * The true kind as provided by the event sender. Might not be valid.\n   */\n\n  /**\n   * The maximum number of selections a user is allowed to make.\n   */\n\n  /**\n   * The possible answers for the poll.\n   */\n\n  /**\n   * Creates a new PollStartEvent from a pure format. Note that the event is *not*\n   * parsed here: it will be treated as a literal m.poll.start primary typed event.\n   * @param {IPartialEvent<M_POLL_START_EVENT_CONTENT>} wireFormat The event.\n   */\n  function PollStartEvent(wireFormat) {\n    var _this2;\n\n    _classCallCheck(this, PollStartEvent);\n\n    _this2 = _super2.call(this, wireFormat);\n\n    _defineProperty(_assertThisInitialized(_this2), \"question\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this2), \"kind\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this2), \"rawKind\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this2), \"maxSelections\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this2), \"answers\", void 0);\n\n    var poll = _poll_types.M_POLL_START.findIn(_this2.wireContent);\n\n    if (!poll.question) {\n      throw new _InvalidEventError.InvalidEventError(\"A question is required\");\n    }\n\n    _this2.question = new _MessageEvent2.MessageEvent({\n      type: \"org.matrix.sdk.poll.question\",\n      content: poll.question\n    });\n    _this2.rawKind = poll.kind;\n\n    if (_poll_types.M_POLL_KIND_DISCLOSED.matches(_this2.rawKind)) {\n      _this2.kind = _poll_types.M_POLL_KIND_DISCLOSED;\n    } else {\n      _this2.kind = _poll_types.M_POLL_KIND_UNDISCLOSED; // default & assumed value\n    }\n\n    _this2.maxSelections = Number.isFinite(poll.max_selections) && poll.max_selections > 0 ? poll.max_selections : 1;\n\n    if (!Array.isArray(poll.answers)) {\n      throw new _InvalidEventError.InvalidEventError(\"Poll answers must be an array\");\n    }\n\n    var answers = poll.answers.slice(0, 20).map(function (a) {\n      return new PollAnswerSubevent({\n        type: \"org.matrix.sdk.poll.answer\",\n        content: a\n      });\n    });\n\n    if (answers.length <= 0) {\n      throw new _InvalidEventError.InvalidEventError(\"No answers available\");\n    }\n\n    _this2.answers = answers;\n    return _this2;\n  }\n\n  _createClass(PollStartEvent, [{\n    key: \"isEquivalentTo\",\n    value: function isEquivalentTo(primaryEventType) {\n      return (0, _events.isEventTypeSame)(primaryEventType, _poll_types.M_POLL_START);\n    }\n  }, {\n    key: \"serialize\",\n    value: function serialize() {\n      var _content2;\n\n      return {\n        type: _poll_types.M_POLL_START.name,\n        content: (_content2 = {}, _defineProperty(_content2, _poll_types.M_POLL_START.name, {\n          question: this.question.serialize().content,\n          kind: this.rawKind,\n          max_selections: this.maxSelections,\n          answers: this.answers.map(function (a) {\n            return a.serialize().content;\n          })\n        }), _defineProperty(_content2, _message_types.M_TEXT.name, \"\".concat(this.question.text, \"\\n\").concat(this.answers.map(function (a, i) {\n          return \"\".concat(i + 1, \". \").concat(a.text);\n        }).join(\"\\n\"))), _content2)\n      };\n    }\n    /**\n     * Creates a new PollStartEvent from question, answers, and metadata.\n     * @param {string} question The question to ask.\n     * @param {string} answers The answers. Should be unique within each other.\n     * @param {KNOWN_POLL_KIND|string} kind The kind of poll.\n     * @param {number} maxSelections The maximum number of selections. Must be 1 or higher.\n     * @returns {PollStartEvent} The representative poll start event.\n     */\n\n  }], [{\n    key: \"from\",\n    value: function from(question, answers, kind) {\n      var _content3;\n\n      var maxSelections = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 1;\n      return new PollStartEvent({\n        type: _poll_types.M_POLL_START.name,\n        content: (_content3 = {}, _defineProperty(_content3, _message_types.M_TEXT.name, question), _defineProperty(_content3, _poll_types.M_POLL_START.name, {\n          question: _defineProperty({}, _message_types.M_TEXT.name, question),\n          kind: kind instanceof _NamespacedValue.NamespacedValue ? kind.name : kind,\n          max_selections: maxSelections,\n          answers: answers.map(function (a) {\n            return _defineProperty({\n              id: makeId()\n            }, _message_types.M_TEXT.name, a);\n          })\n        }), _content3)\n      });\n    }\n  }]);\n\n  return PollStartEvent;\n}(_ExtensibleEvent2.ExtensibleEvent);\n\nexports.PollStartEvent = PollStartEvent;\nvar LETTERS = \"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789\";\n\nfunction makeId() {\n  return _toConsumableArray(Array(16)).map(function () {\n    return LETTERS.charAt(Math.floor(Math.random() * LETTERS.length));\n  }).join('');\n}","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.M_TEXT = exports.M_NOTICE = exports.M_MESSAGE = exports.M_HTML = exports.M_EMOTE = void 0;\n\nvar _NamespacedValue = require(\"../NamespacedValue\");\n\n/*\nCopyright 2022 The Matrix.org Foundation C.I.C.\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\n\n/**\n * The namespaced value for m.message\n */\nvar M_MESSAGE = new _NamespacedValue.UnstableValue(\"m.message\", \"org.matrix.msc1767.message\");\n/**\n * An m.message event rendering\n */\n\nexports.M_MESSAGE = M_MESSAGE;\n\n/**\n * The namespaced value for m.text\n */\nvar M_TEXT = new _NamespacedValue.UnstableValue(\"m.text\", \"org.matrix.msc1767.text\");\n/**\n * The content for an m.text event\n */\n\nexports.M_TEXT = M_TEXT;\n\n/**\n * The namespaced value for m.html\n */\nvar M_HTML = new _NamespacedValue.UnstableValue(\"m.html\", \"org.matrix.msc1767.html\");\n/**\n * The content for an m.html event\n */\n\nexports.M_HTML = M_HTML;\n\n/**\n * The namespaced value for m.emote\n */\nvar M_EMOTE = new _NamespacedValue.UnstableValue(\"m.emote\", \"org.matrix.msc1767.emote\");\n/**\n * The event definition for an m.emote event (in content)\n */\n\nexports.M_EMOTE = M_EMOTE;\n\n/**\n * The namespaced value for m.notice\n */\nvar M_NOTICE = new _NamespacedValue.UnstableValue(\"m.notice\", \"org.matrix.msc1767.notice\");\n/**\n * The event definition for an m.notice event (in content)\n */\n\nexports.M_NOTICE = M_NOTICE;","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.M_POLL_START = exports.M_POLL_RESPONSE = exports.M_POLL_KIND_UNDISCLOSED = exports.M_POLL_KIND_DISCLOSED = exports.M_POLL_END = void 0;\n\nvar _NamespacedValue = require(\"../NamespacedValue\");\n\n/*\nCopyright 2022 The Matrix.org Foundation C.I.C.\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\n\n/**\n * Identifier for a disclosed poll.\n */\nvar M_POLL_KIND_DISCLOSED = new _NamespacedValue.UnstableValue(\"m.poll.disclosed\", \"org.matrix.msc3381.poll.disclosed\");\n/**\n * Identifier for an undisclosed poll.\n */\n\nexports.M_POLL_KIND_DISCLOSED = M_POLL_KIND_DISCLOSED;\nvar M_POLL_KIND_UNDISCLOSED = new _NamespacedValue.UnstableValue(\"m.poll.undisclosed\", \"org.matrix.msc3381.poll.undisclosed\");\n/**\n * Any poll kind.\n */\n\nexports.M_POLL_KIND_UNDISCLOSED = M_POLL_KIND_UNDISCLOSED;\n\n/**\n * The namespaced value for m.poll.start\n */\nvar M_POLL_START = new _NamespacedValue.UnstableValue(\"m.poll.start\", \"org.matrix.msc3381.poll.start\");\n/**\n * The m.poll.start type within event content\n */\n\nexports.M_POLL_START = M_POLL_START;\n\n/**\n * The namespaced value for m.poll.response\n */\nvar M_POLL_RESPONSE = new _NamespacedValue.UnstableValue(\"m.poll.response\", \"org.matrix.msc3381.poll.response\");\n/**\n * The m.poll.response type within event content\n */\n\nexports.M_POLL_RESPONSE = M_POLL_RESPONSE;\n\n/**\n * The namespaced value for m.poll.end\n */\nvar M_POLL_END = new _NamespacedValue.UnstableValue(\"m.poll.end\", \"org.matrix.msc3381.poll.end\");\n/**\n * The event definition for an m.poll.end event (in content)\n */\n\nexports.M_POLL_END = M_POLL_END;","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.REFERENCE_RELATION = void 0;\n\nvar _NamespacedValue = require(\"../NamespacedValue\");\n\n/*\nCopyright 2022 The Matrix.org Foundation C.I.C.\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\n\n/**\n * The namespaced value for an m.reference relation\n */\nvar REFERENCE_RELATION = new _NamespacedValue.NamespacedValue(\"m.reference\");\n/**\n * Represents any relation type\n */\n\nexports.REFERENCE_RELATION = REFERENCE_RELATION;","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _ExtensibleEvents = require(\"./ExtensibleEvents\");\n\nObject.keys(_ExtensibleEvents).forEach(function (key) {\n  if (key === \"default\" || key === \"__esModule\") return;\n  if (key in exports && exports[key] === _ExtensibleEvents[key]) return;\n  Object.defineProperty(exports, key, {\n    enumerable: true,\n    get: function get() {\n      return _ExtensibleEvents[key];\n    }\n  });\n});\n\nvar _IPartialEvent = require(\"./IPartialEvent\");\n\nObject.keys(_IPartialEvent).forEach(function (key) {\n  if (key === \"default\" || key === \"__esModule\") return;\n  if (key in exports && exports[key] === _IPartialEvent[key]) return;\n  Object.defineProperty(exports, key, {\n    enumerable: true,\n    get: function get() {\n      return _IPartialEvent[key];\n    }\n  });\n});\n\nvar _InvalidEventError = require(\"./InvalidEventError\");\n\nObject.keys(_InvalidEventError).forEach(function (key) {\n  if (key === \"default\" || key === \"__esModule\") return;\n  if (key in exports && exports[key] === _InvalidEventError[key]) return;\n  Object.defineProperty(exports, key, {\n    enumerable: true,\n    get: function get() {\n      return _InvalidEventError[key];\n    }\n  });\n});\n\nvar _NamespacedValue = require(\"./NamespacedValue\");\n\nObject.keys(_NamespacedValue).forEach(function (key) {\n  if (key === \"default\" || key === \"__esModule\") return;\n  if (key in exports && exports[key] === _NamespacedValue[key]) return;\n  Object.defineProperty(exports, key, {\n    enumerable: true,\n    get: function get() {\n      return _NamespacedValue[key];\n    }\n  });\n});\n\nvar _NamespacedMap = require(\"./NamespacedMap\");\n\nObject.keys(_NamespacedMap).forEach(function (key) {\n  if (key === \"default\" || key === \"__esModule\") return;\n  if (key in exports && exports[key] === _NamespacedMap[key]) return;\n  Object.defineProperty(exports, key, {\n    enumerable: true,\n    get: function get() {\n      return _NamespacedMap[key];\n    }\n  });\n});\n\nvar _types = require(\"./types\");\n\nObject.keys(_types).forEach(function (key) {\n  if (key === \"default\" || key === \"__esModule\") return;\n  if (key in exports && exports[key] === _types[key]) return;\n  Object.defineProperty(exports, key, {\n    enumerable: true,\n    get: function get() {\n      return _types[key];\n    }\n  });\n});\n\nvar _MessageMatchers = require(\"./utility/MessageMatchers\");\n\nObject.keys(_MessageMatchers).forEach(function (key) {\n  if (key === \"default\" || key === \"__esModule\") return;\n  if (key in exports && exports[key] === _MessageMatchers[key]) return;\n  Object.defineProperty(exports, key, {\n    enumerable: true,\n    get: function get() {\n      return _MessageMatchers[key];\n    }\n  });\n});\n\nvar _events = require(\"./utility/events\");\n\nObject.keys(_events).forEach(function (key) {\n  if (key === \"default\" || key === \"__esModule\") return;\n  if (key in exports && exports[key] === _events[key]) return;\n  Object.defineProperty(exports, key, {\n    enumerable: true,\n    get: function get() {\n      return _events[key];\n    }\n  });\n});\n\nvar _MRoomMessage = require(\"./interpreters/legacy/MRoomMessage\");\n\nObject.keys(_MRoomMessage).forEach(function (key) {\n  if (key === \"default\" || key === \"__esModule\") return;\n  if (key in exports && exports[key] === _MRoomMessage[key]) return;\n  Object.defineProperty(exports, key, {\n    enumerable: true,\n    get: function get() {\n      return _MRoomMessage[key];\n    }\n  });\n});\n\nvar _MMessage = require(\"./interpreters/modern/MMessage\");\n\nObject.keys(_MMessage).forEach(function (key) {\n  if (key === \"default\" || key === \"__esModule\") return;\n  if (key in exports && exports[key] === _MMessage[key]) return;\n  Object.defineProperty(exports, key, {\n    enumerable: true,\n    get: function get() {\n      return _MMessage[key];\n    }\n  });\n});\n\nvar _MPoll = require(\"./interpreters/modern/MPoll\");\n\nObject.keys(_MPoll).forEach(function (key) {\n  if (key === \"default\" || key === \"__esModule\") return;\n  if (key in exports && exports[key] === _MPoll[key]) return;\n  Object.defineProperty(exports, key, {\n    enumerable: true,\n    get: function get() {\n      return _MPoll[key];\n    }\n  });\n});\n\nvar _relationship_types = require(\"./events/relationship_types\");\n\nObject.keys(_relationship_types).forEach(function (key) {\n  if (key === \"default\" || key === \"__esModule\") return;\n  if (key in exports && exports[key] === _relationship_types[key]) return;\n  Object.defineProperty(exports, key, {\n    enumerable: true,\n    get: function get() {\n      return _relationship_types[key];\n    }\n  });\n});\n\nvar _ExtensibleEvent = require(\"./events/ExtensibleEvent\");\n\nObject.keys(_ExtensibleEvent).forEach(function (key) {\n  if (key === \"default\" || key === \"__esModule\") return;\n  if (key in exports && exports[key] === _ExtensibleEvent[key]) return;\n  Object.defineProperty(exports, key, {\n    enumerable: true,\n    get: function get() {\n      return _ExtensibleEvent[key];\n    }\n  });\n});\n\nvar _message_types = require(\"./events/message_types\");\n\nObject.keys(_message_types).forEach(function (key) {\n  if (key === \"default\" || key === \"__esModule\") return;\n  if (key in exports && exports[key] === _message_types[key]) return;\n  Object.defineProperty(exports, key, {\n    enumerable: true,\n    get: function get() {\n      return _message_types[key];\n    }\n  });\n});\n\nvar _MessageEvent = require(\"./events/MessageEvent\");\n\nObject.keys(_MessageEvent).forEach(function (key) {\n  if (key === \"default\" || key === \"__esModule\") return;\n  if (key in exports && exports[key] === _MessageEvent[key]) return;\n  Object.defineProperty(exports, key, {\n    enumerable: true,\n    get: function get() {\n      return _MessageEvent[key];\n    }\n  });\n});\n\nvar _EmoteEvent = require(\"./events/EmoteEvent\");\n\nObject.keys(_EmoteEvent).forEach(function (key) {\n  if (key === \"default\" || key === \"__esModule\") return;\n  if (key in exports && exports[key] === _EmoteEvent[key]) return;\n  Object.defineProperty(exports, key, {\n    enumerable: true,\n    get: function get() {\n      return _EmoteEvent[key];\n    }\n  });\n});\n\nvar _NoticeEvent = require(\"./events/NoticeEvent\");\n\nObject.keys(_NoticeEvent).forEach(function (key) {\n  if (key === \"default\" || key === \"__esModule\") return;\n  if (key in exports && exports[key] === _NoticeEvent[key]) return;\n  Object.defineProperty(exports, key, {\n    enumerable: true,\n    get: function get() {\n      return _NoticeEvent[key];\n    }\n  });\n});\n\nvar _poll_types = require(\"./events/poll_types\");\n\nObject.keys(_poll_types).forEach(function (key) {\n  if (key === \"default\" || key === \"__esModule\") return;\n  if (key in exports && exports[key] === _poll_types[key]) return;\n  Object.defineProperty(exports, key, {\n    enumerable: true,\n    get: function get() {\n      return _poll_types[key];\n    }\n  });\n});\n\nvar _PollStartEvent = require(\"./events/PollStartEvent\");\n\nObject.keys(_PollStartEvent).forEach(function (key) {\n  if (key === \"default\" || key === \"__esModule\") return;\n  if (key in exports && exports[key] === _PollStartEvent[key]) return;\n  Object.defineProperty(exports, key, {\n    enumerable: true,\n    get: function get() {\n      return _PollStartEvent[key];\n    }\n  });\n});\n\nvar _PollResponseEvent = require(\"./events/PollResponseEvent\");\n\nObject.keys(_PollResponseEvent).forEach(function (key) {\n  if (key === \"default\" || key === \"__esModule\") return;\n  if (key in exports && exports[key] === _PollResponseEvent[key]) return;\n  Object.defineProperty(exports, key, {\n    enumerable: true,\n    get: function get() {\n      return _PollResponseEvent[key];\n    }\n  });\n});\n\nvar _PollEndEvent = require(\"./events/PollEndEvent\");\n\nObject.keys(_PollEndEvent).forEach(function (key) {\n  if (key === \"default\" || key === \"__esModule\") return;\n  if (key in exports && exports[key] === _PollEndEvent[key]) return;\n  Object.defineProperty(exports, key, {\n    enumerable: true,\n    get: function get() {\n      return _PollEndEvent[key];\n    }\n  });\n});","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.LEGACY_M_ROOM_MESSAGE = void 0;\nexports.parseMRoomMessage = parseMRoomMessage;\n\nvar _MessageEvent = require(\"../../events/MessageEvent\");\n\nvar _NoticeEvent = require(\"../../events/NoticeEvent\");\n\nvar _EmoteEvent = require(\"../../events/EmoteEvent\");\n\nvar _NamespacedValue = require(\"../../NamespacedValue\");\n\nvar _message_types = require(\"../../events/message_types\");\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nvar LEGACY_M_ROOM_MESSAGE = new _NamespacedValue.NamespacedValue(\"m.room.message\");\nexports.LEGACY_M_ROOM_MESSAGE = LEGACY_M_ROOM_MESSAGE;\n\nfunction parseMRoomMessage(wireEvent) {\n  var _wireEvent$content, _wireEvent$content2, _wireEvent$content3;\n\n  if (_message_types.M_MESSAGE.findIn(wireEvent.content) || _message_types.M_TEXT.findIn(wireEvent.content)) {\n    // We know enough about the event to coerce it into the right type\n    return new _MessageEvent.MessageEvent(wireEvent);\n  }\n\n  var msgtype = (_wireEvent$content = wireEvent.content) === null || _wireEvent$content === void 0 ? void 0 : _wireEvent$content.msgtype;\n  var text = (_wireEvent$content2 = wireEvent.content) === null || _wireEvent$content2 === void 0 ? void 0 : _wireEvent$content2.body;\n  var html = ((_wireEvent$content3 = wireEvent.content) === null || _wireEvent$content3 === void 0 ? void 0 : _wireEvent$content3.format) === \"org.matrix.custom.html\" ? wireEvent.content.formatted_body : null;\n\n  if (msgtype === \"m.text\") {\n    var _objectSpread2;\n\n    return new _MessageEvent.MessageEvent(_objectSpread(_objectSpread({}, wireEvent), {}, {\n      content: _objectSpread(_objectSpread({}, wireEvent.content), {}, (_objectSpread2 = {}, _defineProperty(_objectSpread2, _message_types.M_TEXT.name, text), _defineProperty(_objectSpread2, _message_types.M_HTML.name, html), _objectSpread2))\n    }));\n  } else if (msgtype === \"m.notice\") {\n    var _objectSpread3;\n\n    return new _NoticeEvent.NoticeEvent(_objectSpread(_objectSpread({}, wireEvent), {}, {\n      content: _objectSpread(_objectSpread({}, wireEvent.content), {}, (_objectSpread3 = {}, _defineProperty(_objectSpread3, _message_types.M_TEXT.name, text), _defineProperty(_objectSpread3, _message_types.M_HTML.name, html), _objectSpread3))\n    }));\n  } else if (msgtype === \"m.emote\") {\n    var _objectSpread4;\n\n    return new _EmoteEvent.EmoteEvent(_objectSpread(_objectSpread({}, wireEvent), {}, {\n      content: _objectSpread(_objectSpread({}, wireEvent.content), {}, (_objectSpread4 = {}, _defineProperty(_objectSpread4, _message_types.M_TEXT.name, text), _defineProperty(_objectSpread4, _message_types.M_HTML.name, html), _objectSpread4))\n    }));\n  } else {\n    // TODO: Handle other types\n    return null;\n  }\n}","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.parseMMessage = parseMMessage;\n\nvar _MessageEvent = require(\"../../events/MessageEvent\");\n\nvar _message_types = require(\"../../events/message_types\");\n\nvar _EmoteEvent = require(\"../../events/EmoteEvent\");\n\nvar _NoticeEvent = require(\"../../events/NoticeEvent\");\n\n/*\nCopyright 2022 The Matrix.org Foundation C.I.C.\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nfunction parseMMessage(wireEvent) {\n  if (_message_types.M_EMOTE.matches(wireEvent.type)) {\n    return new _EmoteEvent.EmoteEvent(wireEvent);\n  } else if (_message_types.M_NOTICE.matches(wireEvent.type)) {\n    return new _NoticeEvent.NoticeEvent(wireEvent);\n  } // default: return a generic message\n\n\n  return new _MessageEvent.MessageEvent(wireEvent);\n}","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.parseMPoll = parseMPoll;\n\nvar _poll_types = require(\"../../events/poll_types\");\n\nvar _PollStartEvent = require(\"../../events/PollStartEvent\");\n\nvar _PollResponseEvent = require(\"../../events/PollResponseEvent\");\n\nvar _PollEndEvent = require(\"../../events/PollEndEvent\");\n\n/*\nCopyright 2022 The Matrix.org Foundation C.I.C.\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\nfunction parseMPoll(wireEvent) {\n  if (_poll_types.M_POLL_START.matches(wireEvent.type)) {\n    return new _PollStartEvent.PollStartEvent(wireEvent);\n  } else if (_poll_types.M_POLL_RESPONSE.matches(wireEvent.type)) {\n    return new _PollResponseEvent.PollResponseEvent(wireEvent);\n  } else if (_poll_types.M_POLL_END.matches(wireEvent.type)) {\n    return new _PollEndEvent.PollEndEvent(wireEvent);\n  }\n\n  return null; // not a poll event\n}","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.isOptionalAString = isOptionalAString;\nexports.isProvided = isProvided;\n\n/*\nCopyright 2021 - 2022 The Matrix.org Foundation C.I.C.\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\n\n/**\n * Represents an optional type: can either be T or a falsy value.\n */\n\n/**\n * Determines if the given optional string is a defined string.\n * @param {Optional<string>} s The input string.\n * @returns {boolean} True if the input is a defined string.\n */\nfunction isOptionalAString(s) {\n  return isProvided(s) && typeof s === 'string';\n}\n/**\n * Determines if the given optional was provided a value.\n * @param {Optional<T>} s The optional to test.\n * @returns {boolean} True if the value is defined.\n */\n\n\nfunction isProvided(s) {\n  return s !== null && s !== undefined;\n}\n/**\n * Represents either just T1, just T2, or T1 and T2 mixed.\n */","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.LegacyMsgType = void 0;\nexports.isEventLike = isEventLike;\n\nvar _message_types = require(\"../events/message_types\");\n\n/*\nCopyright 2022 The Matrix.org Foundation C.I.C.\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\n\n/**\n * Represents a legacy m.room.message msgtype\n */\nvar LegacyMsgType;\n/**\n * Determines if the given partial event looks similar enough to the given legacy msgtype\n * to count as that message type.\n * @param {IPartialEvent<EitherAnd<IPartialLegacyContent, M_MESSAGE_EVENT_CONTENT>>} event The event.\n * @param {LegacyMsgType} msgtype The message type to compare for.\n * @returns {boolean} True if the event appears to look similar enough to the msgtype.\n */\n\nexports.LegacyMsgType = LegacyMsgType;\n\n(function (LegacyMsgType) {\n  LegacyMsgType[\"Text\"] = \"m.text\";\n  LegacyMsgType[\"Notice\"] = \"m.notice\";\n  LegacyMsgType[\"Emote\"] = \"m.emote\";\n})(LegacyMsgType || (exports.LegacyMsgType = LegacyMsgType = {}));\n\nfunction isEventLike(event, msgtype) {\n  var content = event.content;\n\n  if (msgtype === LegacyMsgType.Text) {\n    return _message_types.M_MESSAGE.matches(event.type) || event.type === \"m.room.message\" && (content === null || content === void 0 ? void 0 : content['msgtype']) === \"m.text\";\n  } else if (msgtype === LegacyMsgType.Emote) {\n    return _message_types.M_EMOTE.matches(event.type) || event.type === \"m.room.message\" && (content === null || content === void 0 ? void 0 : content['msgtype']) === \"m.emote\";\n  } else if (msgtype === LegacyMsgType.Notice) {\n    return _message_types.M_NOTICE.matches(event.type) || event.type === \"m.room.message\" && (content === null || content === void 0 ? void 0 : content['msgtype']) === \"m.notice\";\n  }\n\n  return false;\n}","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.isEventTypeSame = isEventTypeSame;\n\n/*\nCopyright 2022 The Matrix.org Foundation C.I.C.\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\n\n/**\n * Represents a potentially namespaced event type.\n */\n\n/**\n * Determines if two event types are the same, including namespaces.\n * @param {EventType} given The given event type. This will be compared\n * against the expected type.\n * @param {EventType} expected The expected event type.\n * @returns {boolean} True if the given type matches the expected type.\n */\nfunction isEventTypeSame(given, expected) {\n  if (typeof given === \"string\") {\n    if (typeof expected === \"string\") {\n      return expected === given;\n    } else {\n      return expected.matches(given);\n    }\n  } else {\n    if (typeof expected === \"string\") {\n      return given.matches(expected);\n    } else {\n      var expectedNs = expected;\n      var givenNs = given;\n      return expectedNs.matches(givenNs.name) || expectedNs.matches(givenNs.altName);\n    }\n  }\n}","'use strict';\nconst retry = require('retry');\n\nconst networkErrorMsgs = [\n\t'Failed to fetch', // Chrome\n\t'NetworkError when attempting to fetch resource.', // Firefox\n\t'The Internet connection appears to be offline.', // Safari\n\t'Network request failed' // `cross-fetch`\n];\n\nclass AbortError extends Error {\n\tconstructor(message) {\n\t\tsuper();\n\n\t\tif (message instanceof Error) {\n\t\t\tthis.originalError = message;\n\t\t\t({message} = message);\n\t\t} else {\n\t\t\tthis.originalError = new Error(message);\n\t\t\tthis.originalError.stack = this.stack;\n\t\t}\n\n\t\tthis.name = 'AbortError';\n\t\tthis.message = message;\n\t}\n}\n\nconst decorateErrorWithCounts = (error, attemptNumber, options) => {\n\t// Minus 1 from attemptNumber because the first attempt does not count as a retry\n\tconst retriesLeft = options.retries - (attemptNumber - 1);\n\n\terror.attemptNumber = attemptNumber;\n\terror.retriesLeft = retriesLeft;\n\treturn error;\n};\n\nconst isNetworkError = errorMessage => networkErrorMsgs.includes(errorMessage);\n\nconst pRetry = (input, options) => new Promise((resolve, reject) => {\n\toptions = {\n\t\tonFailedAttempt: () => {},\n\t\tretries: 10,\n\t\t...options\n\t};\n\n\tconst operation = retry.operation(options);\n\n\toperation.attempt(async attemptNumber => {\n\t\ttry {\n\t\t\tresolve(await input(attemptNumber));\n\t\t} catch (error) {\n\t\t\tif (!(error instanceof Error)) {\n\t\t\t\treject(new TypeError(`Non-error was thrown: \"${error}\". You should only throw errors.`));\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (error instanceof AbortError) {\n\t\t\t\toperation.stop();\n\t\t\t\treject(error.originalError);\n\t\t\t} else if (error instanceof TypeError && !isNetworkError(error.message)) {\n\t\t\t\toperation.stop();\n\t\t\t\treject(error);\n\t\t\t} else {\n\t\t\t\tdecorateErrorWithCounts(error, attemptNumber, options);\n\n\t\t\t\ttry {\n\t\t\t\t\tawait options.onFailedAttempt(error);\n\t\t\t\t} catch (error) {\n\t\t\t\t\treject(error);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (!operation.retry(error)) {\n\t\t\t\t\treject(operation.mainError());\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t});\n});\n\nmodule.exports = pRetry;\n// TODO: remove this in the next major version\nmodule.exports.default = pRetry;\n\nmodule.exports.AbortError = AbortError;\n","module.exports = require('./lib/retry');","var RetryOperation = require('./retry_operation');\n\nexports.operation = function(options) {\n  var timeouts = exports.timeouts(options);\n  return new RetryOperation(timeouts, {\n      forever: options && (options.forever || options.retries === Infinity),\n      unref: options && options.unref,\n      maxRetryTime: options && options.maxRetryTime\n  });\n};\n\nexports.timeouts = function(options) {\n  if (options instanceof Array) {\n    return [].concat(options);\n  }\n\n  var opts = {\n    retries: 10,\n    factor: 2,\n    minTimeout: 1 * 1000,\n    maxTimeout: Infinity,\n    randomize: false\n  };\n  for (var key in options) {\n    opts[key] = options[key];\n  }\n\n  if (opts.minTimeout > opts.maxTimeout) {\n    throw new Error('minTimeout is greater than maxTimeout');\n  }\n\n  var timeouts = [];\n  for (var i = 0; i < opts.retries; i++) {\n    timeouts.push(this.createTimeout(i, opts));\n  }\n\n  if (options && options.forever && !timeouts.length) {\n    timeouts.push(this.createTimeout(i, opts));\n  }\n\n  // sort the array numerically ascending\n  timeouts.sort(function(a,b) {\n    return a - b;\n  });\n\n  return timeouts;\n};\n\nexports.createTimeout = function(attempt, opts) {\n  var random = (opts.randomize)\n    ? (Math.random() + 1)\n    : 1;\n\n  var timeout = Math.round(random * Math.max(opts.minTimeout, 1) * Math.pow(opts.factor, attempt));\n  timeout = Math.min(timeout, opts.maxTimeout);\n\n  return timeout;\n};\n\nexports.wrap = function(obj, options, methods) {\n  if (options instanceof Array) {\n    methods = options;\n    options = null;\n  }\n\n  if (!methods) {\n    methods = [];\n    for (var key in obj) {\n      if (typeof obj[key] === 'function') {\n        methods.push(key);\n      }\n    }\n  }\n\n  for (var i = 0; i < methods.length; i++) {\n    var method   = methods[i];\n    var original = obj[method];\n\n    obj[method] = function retryWrapper(original) {\n      var op       = exports.operation(options);\n      var args     = Array.prototype.slice.call(arguments, 1);\n      var callback = args.pop();\n\n      args.push(function(err) {\n        if (op.retry(err)) {\n          return;\n        }\n        if (err) {\n          arguments[0] = op.mainError();\n        }\n        callback.apply(this, arguments);\n      });\n\n      op.attempt(function() {\n        original.apply(obj, args);\n      });\n    }.bind(obj, original);\n    obj[method].options = options;\n  }\n};\n","function RetryOperation(timeouts, options) {\n  // Compatibility for the old (timeouts, retryForever) signature\n  if (typeof options === 'boolean') {\n    options = { forever: options };\n  }\n\n  this._originalTimeouts = JSON.parse(JSON.stringify(timeouts));\n  this._timeouts = timeouts;\n  this._options = options || {};\n  this._maxRetryTime = options && options.maxRetryTime || Infinity;\n  this._fn = null;\n  this._errors = [];\n  this._attempts = 1;\n  this._operationTimeout = null;\n  this._operationTimeoutCb = null;\n  this._timeout = null;\n  this._operationStart = null;\n  this._timer = null;\n\n  if (this._options.forever) {\n    this._cachedTimeouts = this._timeouts.slice(0);\n  }\n}\nmodule.exports = RetryOperation;\n\nRetryOperation.prototype.reset = function() {\n  this._attempts = 1;\n  this._timeouts = this._originalTimeouts.slice(0);\n}\n\nRetryOperation.prototype.stop = function() {\n  if (this._timeout) {\n    clearTimeout(this._timeout);\n  }\n  if (this._timer) {\n    clearTimeout(this._timer);\n  }\n\n  this._timeouts       = [];\n  this._cachedTimeouts = null;\n};\n\nRetryOperation.prototype.retry = function(err) {\n  if (this._timeout) {\n    clearTimeout(this._timeout);\n  }\n\n  if (!err) {\n    return false;\n  }\n  var currentTime = new Date().getTime();\n  if (err && currentTime - this._operationStart >= this._maxRetryTime) {\n    this._errors.push(err);\n    this._errors.unshift(new Error('RetryOperation timeout occurred'));\n    return false;\n  }\n\n  this._errors.push(err);\n\n  var timeout = this._timeouts.shift();\n  if (timeout === undefined) {\n    if (this._cachedTimeouts) {\n      // retry forever, only keep last error\n      this._errors.splice(0, this._errors.length - 1);\n      timeout = this._cachedTimeouts.slice(-1);\n    } else {\n      return false;\n    }\n  }\n\n  var self = this;\n  this._timer = setTimeout(function() {\n    self._attempts++;\n\n    if (self._operationTimeoutCb) {\n      self._timeout = setTimeout(function() {\n        self._operationTimeoutCb(self._attempts);\n      }, self._operationTimeout);\n\n      if (self._options.unref) {\n          self._timeout.unref();\n      }\n    }\n\n    self._fn(self._attempts);\n  }, timeout);\n\n  if (this._options.unref) {\n      this._timer.unref();\n  }\n\n  return true;\n};\n\nRetryOperation.prototype.attempt = function(fn, timeoutOps) {\n  this._fn = fn;\n\n  if (timeoutOps) {\n    if (timeoutOps.timeout) {\n      this._operationTimeout = timeoutOps.timeout;\n    }\n    if (timeoutOps.cb) {\n      this._operationTimeoutCb = timeoutOps.cb;\n    }\n  }\n\n  var self = this;\n  if (this._operationTimeoutCb) {\n    this._timeout = setTimeout(function() {\n      self._operationTimeoutCb();\n    }, self._operationTimeout);\n  }\n\n  this._operationStart = new Date().getTime();\n\n  this._fn(this._attempts);\n};\n\nRetryOperation.prototype.try = function(fn) {\n  console.log('Using RetryOperation.try() is deprecated');\n  this.attempt(fn);\n};\n\nRetryOperation.prototype.start = function(fn) {\n  console.log('Using RetryOperation.start() is deprecated');\n  this.attempt(fn);\n};\n\nRetryOperation.prototype.start = RetryOperation.prototype.try;\n\nRetryOperation.prototype.errors = function() {\n  return this._errors;\n};\n\nRetryOperation.prototype.attempts = function() {\n  return this._attempts;\n};\n\nRetryOperation.prototype.mainError = function() {\n  if (this._errors.length === 0) {\n    return null;\n  }\n\n  var counts = {};\n  var mainError = null;\n  var mainErrorCount = 0;\n\n  for (var i = 0; i < this._errors.length; i++) {\n    var error = this._errors[i];\n    var message = error.message;\n    var count = (counts[message] || 0) + 1;\n\n    counts[message] = count;\n\n    if (count >= mainErrorCount) {\n      mainError = error;\n      mainErrorCount = count;\n    }\n  }\n\n  return mainError;\n};\n","'use strict';\n\n\nvar data = require('./data.json');\n\nfunction escapeRegexp(str) {\n  return str.replace(/([.?*+^$[\\]\\\\(){}|-])/g, '\\\\$1');\n}\n\nvar REPLACE_RE = RegExp(Object.keys(data).map(escapeRegexp).join('|'), 'g');\n\nfunction replace_fn(match) {\n  return data[match];\n}\n\nfunction unhomoglyph(str) {\n  return str.replace(REPLACE_RE, replace_fn);\n}\n\nmodule.exports = unhomoglyph;\n","import toPropertyKey from \"./toPropertyKey.js\";\nfunction _defineProperty(e, r, t) {\n  return (r = toPropertyKey(r)) in e ? Object.defineProperty(e, r, {\n    value: t,\n    enumerable: !0,\n    configurable: !0,\n    writable: !0\n  }) : e[r] = t, e;\n}\nexport { _defineProperty as default };","import _typeof from \"./typeof.js\";\nfunction toPrimitive(t, r) {\n  if (\"object\" != _typeof(t) || !t) return t;\n  var e = t[Symbol.toPrimitive];\n  if (void 0 !== e) {\n    var i = e.call(t, r || \"default\");\n    if (\"object\" != _typeof(i)) return i;\n    throw new TypeError(\"@@toPrimitive must return a primitive value.\");\n  }\n  return (\"string\" === r ? String : Number)(t);\n}\nexport { toPrimitive as default };","import _typeof from \"./typeof.js\";\nimport toPrimitive from \"./toPrimitive.js\";\nfunction toPropertyKey(t) {\n  var i = toPrimitive(t, \"string\");\n  return \"symbol\" == _typeof(i) ? i : i + \"\";\n}\nexport { toPropertyKey as default };","function _typeof(o) {\n  \"@babel/helpers - typeof\";\n\n  return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (o) {\n    return typeof o;\n  } : function (o) {\n    return o && \"function\" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? \"symbol\" : typeof o;\n  }, _typeof(o);\n}\nexport { _typeof as default };"],"names":["UnstableValue","EventType","NamespacedValue","ReceiptType","UNREAD_THREAD_NOTIFICATIONS","ServerControlledNamespacedValue","constructor","stable","unstable","this","Error","name","altName","names","push","matches","val","findIn","obj","includedIn","arr","included","includes","args","_defineProperty","setPreferUnstable","preferUnstable","super","IndexedDBStoreWorker","postMessage","call","command","ev","_this$backend","_this$backend2","_this$backend3","_this$backend4","_this$backend5","_this$backend6","_this$backend7","_this$backend8","_this$backend9","_this$backend10","_this$backend11","_this$backend12","_this$backend13","_this$backend14","_this$backend15","_this$backend16","msg","data","prom","backend","LocalIndexedDBStoreBackend","indexedDB","Promise","resolve","connect","onClose","isNewlyCreated","clearDatabase","getSavedSync","setSyncData","syncToDatabase","getUserPresenceEvents","getNextBatchToken","getOutOfBandMembers","clearOutOfBandMembers","setOutOfBandMembers","getClientOptions","storeClientOptions","saveToDeviceBatches","getOldestToDeviceBatch","removeToDeviceBatch","undefined","then","ret","seq","result","err","logger","error","message","DEFAULT_NAMESPACE","extendLogger","prefixedLogger","getChild","withPrefix","prefix","prefixLogger","loglevel","setLevel","DEBUG","getPrefixedLogger","methodName","logLevel","loggerName","unshift","console","log","ReceiptAccumulator","Map","MapWithDefault","setUnthreaded","userId","receipt","unthreadedReadReceipts","set","setThreaded","threadId","threadedReadReceipts","getOrCreate","allUnthreaded","entries","allThreaded","receiptsForThread","values","e","consumeEphemeralEvents","events","forEach","type","Receipt","content","Object","keys","eventId","key","value","isSupportedReceiptType","thread_id","buildAccumulatedReceiptEvent","roomId","receiptEvent","room_id","receiptEventContent","receiptData","recursiveMapToObject","size","Category","SyncAccumulator","opts","maxTimelineEntries","accumulate","syncResponse","fromDatabase","accumulateRooms","accumulateAccountData","nextBatch","next_batch","account_data","accountData","rooms","invite","accumulateRoom","Invite","join","Join","leave","Leave","knock","Knock","category","knockRooms","accumulateInviteState","accumulateKnockState","inviteRooms","accumulateJoinState","joinRooms","invite_state","currentData","hasAdded","i","length","current","state_key","knock_state","_ref","_data","_data$ephemeral","_data$state","_data$timeline","_currentState","create","_timeline","_accountData","_unreadNotifications","_unreadThreadNotifications","_summary","_receipts","unread_notifications","summary","_sum$HEROES_KEY","_sum$JOINED_COUNT_KEY","_sum$INVITED_COUNT_KE","HEROES_KEY","INVITED_COUNT_KEY","JOINED_COUNT_KEY","acc","sum","ephemeral","timeline","limited","state","setState","index","_data$timeline$prev_b","transformedEvent","_e$unsigned","assign","unsigned","age","_localTs","Date","now","event","token","prev_batch","slice","getJSON","forDatabase","roomData","roomJson","unread_thread_notifications","evType","msgData","rollBackState","timelineEvent","prevStateEvent","deepCopy","prev_content","prev_sender","sender","stateKey","accData","roomsData","eventMap","JSON","parse","stringify","promiseTry","fn","str","c","String","fromCharCode","receiptType","Read","ReadPrivate","processMapToObjectValue","Array","isArray","map","v","targetMap","fromEntries","createDefault","has","get","noop","undefinedType","isIE","window","navigator","test","userAgent","logMethods","_loggersByName","defaultLogger","bindMethod","method","bind","Function","prototype","apply","arguments","traceForIE","trace","realMethod","replaceLoggingMethods","level","getLevel","methodFactory","debug","levels","SILENT","enableLoggingWhenConsoleArrives","defaultMethodFactory","_level","_loggerName","Logger","factory","inheritedLevel","defaultLevel","userLevel","self","storageKey","persistLevelIfPossible","levelNum","levelName","toUpperCase","localStorage","ignore","document","cookie","encodeURIComponent","getPersistedLevel","storedLevel","cookieName","location","indexOf","exec","clearPersistedLevel","removeItem","normalizeLevel","input","TypeError","persist","setDefaultLevel","resetLevel","enableAll","TRACE","disableAll","rebuild","childName","initialLevel","getLogger","_log","noConflict","getLoggers","defineProperty","exports","ExtensibleEvents","_NamespacedMap","_InvalidEventError","_MRoomMessage","_MMessage","_message_types","_poll_types","_MPoll","_createForOfIteratorHelper","o","allowArrayLike","it","Symbol","iterator","minLen","_arrayLikeToArray","n","toString","from","_unsupportedIterableToArray","F","s","done","_e","f","normalCompletion","didErr","step","next","_e2","len","arr2","_defineProperties","target","props","descriptor","enumerable","configurable","writable","instance","Constructor","_classCallCheck","NamespacedMap","LEGACY_M_ROOM_MESSAGE","parseMRoomMessage","M_MESSAGE","parseMMessage","M_EMOTE","M_NOTICE","M_POLL_START","parseMPoll","M_POLL_RESPONSE","M_POLL_END","protoProps","staticProps","_defaultInstance","defaultInstance","unknownInterpretOrder","wireEventType","interpreter","registerInterpreter","wireFormat","_this$_unknownInterpr","_unknownInterpretOrder","interpreters","hasNamespaced","getNamespaced","_step","_iterator","tryType","InvalidEventError","_typeof","_createSuper","Derived","hasNativeReflectConstruct","_isNativeReflectConstruct","Super","_getPrototypeOf","NewTarget","Reflect","construct","ReferenceError","_assertThisInitialized","_possibleConstructorReturn","_wrapNativeSuper","Class","_cache","Wrapper","_construct","_setPrototypeOf","Parent","a","sham","Proxy","Boolean","valueOf","p","setPrototypeOf","__proto__","getPrototypeOf","_Error","subClass","superClass","_inherits","_super","initial","internalMap","_createClass","_NamespacedValue","_this","EmoteEvent","_MessageEvent2","_events","_get","property","receiver","base","object","hasOwnProperty","_superPropBase","desc","getOwnPropertyDescriptor","_MessageEvent","text","html","_content","M_TEXT","M_HTML","primaryEventType","isEventTypeSame","MessageEvent","ExtensibleEvent","_ExtensibleEvent2","_types","ownKeys","enumerableOnly","getOwnPropertySymbols","symbols","filter","sym","_objectSpread","source","getOwnPropertyDescriptors","defineProperties","_ExtensibleEvent","mmessage","wireContent","mtext","mhtml","isProvided","find","r","mimetype","body","renderings","isOptionalAString","messageRendering","mime","_this$html","serializeMMessageOnly","msgtype","format","formatted_body","NoticeEvent","PollEndEvent","_relationship_types","rel","REFERENCE_RELATION","rel_type","event_id","pollEventId","closingMessage","serialize","PollResponseEvent","validateAgainst","answers","internalAnswerIds","internalSpoiled","poll","response","some","pa","id","maxSelections","spoiled","answerIds","PollStartEvent","PollAnswerSubevent","_toConsumableArray","_arrayWithoutHoles","iter","_iterableToArray","_nonIterableSpread","_super2","_this2","question","rawKind","kind","M_POLL_KIND_DISCLOSED","M_POLL_KIND_UNDISCLOSED","Number","isFinite","max_selections","_content2","concat","_content3","LETTERS","charAt","Math","floor","random","_ExtensibleEvents","_IPartialEvent","_MessageMatchers","_EmoteEvent","_NoticeEvent","_PollStartEvent","_PollResponseEvent","_PollEndEvent","wireEvent","_wireEvent$content","_wireEvent$content2","_wireEvent$content3","_objectSpread2","_objectSpread3","_objectSpread4","LegacyMsgType","isEventLike","Text","Emote","Notice","given","expected","expectedNs","givenNs","retry","networkErrorMsgs","AbortError","originalError","stack","pRetry","options","reject","onFailedAttempt","retries","operation","attempt","async","attemptNumber","stop","errorMessage","retriesLeft","decorateErrorWithCounts","mainError","module","RetryOperation","timeouts","forever","Infinity","unref","maxRetryTime","factor","minTimeout","maxTimeout","randomize","createTimeout","sort","b","timeout","round","max","pow","min","wrap","methods","original","op","callback","pop","_originalTimeouts","_timeouts","_options","_maxRetryTime","_fn","_errors","_attempts","_operationTimeout","_operationTimeoutCb","_timeout","_operationStart","_timer","_cachedTimeouts","reset","clearTimeout","currentTime","getTime","shift","splice","setTimeout","timeoutOps","cb","try","start","errors","attempts","counts","mainErrorCount","count","REPLACE_RE","RegExp","replace","replace_fn","match","t","toPrimitive","toPropertyKey"],"sourceRoot":""}