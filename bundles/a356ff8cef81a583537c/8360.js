"use strict";(self.webpackChunkelement_web=self.webpackChunkelement_web||[]).push([[8360],{"./node_modules/matrix-react-sdk/src/components/views/rooms/CollapsibleButton.tsx":(e,t,s)=>{s.d(t,{J:()=>u});var o=s("./node_modules/@babel/runtime/helpers/esm/extends.js"),n=s("./node_modules/@babel/runtime/helpers/esm/objectWithoutProperties.js"),r=s("./node_modules/react/index.js"),a=s("./node_modules/classnames/index.js"),i=s.n(a),l=s("./node_modules/matrix-react-sdk/src/components/views/elements/AccessibleButton.tsx"),m=s("./node_modules/matrix-react-sdk/src/components/views/rooms/MessageComposerButtons.tsx"),c=s("./node_modules/matrix-react-sdk/src/components/views/context_menus/IconizedContextMenu.tsx");const d=["title","children","className","iconClassName","inputRef"],u=e=>{let{title:t,children:s,className:a,iconClassName:u,inputRef:_}=e,p=(0,n.A)(e,d);return!!(0,r.useContext)(m.ZF)?r.createElement(c.R$,(0,o.A)({},p,{iconClassName:u,label:t,inputRef:_})):r.createElement(l.A,(0,o.A)({},p,{title:t,className:i()(a,u),ref:_}),s)}},"./node_modules/matrix-react-sdk/src/components/views/rooms/EmojiButton.tsx":(e,t,s)=>{s.d(t,{h:()=>u});var o=s("./node_modules/@babel/runtime/helpers/esm/extends.js"),n=s("./node_modules/classnames/index.js"),r=s.n(n),a=s("./node_modules/react/index.js"),i=s("./node_modules/matrix-react-sdk/src/languageHandler.tsx"),l=s("./node_modules/matrix-react-sdk/src/components/structures/ContextMenu.tsx"),m=s("./node_modules/matrix-react-sdk/src/components/views/emojipicker/EmojiPicker.tsx"),c=s("./node_modules/matrix-react-sdk/src/components/views/rooms/CollapsibleButton.tsx"),d=s("./node_modules/matrix-react-sdk/src/components/views/rooms/MessageComposerButtons.tsx");function u({addEmoji:e,menuPosition:t,className:s}){const n=(0,a.useContext)(d.ZF),[u,_,p,x]=(0,l.EF)();let h=null;if(u&&_.current){const s=null!=t?t:(0,l.qv)(_.current.getBoundingClientRect()),r=()=>{x(),null==n||n()};h=a.createElement(l.Ay,(0,o.A)({},s,{onFinished:r,managed:!1}),a.createElement(m.Ay,{onChoose:e,onFinished:r}))}const C=r()("mx_EmojiButton",s,{mx_EmojiButton_highlight:u});return a.createElement(a.Fragment,null,a.createElement(c.J,{className:C,iconClassName:"mx_EmojiButton_icon",onClick:p,title:(0,i._t)("common|emoji"),inputRef:_}),h)}},"./node_modules/matrix-react-sdk/src/components/views/rooms/MessageComposerButtons.tsx":(e,t,s)=>{s.d(t,{Ay:()=>J,ZF:()=>A});var o=s("./node_modules/@babel/runtime/helpers/esm/defineProperty.js"),n=s("./node_modules/@babel/runtime/helpers/esm/extends.js"),r=s("./node_modules/classnames/index.js"),a=s.n(r),i=s("./node_modules/matrix-js-sdk/src/matrix.ts"),l=s("./node_modules/react/index.js"),m=s("./node_modules/matrix-react-sdk/src/languageHandler.tsx"),c=s("./node_modules/matrix-react-sdk/src/components/views/rooms/CollapsibleButton.tsx"),d=s("./node_modules/matrix-react-sdk/src/dispatcher/dispatcher.ts"),u=s("./node_modules/matrix-react-sdk/src/components/views/dialogs/ErrorDialog.tsx"),_=s("./node_modules/matrix-react-sdk/src/components/views/location/index.tsx"),p=s("./node_modules/matrix-react-sdk/src/Modal.tsx"),x=s("./node_modules/matrix-react-sdk/src/components/views/elements/PollCreateDialog.tsx"),h=s("./node_modules/matrix-react-sdk/src/MatrixClientPeg.ts"),C=s("./node_modules/matrix-react-sdk/src/ContentMessages.ts"),g=s("./node_modules/matrix-react-sdk/src/contexts/MatrixClientContext.tsx"),k=s("./node_modules/matrix-react-sdk/src/contexts/RoomContext.ts"),v=s("./node_modules/matrix-react-sdk/src/hooks/useDispatcher.ts"),y=s("./node_modules/matrix-react-sdk/src/utils/BrowserWorkarounds.ts"),E=s("./node_modules/matrix-react-sdk/src/components/views/context_menus/IconizedContextMenu.tsx"),f=s("./node_modules/matrix-react-sdk/src/components/views/rooms/EmojiButton.tsx"),w=s("./node_modules/matrix-react-sdk/src/utils/arrays.ts"),M=s("./node_modules/matrix-react-sdk/src/hooks/useSettings.ts"),b=s("./node_modules/matrix-react-sdk/src/components/views/elements/AccessibleButton.tsx");const A=(0,l.createContext)(null);function N(e){return l.createElement(f.h,{key:"emoji_button",addEmoji:e.addEmoji,menuPosition:e.menuPosition,className:"mx_MessageComposer_button"})}function P(){return l.createElement(S,{key:"controls_upload"})}const U=(0,l.createContext)(null),B=({roomId:e,relation:t,children:s})=>{const o=(0,l.useContext)(g.Ay),n=(0,l.useContext)(k.Ay),r=(0,l.useRef)(null),a=()=>{var e;null!=o&&o.isGuest()?d.Ay.dispatch({action:"require_registration"}):null===(e=r.current)||void 0===e||e.click()};(0,v.F)(d.Ay,(e=>{n.timelineRenderingType===e.context&&"upload_file"===e.action&&a()}));return l.createElement(U.Provider,{value:a},s,l.createElement("input",{ref:r,type:"file",style:{display:"none"},multiple:!0,onClick:y.e,onChange:s=>{var r;0!==(null===(r=s.target.files)||void 0===r?void 0:r.length)&&(C.Ay.sharedInstance().sendContentListToRoom(Array.from(s.target.files),e,t,o,n.timelineRenderingType),s.target.value="")}}))},S=()=>{const e=(0,l.useContext)(A),t=(0,l.useContext)(U);return l.createElement(c.J,{className:"mx_MessageComposer_button",iconClassName:"mx_MessageComposer_upload",onClick:()=>{null==t||t(),null==e||e()},title:(0,m._t)("common|attachment")})};function j(e){return e.showStickersButton?l.createElement(c.J,{id:"stickersButton",key:"controls_stickers",className:"mx_MessageComposer_button",iconClassName:"mx_MessageComposer_stickers",onClick:()=>e.setStickerPickerOpen(!e.isStickerPickerOpen),title:e.isStickerPickerOpen?(0,m._t)("composer|close_sticker_picker"):(0,m._t)("common|sticker")}):null}const R=e=>e.showVoiceBroadcastButton?l.createElement(c.J,{key:"start_voice_broadcast",className:"mx_MessageComposer_button",iconClassName:"mx_MessageComposer_voiceBroadcast",onClick:e.onStartVoiceBroadcastClick,title:(0,m._t)("voice_broadcast|action")}):null;function I(e,t){return t?null:l.createElement(c.J,{key:"voice_message_send",className:"mx_MessageComposer_button",iconClassName:"mx_MessageComposer_voiceMessage",onClick:e.onRecordStartEndClick,title:(0,m._t)("composer|voice_message_button")})}function T(e,t){return l.createElement(D,{key:"polls",room:e,relation:t})}class D extends l.PureComponent{constructor(...e){super(...e),(0,o.A)(this,"onCreateClick",(()=>{var e;null===(e=this.context)||void 0===e||e.call(this);if(this.props.room.currentState.maySendEvent(i.M_POLL_START.name,h.J.safeGet().getSafeUserId())){var t;const e=(null===(t=this.props.relation)||void 0===t?void 0:t.rel_type)===i.THREAD_RELATION_TYPE.name?this.props.relation.event_id:void 0;p.Ay.createDialog(x.A,{room:this.props.room,threadId:e},"mx_CompoundDialog",!1,!0)}else p.Ay.createDialog(u.A,{title:(0,m._t)("composer|poll_button_no_perms_title"),description:(0,m._t)("composer|poll_button_no_perms_description")})}))}render(){var e;return(null===(e=this.props.relation)||void 0===e?void 0:e.rel_type)===i.THREAD_RELATION_TYPE.name?null:l.createElement(c.J,{className:"mx_MessageComposer_button",iconClassName:"mx_MessageComposer_poll",onClick:this.onCreateClick,title:(0,m._t)("composer|poll_button")})}}function F(e,t,s){const o=t.getMember(s.getSafeUserId());return e.showLocationButton&&o?l.createElement(_.Uo,{key:"location",roomId:t.roomId,relation:e.relation,sender:o,menuPosition:e.menuPosition}):null}function O({isRichTextEnabled:e,onClick:t}){const s=e?(0,m._t)("composer|mode_plain"):(0,m._t)("composer|mode_rich_text");return l.createElement(c.J,{className:"mx_MessageComposer_button",iconClassName:a()({mx_MessageComposer_plain_text:!e,mx_MessageComposer_rich_text:e}),onClick:t,title:s})}(0,o.A)(D,"contextType",A);const J=e=>{const t=(0,l.useContext)(g.Ay),{room:s,narrow:o}=(0,l.useContext)(k.Ay),r=(0,M.ti)("feature_wysiwyg_composer");if(!t||!s||e.haveRecording)return null;let i,c;o?(i=[r?l.createElement(O,{key:"composerModeButton",isRichTextEnabled:e.isRichTextEnabled,onClick:e.onComposerModeClick}):N(e)],c=[P(),j(e),I(e,o),R(e),e.showPollsButton?T(s,e.relation):null,F(e,s,t)]):(i=[r?l.createElement(O,{key:"composerModeButton",isRichTextEnabled:e.isRichTextEnabled,onClick:e.onComposerModeClick}):N(e),P()],c=[j(e),I(e,o),R(e),e.showPollsButton?T(s,e.relation):null,F(e,s,t)]),i=(0,w.Bo)(i),c=(0,w.Bo)(c);const d=a()({mx_MessageComposer_button:!0,mx_MessageComposer_buttonMenu:!0,mx_MessageComposer_closeButtonMenu:e.isMenuOpen});return l.createElement(B,{roomId:s.roomId,relation:e.relation},i,c.length>0&&l.createElement(b.A,{className:d,onClick:e.toggleButtonMenu,title:(0,m._t)("quick_settings|sidebar_settings")}),e.isMenuOpen&&l.createElement(E.Ay,(0,n.A)({onFinished:e.toggleButtonMenu},e.menuPosition,{wrapperClassName:"mx_MessageComposer_Menu",compact:!0}),l.createElement(A.Provider,{value:e.toggleButtonMenu},l.createElement(E.tx,null,c))))}},"./node_modules/matrix-react-sdk/src/stores/OwnProfileStore.ts":(e,t,s)=>{s.d(t,{V:()=>p});var o,n=s("./node_modules/@babel/runtime/helpers/esm/defineProperty.js"),r=s("./node_modules/matrix-js-sdk/src/matrix.ts"),a=s("./node_modules/lodash/lodash.js"),i=s("./node_modules/matrix-react-sdk/src/stores/AsyncStoreWithClient.ts"),l=s("./node_modules/matrix-react-sdk/src/dispatcher/dispatcher.ts"),m=s("./node_modules/matrix-react-sdk/src/MatrixClientPeg.ts"),c=s("./node_modules/matrix-react-sdk/src/languageHandler.tsx"),d=s("./node_modules/matrix-react-sdk/src/customisations/Media.ts");const u="mx_profile_displayname",_="mx_profile_avatar_url";class p extends i.r{constructor(){super(l.Ay,{displayName:window.localStorage.getItem(u)||void 0,avatarUrl:window.localStorage.getItem(_)||void 0}),(0,n.A)(this,"monitoredUser",null),(0,n.A)(this,"onProfileUpdate",(0,a.throttle)((async()=>{if(!this.matrixClient)return;let e={displayname:void 0,avatar_url:void 0};try{e=await this.matrixClient.getProfileInfo(this.matrixClient.getSafeUserId())}catch(e){if(!(e instanceof r.MatrixError)||"M_NOT_FOUND"!==e.errcode)throw e}e.displayname?window.localStorage.setItem(u,e.displayname):window.localStorage.removeItem(u),e.avatar_url?window.localStorage.setItem(_,e.avatar_url):window.localStorage.removeItem(_),await this.updateState({displayName:e.displayname,avatarUrl:e.avatar_url,fetchedAt:Date.now()})}),200,{trailing:!0,leading:!0})),(0,n.A)(this,"onStateEvents",(async e=>{const t=m.J.safeGet().getUserId();e.getType()===r.EventType.RoomMember&&e.getSender()===t&&e.getStateKey()===t&&await this.onProfileUpdate()}))}static get instance(){return p.internalInstance}get displayName(){return this.matrixClient?this.matrixClient.isGuest()?(0,c._t)("common|guest"):this.state.displayName?this.state.displayName:this.matrixClient.getUserId():this.state.displayName||null}get isProfileInfoFetched(){return!!this.state.fetchedAt}get avatarMxc(){return this.state.avatarUrl||null}getHttpAvatarUrl(e=0){if(!this.avatarMxc)return null;const t=(0,d.lH)(this.avatarMxc);return!e||e<=0?t.srcHttp:t.getSquareThumbnailHttp(e)}async onNotReady(){var e;this.onProfileUpdate.cancel(),this.monitoredUser&&(this.monitoredUser.removeListener(r.UserEvent.DisplayName,this.onProfileUpdate),this.monitoredUser.removeListener(r.UserEvent.AvatarUrl,this.onProfileUpdate)),null===(e=this.matrixClient)||void 0===e||e.removeListener(r.RoomStateEvent.Events,this.onStateEvents),await this.reset({})}async onReady(){if(!this.matrixClient)return;const e=this.matrixClient.getSafeUserId();this.monitoredUser=this.matrixClient.getUser(e),this.monitoredUser&&(this.monitoredUser.on(r.UserEvent.DisplayName,this.onProfileUpdate),this.monitoredUser.on(r.UserEvent.AvatarUrl,this.onProfileUpdate)),this.matrixClient.on(r.RoomStateEvent.Events,this.onStateEvents),await this.onProfileUpdate()}async onAction(e){}}o=p,(0,n.A)(p,"internalInstance",(()=>{const e=new o;return e.start(),e})())}}]);
//# sourceMappingURL=8360.js.map